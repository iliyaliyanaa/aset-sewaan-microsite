<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Pentadbir - Sistem Aset Sewaan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #2980b9;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --light-gray: #bdc3c7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ===== ADMIN AUTHENTICATION ===== */
        .admin-auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            padding: 20px;
        }
        
        .admin-auth-box {
            width: 100%;
            max-width: 450px;
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .admin-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .admin-logo i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .admin-logo h1 {
            font-size: 1.8rem;
            color: var(--primary);
        }
        
        .admin-logo p {
            color: var(--gray);
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        .admin-form-group {
            margin-bottom: 20px;
        }
        
        .admin-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .admin-input {
            width: 100%;
            padding: 14px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .admin-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
        }
        
        .admin-btn {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background-color: var(--primary);
            color: white;
        }
        
        .admin-btn:hover {
            background-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* ===== ADMIN DASHBOARD ===== */
        .admin-container {
            display: none;
            min-height: 100vh;
        }
        
        /* Admin Header */
        .admin-header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .admin-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background-color: var(--light);
            border-radius: 30px;
        }
        
        .admin-user-avatar {
            width: 35px;
            height: 35px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* Admin Sidebar */
        .admin-main {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .admin-sidebar {
            width: 250px;
            background-color: var(--primary);
            color: white;
            padding: 2rem 0;
        }
        
        .admin-sidebar-menu {
            list-style: none;
        }
        
        .admin-sidebar-menu li {
            margin-bottom: 5px;
        }
        
        .admin-sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .admin-sidebar-menu a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .admin-sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left: 4px solid var(--secondary);
        }
        
        .admin-sidebar-menu i {
            width: 20px;
            text-align: center;
        }
        
        .admin-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        /* Dashboard Cards */
        .admin-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }
        
        .admin-card {
            background-color: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary);
        }
        
        .admin-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .admin-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .admin-card-content h3 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .admin-card-content p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Applications Table */
        .applications-section {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--secondary);
        }
        
        .filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: white;
        }
        
        .search-box {
            flex: 1;
            max-width: 300px;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .applications-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .applications-table th {
            background-color: var(--light);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #ddd;
        }
        
        .applications-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .applications-table tbody tr:hover {
            background-color: rgba(44, 62, 80, 0.05);
        }
        
        /* Status Badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-processing {
            background-color: rgba(243, 156, 18, 0.15);
            color: #b88b00;
        }
        
        .status-approved {
            background-color: rgba(39, 174, 96, 0.15);
            color: var(--success);
        }
        
        .status-rejected {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            padding: 8px 15px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        .btn-approve {
            background-color: var(--success);
            color: white;
        }
        
        .btn-reject {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-view {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-approve:hover {
            background-color: #219653;
        }
        
        .btn-reject:hover {
            background-color: #c0392b;
        }
        
        .btn-view:hover {
            background-color: #2980b9;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            padding: 1.5rem 2rem;
            background: linear-gradient(to right, var(--primary), var(--accent));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 12px 12px 0 0;
        }
        
        .modal-header h3 {
            font-size: 1.3rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }
        
        .close-modal:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .application-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 1.5rem;
        }
        
        .detail-item {
            margin-bottom: 15px;
        }
        
        .detail-label {
            display: block;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .detail-value {
            display: block;
            padding: 10px;
            background-color: var(--light);
            border-radius: 6px;
            border-left: 3px solid var(--secondary);
        }
        
        .modal-footer {
            padding: 1.5rem 2rem;
            background-color: var(--light);
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            border-radius: 0 0 12px 12px;
        }
        
        /* Approval Modal */
        .approval-form {
            margin-top: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 3000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }
        
        .notification-success {
            background-color: var(--success);
        }
        
        .notification-error {
            background-color: var(--danger);
        }
        
        .notification-info {
            background-color: var(--secondary);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .admin-main {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                padding: 1rem 0;
            }
            
            .admin-sidebar-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .admin-sidebar-menu li {
                flex-shrink: 0;
            }
            
            .admin-sidebar-menu a {
                padding: 10px 20px;
            }
            
            .admin-content {
                padding: 1.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .admin-auth-box {
                padding: 30px 20px;
            }
            
            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-controls {
                flex-wrap: wrap;
            }
            
            .search-box {
                max-width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
        
        @media (max-width: 576px) {
            .admin-cards {
                grid-template-columns: 1fr;
            }
            
            .admin-header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .admin-header-right {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Authentication -->
    <div class="admin-auth-page" id="adminAuthPage">
        <div class="admin-auth-box">
            <div class="admin-logo">
                <i class="fas fa-user-shield"></i>
                <h1>Portal Pentadbir</h1>
                <p>Sistem Aset Sewaan Kerajaan</p>
            </div>
            
            <form id="adminLoginForm">
                <div class="admin-form-group">
                    <label for="adminUsername" class="admin-label">Username Pentadbir</label>
                    <input type="text" id="adminUsername" class="admin-input" placeholder="Masukkan username" required>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminPassword" class="admin-label">Kata Laluan</label>
                    <input type="password" id="adminPassword" class="admin-input" placeholder="Masukkan kata laluan" required>
                </div>
                
                <button type="submit" class="admin-btn">
                    <i class="fas fa-sign-in-alt"></i> Log Masuk Pentadbir
                </button>
            </form>
            
            <div style="text-align: center; margin-top: 20px; font-size: 0.9rem; color: var(--gray);">
                <p>Demo: admin / admin123</p>
            </div>
        </div>
    </div>
    
    <!-- Admin Dashboard -->
    <div class="admin-container" id="adminContainer">
        <!-- Header -->
        <header class="admin-header">
            <div class="container admin-header-content">
                <div class="admin-header-left">
                    <i class="fas fa-user-shield" style="font-size: 1.5rem; color: var(--primary);"></i>
                    <h2 style="color: var(--primary);">Portal Pentadbir</h2>
                </div>
                
                <div class="admin-header-right">
                    <div class="admin-user-info">
                        <div class="admin-user-avatar" id="adminAvatar">A</div>
                        <div>
                            <div id="adminName">Pentadbir Sistem</div>
                            <div style="font-size: 0.8rem; color: var(--gray);">Super Admin</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-sm" id="adminLogoutBtn" style="background-color: var(--danger); color: white;">
                        <i class="fas fa-sign-out-alt"></i> Log Keluar
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <div class="admin-main">
            <!-- Sidebar -->
            <nav class="admin-sidebar">
                <ul class="admin-sidebar-menu">
                    <li>
                        <a href="#" class="active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="applications">
                            <i class="fas fa-file-alt"></i> Permohonan Baru
                            <span class="badge" id="newAppBadge" style="margin-left: auto; background-color: var(--danger); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="processed">
                            <i class="fas fa-check-circle"></i> Permohonan Diproses
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="users">
                            <i class="fas fa-users"></i> Pengguna
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="assets">
                            <i class="fas fa-building"></i> Pengurusan Aset
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="reports">
                            <i class="fas fa-chart-bar"></i> Laporan
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- Content Area -->
            <div class="admin-content">
                <!-- Dashboard Section -->
                <div id="dashboardSection" class="admin-section active">
                    <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> Dashboard Pentadbir</h2>
                    
                    <div class="admin-cards">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon" style="background-color: var(--secondary);">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div style="font-size: 2rem; color: var(--secondary); font-weight: bold;" id="pendingCount">0</div>
                            </div>
                            <div class="admin-card-content">
                                <h3>Permohonan Baru</h3>
                                <p>Menunggu kelulusan</p>
                            </div>
                        </div>
                        
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon" style="background-color: var(--success);">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div style="font-size: 2rem; color: var(--success); font-weight: bold;" id="approvedCount">0</div>
                            </div>
                            <div class="admin-card-content">
                                <h3>Permohonan Diluluskan</h3>
                                <p>Sejak 30 hari lalu</p>
                            </div>
                        </div>
                        
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon" style="background-color: var(--danger);">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                                <div style="font-size: 2rem; color: var(--danger); font-weight: bold;" id="rejectedCount">0</div>
                            </div>
                            <div class="admin-card-content">
                                <h3>Permohonan Ditolak</h3>
                                <p>Sejak 30 hari lalu</p>
                            </div>
                        </div>
                        
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon" style="background-color: var(--primary);">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div style="font-size: 2rem; color: var(--primary); font-weight: bold;" id="userCount">0</div>
                            </div>
                            <div class="admin-card-content">
                                <h3>Jumlah Pengguna</h3>
                                <p>Akaun berdaftar</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Applications -->
                    <div class="applications-section">
                        <h3 class="section-title"><i class="fas fa-history"></i> Permohonan Terkini</h3>
                        <div class="table-container">
                            <table class="applications-table" id="recentApplicationsTable">
                                <thead>
                                    <tr>
                                        <th>No. Rujukan</th>
                                        <th>Pemohon</th>
                                        <th>Jenis Aset</th>
                                        <th>Tarikh Mohon</th>
                                        <th>Status</th>
                                        <th>Tindakan</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Applications Section -->
                <div id="applicationsSection" class="admin-section">
                    <h2 class="section-title"><i class="fas fa-file-alt"></i> Permohonan Baru</h2>
                    
                    <div class="filter-bar">
                        <div class="filter-controls">
                            <select class="filter-select" id="filterAssetType">
                                <option value="">Semua Jenis Aset</option>
                                <option value="kuarters">Kuarters</option>
                                <option value="pejabat">Pejabat</option>
                                <option value="kedai">Lot Kedai</option>
                                <option value="tanah">Tanah</option>
                            </select>
                            <select class="filter-select" id="filterSort">
                                <option value="newest">Terbaru</option>
                                <option value="oldest">Terlama</option>
                            </select>
                        </div>
                        <input type="text" class="search-box" id="searchApplications" placeholder="Cari pemohon atau no. rujukan...">
                    </div>
                    
                    <div class="table-container">
                        <table class="applications-table" id="newApplicationsTable">
                            <thead>
                                <tr>
                                    <th>No. Rujukan</th>
                                    <th>Pemohon</th>
                                    <th>No. KP</th>
                                    <th>Jenis Aset</th>
                                    <th>Lokasi</th>
                                    <th>Tarikh Mohon</th>
                                    <th>Tindakan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="noApplicationsMessage" style="text-align: center; padding: 3rem; display: none;">
                        <i class="fas fa-inbox" style="font-size: 3rem; color: var(--light-gray); margin-bottom: 1rem;"></i>
                        <h3>Tiada Permohonan Baru</h3>
                        <p>Tidak ada permohonan baru yang menunggu kelulusan.</p>
                    </div>
                </div>
                
                <!-- Processed Applications Section -->
                <div id="processedSection" class="admin-section">
                    <h2 class="section-title"><i class="fas fa-check-circle"></i> Permohonan Diproses</h2>
                    
                    <div class="filter-bar">
                        <div class="filter-controls">
                            <select class="filter-select" id="filterProcessedStatus">
                                <option value="">Semua Status</option>
                                <option value="approved">Diluluskan</option>
                                <option value="rejected">Ditolak</option>
                            </select>
                            <input type="date" class="filter-select" id="filterProcessedDate">
                        </div>
                        <input type="text" class="search-box" id="searchProcessed" placeholder="Cari pemohon atau no. rujukan...">
                    </div>
                    
                    <div class="table-container">
                        <table class="applications-table" id="processedApplicationsTable">
                            <thead>
                                <tr>
                                    <th>No. Rujukan</th>
                                    <th>Pemohon</th>
                                    <th>Jenis Aset</th>
                                    <th>Tarikh Mohon</th>
                                    <th>Tarikh Proses</th>
                                    <th>Status</th>
                                    <th>Diluluskan Oleh</th>
                                    <th>Tindakan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Users Section -->
                <div id="usersSection" class="admin-section">
                    <h2 class="section-title"><i class="fas fa-users"></i> Pengguna Berdaftar</h2>
                    
                    <div class="filter-bar">
                        <div class="filter-controls">
                            <select class="filter-select" id="filterUserType">
                                <option value="">Semua Jenis</option>
                                <option value="staff">Kakitangan</option>
                                <option value="public">Orang Awam</option>
                            </select>
                            <select class="filter-select" id="filterUserStatus">
                                <option value="">Semua Status</option>
                                <option value="active">Aktif</option>
                                <option value="inactive">Tidak Aktif</option>
                            </select>
                        </div>
                        <input type="text" class="search-box" id="searchUsers" placeholder="Cari nama atau email...">
                    </div>
                    
                    <div class="table-container">
                        <table class="applications-table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>No. KP</th>
                                    <th>Email</th>
                                    <th>Jenis</th>
                                    <th>Daftar Pada</th>
                                    <th>Jumlah Permohonan</th>
                                    <th>Status</th>
                                    <th>Tindakan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Assets Management Section -->
                <div id="assetsSection" class="admin-section">
                    <h2 class="section-title"><i class="fas fa-building"></i> Pengurusan Aset</h2>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3>Senarai Aset Tersedia</h3>
                        <button class="btn" id="addAssetBtn" style="background-color: var(--success); color: white;">
                            <i class="fas fa-plus"></i> Tambah Aset
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="applications-table" id="assetsTable">
                            <thead>
                                <tr>
                                    <th>Nama Aset</th>
                                    <th>Jenis</th>
                                    <th>Lokasi</th>
                                    <th>Jumlah Unit</th>
                                    <th>Unit Tersedia</th>
                                    <th>Sewa Bulanan</th>
                                    <th>Status</th>
                                    <th>Tindakan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Reports Section -->
                <div id="reportsSection" class="admin-section">
                    <h2 class="section-title"><i class="fas fa-chart-bar"></i> Laporan dan Analitik</h2>
                    
                    <div class="admin-cards">
                        <div class="admin-card" style="grid-column: span 2;">
                            <h3 style="margin-bottom: 1rem;">Statistik Permohonan (30 Hari)</h3>
                            <div id="applicationsChart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: var(--gray);">
                                <p>Graf akan dipaparkan di sini</p>
                            </div>
                        </div>
                        
                        <div class="admin-card">
                            <h3 style="margin-bottom: 1rem;">Statistik Pengguna</h3>
                            <div id="usersChart" style="height: 250px; display: flex; align-items: center; justify-content: center; color: var(--gray);">
                                <p>Graf akan dipaparkan di sini</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="applications-section" style="margin-top: 2rem;">
                        <h3 style="margin-bottom: 1rem;">Eksport Data</h3>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button class="btn" id="exportApplicationsBtn">
                                <i class="fas fa-file-export"></i> Eksport Permohonan
                            </button>
                            <button class="btn" id="exportUsersBtn">
                                <i class="fas fa-file-export"></i> Eksport Pengguna
                            </button>
                            <button class="btn" id="exportAssetsBtn">
                                <i class="fas fa-file-export"></i> Eksport Aset
                            </button>
                            <button class="btn" style="background-color: var(--primary); color: white;" id="generateReportBtn">
                                <i class="fas fa-file-pdf"></i> Jana Laporan Bulanan
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- View Application Modal -->
    <div class="modal" id="viewApplicationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-alt"></i> Maklumat Permohonan</h3>
                <button class="close-modal" id="closeViewModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="application-details" id="applicationDetails">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <div class="approval-form" id="approvalForm">
                    <h4 style="margin-bottom: 1rem; color: var(--primary);">Kelulusan Permohonan</h4>
                    <div class="form-group">
                        <label for="approvalStatus" class="form-label">Status Kelulusan</label>
                        <select id="approvalStatus" class="form-control">
                            <option value="processing">Dalam Proses</option>
                            <option value="approved">Lulus</option>
                            <option value="rejected">Tolak</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="approvalNotes" class="form-label">Catatan (Jika Ada)</label>
                        <textarea id="approvalNotes" class="form-control" placeholder="Masukkan catatan untuk pemohon..."></textarea>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn" id="cancelView">Batal</button>
                <button type="button" class="btn" id="saveDraftBtn" style="background-color: var(--warning); color: white;">Simpan Draft</button>
                <button type="button" class="btn btn-approve" id="submitApproval">Hantar Keputusan</button>
            </div>
        </div>
    </div>
    
    <!-- View User Modal -->
    <div class="modal" id="viewUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> Maklumat Pengguna</h3>
                <button class="close-modal" id="closeUserModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="application-details" id="userDetails">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: var(--primary);">Sejarah Permohonan</h4>
                    <div class="table-container">
                        <table class="applications-table" id="userApplicationsTable" style="font-size: 0.9rem;">
                            <thead>
                                <tr>
                                    <th>No. Rujukan</th>
                                    <th>Jenis Aset</th>
                                    <th>Tarikh Mohon</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn" id="closeUserBtn">Tutup</button>
                <button type="button" class="btn" style="background-color: var(--warning); color: white;" id="editUserBtn">Edit Pengguna</button>
                <button type="button" class="btn btn-approve" id="toggleUserStatusBtn">Kemaskini Status</button>
            </div>
        </div>
    </div>
    
    <!-- Asset Management Modal -->
    <div class="modal" id="assetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-building"></i> Pengurusan Aset</h3>
                <button class="close-modal" id="closeAssetModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="assetForm">
                    <div class="form-group">
                        <label for="assetName" class="form-label">Nama Aset</label>
                        <input type="text" id="assetName" class="form-control" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <label for="assetType" class="form-label">Jenis Aset</label>
                            <select id="assetType" class="form-control" required>
                                <option value="kuarters">Kuarters</option>
                                <option value="pejabat">Pejabat</option>
                                <option value="kedai">Lot Kedai</option>
                                <option value="tanah">Tanah</option>
                                <option value="rumah_rehat">Rumah Rehat</option>
                                <option value="bilik">Bilik Sejuk</option>
                                <option value="slipway">Slipway</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="assetLocation" class="form-label">Lokasi</label>
                            <input type="text" id="assetLocation" class="form-control" required>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <label for="totalUnits" class="form-label">Jumlah Unit</label>
                            <input type="number" id="totalUnits" class="form-control" required min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="availableUnits" class="form-label">Unit Tersedia</label>
                            <input type="number" id="availableUnits" class="form-control" required min="0">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <label for="monthlyRent" class="form-label">Sewa Bulanan (RM)</label>
                            <input type="number" id="monthlyRent" class="form-control" required min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="assetStatus" class="form-label">Status</label>
                            <select id="assetStatus" class="form-control" required>
                                <option value="available">Tersedia</option>
                                <option value="limited">Terhad</option>
                                <option value="unavailable">Tidak Tersedia</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="assetDescription" class="form-label">Penerangan</label>
                        <textarea id="assetDescription" class="form-control" rows="4"></textarea>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn" id="cancelAsset">Batal</button>
                <button type="button" class="btn btn-approve" id="saveAsset">Simpan Aset</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // DATA STORAGE AND CONSTANTS
        // ============================================
        
        // Storage Keys (Matching User System)
        const USER_DB_KEY = 'asset_rental_users';
        const APPLICATIONS_KEY = 'user_applications';
        const ASSETS_KEY = 'asset_data';
        const ADMIN_KEY = 'admin_data';
        const ADMIN_SESSION_KEY = 'current_admin';
        
        // Admin Credentials
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'admin123',
            name: 'Pentadbir Sistem',
            role: 'Super Admin'
        };
        
        // Global Variables
        let currentAdmin = null;
        let applications = [];
        let users = [];
        let assets = [];
        let currentApplicationId = null;
        let currentUserId = null;
        let currentAssetId = null;
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeAdminSystem();
            setupEventListeners();
            checkAdminLoginStatus();
            startRealTimeSync();
        });
        
        function initializeAdminSystem() {
            // Load data from localStorage
            loadApplications();
            loadUsers();
            loadAssets();
            
            // Initialize admin account if not exists
            const storedAdmin = localStorage.getItem(ADMIN_KEY);
            if (!storedAdmin) {
                localStorage.setItem(ADMIN_KEY, JSON.stringify(ADMIN_CREDENTIALS));
            }
        }
        
        function loadApplications() {
            const storedApps = localStorage.getItem(APPLICATIONS_KEY);
            applications = storedApps ? JSON.parse(storedApps) : [];
        }
        
        function loadUsers() {
            const storedUsers = localStorage.getItem(USER_DB_KEY);
            users = storedUsers ? JSON.parse(storedUsers) : [];
        }
        
        function loadAssets() {
            const storedAssets = localStorage.getItem(ASSETS_KEY);
            assets = storedAssets ? JSON.parse(storedAssets) : [];
        }
        
        function checkAdminLoginStatus() {
            const storedAdmin = sessionStorage.getItem(ADMIN_SESSION_KEY);
            
            if (storedAdmin) {
                currentAdmin = JSON.parse(storedAdmin);
                showAdminDashboard();
            } else {
                showAdminLogin();
            }
        }
        
        // ============================================
        // REAL-TIME SYNC WITH USER SYSTEM
        // ============================================
        
        function startRealTimeSync() {
            // Poll for new applications every 5 seconds
            setInterval(() => {
                if (currentAdmin) {
                    loadApplications(); // Reload applications from localStorage
                    updateDashboardCounters();
                    renderNewApplications();
                    updateNewAppBadge();
                }
            }, 5000); // Check every 5 seconds
            
            // Listen for storage events (cross-tab communication)
            window.addEventListener('storage', function(e) {
                if (e.key === APPLICATIONS_KEY && currentAdmin) {
                    loadApplications();
                    updateDashboardCounters();
                    renderNewApplications();
                    updateNewAppBadge();
                    showNotification('Permohonan baru diterima!', 'info');
                }
            });
        }
        
        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        
        function showAdminLogin() {
            document.getElementById('adminAuthPage').style.display = 'flex';
            document.getElementById('adminContainer').style.display = 'none';
        }
        
        function showAdminDashboard() {
            document.getElementById('adminAuthPage').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            
            updateAdminInterface();
            updateDashboardCounters();
            renderRecentApplications();
            renderNewApplications();
            renderProcessedApplications();
            renderUsers();
            renderAssets();
        }
        
        function handleAdminLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            // Validate credentials
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                currentAdmin = ADMIN_CREDENTIALS;
                sessionStorage.setItem(ADMIN_SESSION_KEY, JSON.stringify(currentAdmin));
                showAdminDashboard();
                showNotification('Log masuk berjaya!', 'success');
            } else {
                showNotification('Username atau kata laluan tidak betul!', 'error');
            }
        }
        
        function handleAdminLogout() {
            if (confirm('Adakah anda pasti ingin log keluar?')) {
                sessionStorage.removeItem(ADMIN_SESSION_KEY);
                currentAdmin = null;
                showAdminLogin();
            }
        }
        
        // ============================================
        // DASHBOARD FUNCTIONS
        // ============================================
        
        function updateAdminInterface() {
            if (!currentAdmin) return;
            
            document.getElementById('adminName').textContent = currentAdmin.name;
            document.getElementById('adminAvatar').textContent = currentAdmin.name.charAt(0);
        }
        
        function updateDashboardCounters() {
            // Count pending applications
            const pendingCount = applications.filter(app => app.status === 'processing').length;
            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('newAppBadge').textContent = pendingCount;
            
            // Count approved applications (last 30 days)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const approvedCount = applications.filter(app => 
                app.status === 'approved' && 
                new Date(app.processedDate || app.applyDate) >= thirtyDaysAgo
            ).length;
            document.getElementById('approvedCount').textContent = approvedCount;
            
            // Count rejected applications (last 30 days)
            const rejectedCount = applications.filter(app => 
                app.status === 'rejected' && 
                new Date(app.processedDate || app.applyDate) >= thirtyDaysAgo
            ).length;
            document.getElementById('rejectedCount').textContent = rejectedCount;
            
            // Count total users
            document.getElementById('userCount').textContent = users.length;
        }
        
        function renderRecentApplications() {
            const tableBody = document.querySelector('#recentApplicationsTable tbody');
            tableBody.innerHTML = '';
            
            // Get 5 most recent applications
            const recentApps = [...applications]
                .sort((a, b) => new Date(b.applyDate) - new Date(a.applyDate))
                .slice(0, 5);
            
            if (recentApps.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: var(--gray);">
                            Tiada permohonan terkini
                        </td>
                    </tr>
                `;
                return;
            }
            
            recentApps.forEach(app => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${app.reference}</td>
                    <td>${app.applicantName}</td>
                    <td>${app.assetName}</td>
                    <td>${formatDate(app.applyDate)}</td>
                    <td><span class="status-badge status-${app.status}">${app.statusText || app.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-view view-application-btn" data-id="${app.id}">
                            <i class="fas fa-eye"></i> Lihat
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-application-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    viewApplication(appId);
                });
            });
        }
        
        // ============================================
        // APPLICATIONS MANAGEMENT
        // ============================================
        
        function renderNewApplications() {
            const tableBody = document.querySelector('#newApplicationsTable tbody');
            const noAppsMessage = document.getElementById('noApplicationsMessage');
            
            // Filter pending applications
            const pendingApps = applications.filter(app => app.status === 'processing');
            
            if (pendingApps.length === 0) {
                tableBody.innerHTML = '';
                noAppsMessage.style.display = 'block';
                return;
            }
            
            noAppsMessage.style.display = 'none';
            tableBody.innerHTML = '';
            
            pendingApps.forEach(app => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${app.reference}</td>
                    <td>${app.applicantName}</td>
                    <td>${formatIC(app.applicantIC || '')}</td>
                    <td>${app.assetName}</td>
                    <td>${app.location}</td>
                    <td>${formatDate(app.applyDate)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-view view-application-btn" data-id="${app.id}">
                                <i class="fas fa-eye"></i> Lihat
                            </button>
                            <button class="btn btn-sm btn-approve approve-application-btn" data-id="${app.id}">
                                <i class="fas fa-check"></i> Lulus
                            </button>
                            <button class="btn btn-sm btn-reject reject-application-btn" data-id="${app.id}">
                                <i class="fas fa-times"></i> Tolak
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners
            document.querySelectorAll('.view-application-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    viewApplication(appId);
                });
            });
            
            document.querySelectorAll('.approve-application-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    approveApplication(appId);
                });
            });
            
            document.querySelectorAll('.reject-application-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    rejectApplication(appId);
                });
            });
        }
        
        function renderProcessedApplications() {
            const tableBody = document.querySelector('#processedApplicationsTable tbody');
            tableBody.innerHTML = '';
            
            // Filter processed applications (approved or rejected)
            const processedApps = applications.filter(app => 
                app.status === 'approved' || app.status === 'rejected'
            );
            
            if (processedApps.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray);">
                            Tiada permohonan diproses
                        </td>
                    </tr>
                `;
                return;
            }
            
            processedApps.forEach(app => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${app.reference}</td>
                    <td>${app.applicantName}</td>
                    <td>${app.assetName}</td>
                    <td>${formatDate(app.applyDate)}</td>
                    <td>${app.processedDate ? formatDate(app.processedDate) : '-'}</td>
                    <td><span class="status-badge status-${app.status}">${app.statusText || app.status}</span></td>
                    <td>${app.processedBy || 'Sistem'}</td>
                    <td>
                        <button class="btn btn-sm btn-view view-application-btn" data-id="${app.id}">
                            <i class="fas fa-eye"></i> Lihat
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-application-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    viewApplication(appId);
                });
            });
        }
        
        function viewApplication(appId) {
            const application = applications.find(app => app.id == appId);
            if (!application) return;
            
            currentApplicationId = appId;
            
            // Populate application details
            const detailsContainer = document.getElementById('applicationDetails');
            detailsContainer.innerHTML = `
                <div class="detail-item">
                    <span class="detail-label">No. Rujukan:</span>
                    <span class="detail-value">${application.reference}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Nama Pemohon:</span>
                    <span class="detail-value">${application.applicantName}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">No. Kad Pengenalan:</span>
                    <span class="detail-value">${formatIC(application.applicantIC || '')}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">${application.applicantEmail || 'Tiada'}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Telefon:</span>
                    <span class="detail-value">${formatPhone(application.applicantPhone || '')}</span>
                </div>
                <div class="detail-item" style="grid-column: span 2;">
                    <span class="detail-label">Jenis Aset:</span>
                    <span class="detail-value">${application.assetName} - ${application.location}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Tarikh Mohon:</span>
                    <span class="detail-value">${formatDate(application.applyDate)}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Status Semasa:</span>
                    <span class="detail-value">
                        <span class="status-badge status-${application.status}">
                            ${application.statusText || application.status}
                        </span>
                    </span>
                </div>
                <div class="detail-item" style="grid-column: span 2;">
                    <span class="detail-label">Tujuan Permohonan:</span>
                    <span class="detail-value">${application.purpose || 'Tiada maklumat'}</span>
                </div>
                ${application.approvalNotes ? `
                <div class="detail-item" style="grid-column: span 2;">
                    <span class="detail-label">Catatan Kelulusan:</span>
                    <span class="detail-value">${application.approvalNotes}</span>
                </div>
                ` : ''}
            `;
            
            // Set current status in dropdown
            document.getElementById('approvalStatus').value = application.status;
            document.getElementById('approvalNotes').value = application.approvalNotes || '';
            
            // Show modal
            document.getElementById('viewApplicationModal').style.display = 'flex';
        }
        
        function approveApplication(appId) {
            if (confirm('Adakah anda pasti ingin meluluskan permohonan ini?')) {
                processApplication(appId, 'approved', 'Permohonan diluluskan');
            }
        }
        
        function rejectApplication(appId) {
            if (confirm('Adakah anda pasti ingin menolak permohonan ini?')) {
                processApplication(appId, 'rejected', 'Permohonan ditolak');
            }
        }
        
        function processApplication(appId, status, statusText) {
            const application = applications.find(app => app.id == appId);
            if (!application) return;
            
            // Update application
            application.status = status;
            application.statusText = statusText;
            application.processedDate = new Date().toISOString().split('T')[0];
            application.processedBy = currentAdmin.name;
            
            // Update asset availability if approved
            if (status === 'approved') {
                const asset = assets.find(a => a.type === application.assetType);
                if (asset && asset.availableUnits > 0) {
                    asset.availableUnits -= 1;
                    localStorage.setItem(ASSETS_KEY, JSON.stringify(assets));
                }
            }
            
            // Save to localStorage
            localStorage.setItem(APPLICATIONS_KEY, JSON.stringify(applications));
            
            // Update UI
            updateDashboardCounters();
            renderNewApplications();
            renderProcessedApplications();
            renderRecentApplications();
            renderAssets();
            
            // Show notification
            showNotification(`Permohonan ${status === 'approved' ? 'diluluskan' : 'ditolak'}!`, 'success');
            
            // Close modal if open
            closeModal('viewApplicationModal');
        }
        
        function submitApproval() {
            const status = document.getElementById('approvalStatus').value;
            const notes = document.getElementById('approvalNotes').value;
            
            if (!currentApplicationId) return;
            
            const application = applications.find(app => app.id == currentApplicationId);
            if (!application) return;
            
            // Update application
            application.status = status;
            application.approvalNotes = notes;
            application.processedDate = new Date().toISOString().split('T')[0];
            application.processedBy = currentAdmin.name;
            
            // Set status text based on status
            let statusText = '';
            if (status === 'approved') {
                statusText = 'Permohonan diluluskan';
                // Update asset availability
                const asset = assets.find(a => a.type === application.assetType);
                if (asset && asset.availableUnits > 0) {
                    asset.availableUnits -= 1;
                    localStorage.setItem(ASSETS_KEY, JSON.stringify(assets));
                }
            } else if (status === 'rejected') {
                statusText = 'Permohonan ditolak';
            } else {
                statusText = 'Dalam proses';
            }
            application.statusText = statusText;
            
            // Save to localStorage
            localStorage.setItem(APPLICATIONS_KEY, JSON.stringify(applications));
            
            // Update UI
            updateDashboardCounters();
            renderNewApplications();
            renderProcessedApplications();
            renderRecentApplications();
            renderAssets();
            
            // Show notification
            showNotification('Keputusan permohonan berjaya disimpan!', 'success');
            
            // Close modal
            closeModal('viewApplicationModal');
        }
        
        // ============================================
        // USERS MANAGEMENT
        // ============================================
        
        function renderUsers() {
            const tableBody = document.querySelector('#usersTable tbody');
            tableBody.innerHTML = '';
            
            if (users.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray);">
                            Tiada pengguna berdaftar
                        </td>
                    </tr>
                `;
                return;
            }
            
            users.forEach(user => {
                // Count user applications
                const userApps = applications.filter(app => app.applicantId === user.id);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${formatIC(user.ic)}</td>
                    <td>${user.email}</td>
                    <td>${user.userType === 'staff' ? 'Kakitangan' : 'Orang Awam'}</td>
                    <td>${formatDate(user.createdAt)}</td>
                    <td>${userApps.length}</td>
                    <td>
                        <span class="status-badge ${user.status === 'active' ? 'status-approved' : 'status-rejected'}">
                            ${user.status === 'active' ? 'Aktif' : 'Tidak Aktif'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-view view-user-btn" data-id="${user.id}">
                            <i class="fas fa-eye"></i> Lihat
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-user-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-id');
                    viewUser(userId);
                });
            });
        }
        
        function viewUser(userId) {
            const user = users.find(u => u.id == userId);
            if (!user) return;
            
            currentUserId = userId;
            
            // Populate user details
            const detailsContainer = document.getElementById('userDetails');
            detailsContainer.innerHTML = `
                <div class="detail-item">
                    <span class="detail-label">Nama:</span>
                    <span class="detail-value">${user.name}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">No. Kad Pengenalan:</span>
                    <span class="detail-value">${formatIC(user.ic)}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">${user.email}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Telefon:</span>
                    <span class="detail-value">${formatPhone(user.phone)}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Jenis Pengguna:</span>
                    <span class="detail-value">${user.userType === 'staff' ? 'Kakitangan Kerajaan' : 'Orang Awam'}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Jabatan:</span>
                    <span class="detail-value">${user.department || 'Tiada'}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Daftar Pada:</span>
                    <span class="detail-value">${formatDate(user.createdAt)}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value">
                        <span class="status-badge ${user.status === 'active' ? 'status-approved' : 'status-rejected'}">
                            ${user.status === 'active' ? 'Aktif' : 'Tidak Aktif'}
                        </span>
                    </span>
                </div>
            `;
            
            // Populate user applications
            const userAppsTable = document.querySelector('#userApplicationsTable tbody');
            userAppsTable.innerHTML = '';
            
            const userApplications = applications.filter(app => app.applicantId == userId);
            
            if (userApplications.length === 0) {
                userAppsTable.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 1rem; color: var(--gray);">
                            Tiada permohonan
                        </td>
                    </tr>
                `;
            } else {
                userApplications.forEach(app => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${app.reference}</td>
                        <td>${app.assetName}</td>
                        <td>${formatDate(app.applyDate)}</td>
                        <td><span class="status-badge status-${app.status}">${app.statusText || app.status}</span></td>
                    `;
                    userAppsTable.appendChild(row);
                });
            }
            
            // Update toggle button text
            document.getElementById('toggleUserStatusBtn').textContent = 
                user.status === 'active' ? 'Sekat Akaun' : 'Aktifkan Akaun';
            
            // Show modal
            document.getElementById('viewUserModal').style.display = 'flex';
        }
        
        function toggleUserStatus() {
            if (!currentUserId) return;
            
            const user = users.find(u => u.id == currentUserId);
            if (!user) return;
            
            const newStatus = user.status === 'active' ? 'inactive' : 'active';
            const action = newStatus === 'active' ? 'aktifkan' : 'sekat';
            
            if (confirm(`Adakah anda pasti ingin ${action} akaun ini?`)) {
                user.status = newStatus;
                localStorage.setItem(USER_DB_KEY, JSON.stringify(users));
                
                showNotification(`Akaun berjaya ${newStatus === 'active' ? 'diaktifkan' : 'disekat'}!`, 'success');
                renderUsers();
                closeModal('viewUserModal');
            }
        }
        
        // ============================================
        // ASSETS MANAGEMENT
        // ============================================
        
        function renderAssets() {
            const tableBody = document.querySelector('#assetsTable tbody');
            tableBody.innerHTML = '';
            
            if (assets.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray);">
                            Tiada aset berdaftar
                        </td>
                    </tr>
                `;
                return;
            }
            
            assets.forEach(asset => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${asset.name}</td>
                    <td>${getAssetTypeText(asset.type)}</td>
                    <td>${asset.location}</td>
                    <td>${asset.totalUnits}</td>
                    <td>${asset.availableUnits}</td>
                    <td>${asset.monthlyRent}</td>
                    <td>
                        <span class="status-badge ${getAssetStatusClass(asset.availableUnits, asset.totalUnits)}">
                            ${getAssetStatusText(asset.availableUnits, asset.totalUnits)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-view edit-asset-btn" data-id="${asset.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-asset-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const assetId = this.getAttribute('data-id');
                    editAsset(assetId);
                });
            });
        }
        
        function getAssetTypeText(type) {
            const types = {
                'kuarters': 'Kuarters',
                'pejabat': 'Pejabat',
                'kedai': 'Lot Kedai',
                'tanah': 'Tanah',
                'rumah_rehat': 'Rumah Rehat',
                'bilik': 'Bilik Sejuk'
            };
            return types[type] || type;
        }
        
        function getAssetStatusClass(available, total) {
            if (available === 0) return 'status-rejected';
            if (available <= total * 0.2) return 'status-processing'; // Less than 20% available
            return 'status-approved';
        }
        
        function getAssetStatusText(available, total) {
            if (available === 0) return 'Tiada Unit';
            if (available <= total * 0.2) return 'Terhad';
            return 'Tersedia';
        }
        
        function editAsset(assetId) {
            const asset = assets.find(a => a.id == assetId);
            if (!asset) return;
            
            currentAssetId = assetId;
            
            // Populate form
            document.getElementById('assetName').value = asset.name;
            document.getElementById('assetType').value = asset.type;
            document.getElementById('assetLocation').value = asset.location;
            document.getElementById('totalUnits').value = asset.totalUnits;
            document.getElementById('availableUnits').value = asset.availableUnits;
            document.getElementById('monthlyRent').value = asset.monthlyRent?.replace('RM ', '') || '';
            document.getElementById('assetStatus').value = getAssetStatusValue(asset.availableUnits, asset.totalUnits);
            document.getElementById('assetDescription').value = asset.description || '';
            
            // Show modal
            document.getElementById('assetModal').style.display = 'flex';
        }
        
        function getAssetStatusValue(available, total) {
            if (available === 0) return 'unavailable';
            if (available <= total * 0.2) return 'limited';
            return 'available';
        }
        
        function saveAsset() {
            const assetData = {
                id: currentAssetId || Date.now(),
                name: document.getElementById('assetName').value,
                type: document.getElementById('assetType').value,
                location: document.getElementById('assetLocation').value,
                totalUnits: parseInt(document.getElementById('totalUnits').value),
                availableUnits: parseInt(document.getElementById('availableUnits').value),
                monthlyRent: `RM ${document.getElementById('monthlyRent').value}`,
                description: document.getElementById('assetDescription').value,
                icon: getAssetIcon(document.getElementById('assetType').value),
                color: getAssetColor(document.getElementById('assetType').value)
            };
            
            if (currentAssetId) {
                // Update existing asset
                const index = assets.findIndex(a => a.id == currentAssetId);
                if (index !== -1) {
                    assets[index] = { ...assets[index], ...assetData };
                }
            } else {
                // Add new asset
                assets.push(assetData);
            }
            
            // Save to localStorage
            localStorage.setItem(ASSETS_KEY, JSON.stringify(assets));
            
            // Update UI
            renderAssets();
            
            // Show notification
            showNotification(`Aset ${currentAssetId ? 'dikemaskini' : 'ditambah'}!`, 'success');
            
            // Close modal and reset
            closeModal('assetModal');
            resetAssetForm();
        }
        
        function getAssetIcon(type) {
            const icons = {
                'kuarters': 'fas fa-home',
                'pejabat': 'fas fa-building',
                'kedai': 'fas fa-store',
                'tanah': 'fas fa-map-marked-alt',
                'rumah_rehat': 'fas fa-umbrella-beach',
                'bilik': 'fas fa-door-closed'
            };
            return icons[type] || 'fas fa-building';
        }
        
        function getAssetColor(type) {
            const colors = {
                'kuarters': '#9b59b6',
                'pejabat': '#3498db',
                'kedai': '#f39c12',
                'tanah': '#2ecc71',
                'rumah_rehat': '#e74c3c',
                'bilik': '#7f8c8d'
            };
            return colors[type] || '#3498db';
        }
        
        function resetAssetForm() {
            currentAssetId = null;
            document.getElementById('assetForm').reset();
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ms-MY', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }
        
        function formatIC(ic) {
            if (!ic) return '-';
            const str = ic.toString();
            if (str.length === 12) {
                return str.substring(0, 6) + '-' + str.substring(6, 8) + '-' + str.substring(8);
            }
            return str;
        }
        
        function formatPhone(phone) {
            if (!phone) return '-';
            const str = phone.toString();
            if (str.length === 10) {
                return str.substring(0, 3) + '-' + str.substring(3, 6) + ' ' + str.substring(6);
            } else if (str.length === 11) {
                return str.substring(0, 3) + '-' + str.substring(3, 7) + ' ' + str.substring(7);
            }
            return str;
        }
        
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function updateNewAppBadge() {
            const pendingCount = applications.filter(app => app.status === 'processing').length;
            const badge = document.getElementById('newAppBadge');
            badge.textContent = pendingCount;
            
            // Add animation if new applications
            if (pendingCount > 0) {
                badge.style.animation = 'none';
                setTimeout(() => {
                    badge.style.animation = 'pulse 1s';
                }, 10);
            }
        }
        
        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        
        function setupEventListeners() {
            // Admin Login
            document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
            
            // Admin Logout
            document.getElementById('adminLogoutBtn').addEventListener('click', handleAdminLogout);
            
            // Sidebar Navigation
            document.querySelectorAll('.admin-sidebar-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active state
                    document.querySelectorAll('.admin-sidebar-menu a').forEach(a => {
                        a.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Show corresponding section
                    const section = this.getAttribute('data-section');
                    document.querySelectorAll('.admin-section').forEach(s => {
                        s.classList.remove('active');
                    });
                    document.getElementById(`${section}Section`).classList.add('active');
                });
            });
            
            // Modal Close Buttons
            document.getElementById('closeViewModal').addEventListener('click', () => closeModal('viewApplicationModal'));
            document.getElementById('cancelView').addEventListener('click', () => closeModal('viewApplicationModal'));
            
            document.getElementById('closeUserModal').addEventListener('click', () => closeModal('viewUserModal'));
            document.getElementById('closeUserBtn').addEventListener('click', () => closeModal('viewUserModal'));
            
            document.getElementById('closeAssetModal').addEventListener('click', () => {
                closeModal('assetModal');
                resetAssetForm();
            });
            document.getElementById('cancelAsset').addEventListener('click', () => {
                closeModal('assetModal');
                resetAssetForm();
            });
            
            // Application Approval
            document.getElementById('submitApproval').addEventListener('click', submitApproval);
            
            // User Management
            document.getElementById('toggleUserStatusBtn').addEventListener('click', toggleUserStatus);
            
            // Asset Management
            document.getElementById('addAssetBtn').addEventListener('click', function() {
                resetAssetForm();
                document.getElementById('assetModal').style.display = 'flex';
            });
            
            document.getElementById('saveAsset').addEventListener('click', saveAsset);
            
            // Reports
            document.getElementById('exportApplicationsBtn').addEventListener('click', function() {
                exportToCSV(applications, 'permohonan');
            });
            
            document.getElementById('exportUsersBtn').addEventListener('click', function() {
                exportToCSV(users, 'pengguna');
            });
            
            document.getElementById('exportAssetsBtn').addEventListener('click', function() {
                exportToCSV(assets, 'aset');
            });
            
            document.getElementById('generateReportBtn').addEventListener('click', function() {
                generateMonthlyReport();
            });
            
            // Filter Events
            document.getElementById('filterAssetType').addEventListener('change', filterNewApplications);
            document.getElementById('filterSort').addEventListener('change', filterNewApplications);
            document.getElementById('searchApplications').addEventListener('input', filterNewApplications);
            
            document.getElementById('filterProcessedStatus').addEventListener('change', filterProcessedApplications);
            document.getElementById('filterProcessedDate').addEventListener('change', filterProcessedApplications);
            document.getElementById('searchProcessed').addEventListener('input', filterProcessedApplications);
            
            document.getElementById('filterUserType').addEventListener('change', filterUsers);
            document.getElementById('filterUserStatus').addEventListener('change', filterUsers);
            document.getElementById('searchUsers').addEventListener('input', filterUsers);
        }
        
        function filterNewApplications() {
            const typeFilter = document.getElementById('filterAssetType').value;
            const sortFilter = document.getElementById('filterSort').value;
            const searchFilter = document.getElementById('searchApplications').value.toLowerCase();
            
            let filteredApps = applications.filter(app => app.status === 'processing');
            
            // Filter by asset type
            if (typeFilter) {
                filteredApps = filteredApps.filter(app => app.assetType === typeFilter);
            }
            
            // Filter by search
            if (searchFilter) {
                filteredApps = filteredApps.filter(app => 
                    app.applicantName.toLowerCase().includes(searchFilter) ||
                    app.reference.toLowerCase().includes(searchFilter)
                );
            }
            
            // Sort
            if (sortFilter === 'newest') {
                filteredApps.sort((a, b) => new Date(b.applyDate) - new Date(a.applyDate));
            } else {
                filteredApps.sort((a, b) => new Date(a.applyDate) - new Date(b.applyDate));
            }
            
            // Render filtered applications
            renderFilteredApplications(filteredApps);
        }
        
        function renderFilteredApplications(filteredApps) {
            const tableBody = document.querySelector('#newApplicationsTable tbody');
            const noAppsMessage = document.getElementById('noApplicationsMessage');
            
            if (filteredApps.length === 0) {
                tableBody.innerHTML = '';
                noAppsMessage.style.display = 'block';
                return;
            }
            
            noAppsMessage.style.display = 'none';
            tableBody.innerHTML = '';
            
            filteredApps.forEach(app => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${app.reference}</td>
                    <td>${app.applicantName}</td>
                    <td>${formatIC(app.applicantIC || '')}</td>
                    <td>${app.assetName}</td>
                    <td>${app.location}</td>
                    <td>${formatDate(app.applyDate)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-view view-application-btn" data-id="${app.id}">
                                <i class="fas fa-eye"></i> Lihat
                            </button>
                            <button class="btn btn-sm btn-approve approve-application-btn" data-id="${app.id}">
                                <i class="fas fa-check"></i> Lulus
                            </button>
                            <button class="btn btn-sm btn-reject reject-application-btn" data-id="${app.id}">
                                <i class="fas fa-times"></i> Tolak
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Re-add event listeners
            document.querySelectorAll('.view-application-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    viewApplication(appId);
                });
            });
            
            document.querySelectorAll('.approve-application-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    approveApplication(appId);
                });
            });
            
            document.querySelectorAll('.reject-application-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    rejectApplication(appId);
                });
            });
        }
        
        function filterProcessedApplications() {
            // Similar implementation for processed applications
            // (Implementation omitted for brevity)
        }
        
        function filterUsers() {
            // Similar implementation for users
            // (Implementation omitted for brevity)
        }
        
        function exportToCSV(data, filename) {
            if (data.length === 0) {
                showNotification('Tiada data untuk dieksport', 'error');
                return;
            }
            
            // Convert data to CSV
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => JSON.stringify(row[header] || '')).join(','))
            ].join('\n');
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showNotification('Data berjaya dieksport', 'success');
        }
        
        function generateMonthlyReport() {
            // Generate monthly report
            const month = new Date().getMonth() + 1;
            const year = new Date().getFullYear();
            
            // Filter applications for current month
            const monthlyApps = applications.filter(app => {
                const appDate = new Date(app.applyDate);
                return appDate.getMonth() + 1 === month && appDate.getFullYear() === year;
            });
            
            const stats = {
                total: monthlyApps.length,
                approved: monthlyApps.filter(app => app.status === 'approved').length,
                rejected: monthlyApps.filter(app => app.status === 'rejected').length,
                pending: monthlyApps.filter(app => app.status === 'processing').length
            };
            
            // Create report content
            const report = `
LAPORAN BULANAN SEWAAN ASET KERAJAAN
Bulan: ${month}/${year}

STATISTIK PERMOHONAN:
Jumlah Permohonan: ${stats.total}
Diluluskan: ${stats.approved}
Ditolak: ${stats.rejected}
Dalam Proses: ${stats.pending}

STATISTIK PENGGUNA:
Jumlah Pengguna: ${users.length}
Kakitangan: ${users.filter(u => u.userType === 'staff').length}
Orang Awam: ${users.filter(u => u.userType === 'public').length}

STATISTIK ASET:
Jumlah Aset: ${assets.length}
Unit Tersedia: ${assets.reduce((sum, a) => sum + a.availableUnits, 0)}
Unit Disewa: ${assets.reduce((sum, a) => sum + (a.totalUnits - a.availableUnits), 0)}

Dihasilkan pada: ${new Date().toLocaleString('ms-MY')}
Oleh: ${currentAdmin.name}
            `;
            
            // Create PDF download
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Laporan_${month}_${year}.txt`;
            link.click();
            
            showNotification('Laporan bulanan dijana', 'success');
        }
        
        // Add CSS animation for badge pulse
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
