<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Register - Portal Sewaan Aset</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a5f7a;
            --secondary: #57c5b6;
            --accent: #159895;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Auth Container */
        .auth-container {
            display: flex;
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }
        
        /* Left Panel - Info */
        .auth-info {
            flex: 1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .auth-info:before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }
        
        .logo i {
            font-size: 2.5rem;
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .features {
            position: relative;
            z-index: 1;
            margin-top: 30px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }
        
        .feature-text h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .feature-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Right Panel - Forms */
        .auth-forms {
            flex: 1;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .form-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-title h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .form-title p {
            color: var(--gray);
        }
        
        /* Tabs */
        .form-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }
        
        .tab-btn.active {
            color: var(--primary);
        }
        
        .tab-btn.active:after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary);
        }
        
        /* Forms */
        .form {
            display: none;
        }
        
        .form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .required:after {
            content: '*';
            color: var(--danger);
            margin-left: 3px;
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 15px 14px 45px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            font-size: 0.9rem;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .forgot-password {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .forgot-password:hover {
            text-decoration: underline;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #144c63;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-google {
            background-color: white;
            color: var(--dark);
            border: 1px solid #ddd;
            margin-top: 15px;
        }
        
        .btn-google:hover {
            background-color: #f8f9fa;
            border-color: #ccc;
        }
        
        .btn-google img {
            width: 20px;
            height: 20px;
        }
        
        .divider {
            text-align: center;
            margin: 25px 0;
            position: relative;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .divider:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 45%;
            height: 1px;
            background-color: var(--light-gray);
        }
        
        .divider:after {
            content: '';
            position: absolute;
            top: 50%;
            right: 0;
            width: 45%;
            height: 1px;
            background-color: var(--light-gray);
        }
        
        .form-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .form-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        /* User Type Selection */
        .user-type-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .user-type-option {
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .user-type-option:hover {
            border-color: var(--secondary);
            background-color: rgba(87, 197, 182, 0.05);
        }
        
        .user-type-option.selected {
            border-color: var(--primary);
            background-color: rgba(26, 95, 122, 0.05);
        }
        
        .user-type-option i {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .user-type-option h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .user-type-option p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Validation Messages */
        .validation-message {
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .validation-message.error {
            color: var(--danger);
            display: block;
        }
        
        .validation-message.success {
            color: var(--success);
            display: block;
        }
        
        /* Success Message */
        .success-message {
            text-align: center;
            padding: 30px;
            display: none;
        }
        
        .success-message.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background-color: rgba(40, 167, 69, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            color: var(--success);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .auth-container {
                flex-direction: column;
                min-height: auto;
            }
            
            .auth-info {
                padding: 30px;
            }
            
            .auth-forms {
                padding: 30px;
            }
        }
        
        @media (max-width: 576px) {
            body {
                padding: 10px;
            }
            
            .auth-container {
                border-radius: 15px;
            }
            
            .auth-info, .auth-forms {
                padding: 25px 20px;
            }
            
            .user-type-selection {
                grid-template-columns: 1fr;
            }
            
            .form-options {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="auth-container">
            <!-- Left Panel - Info -->
            <div class="auth-info">
                <div class="logo">
                    <i class="fas fa-building"></i>
                    <div class="logo-text">
                        <h1>Portal Sewaan Aset</h1>
                        <p>Kementerian/Kerajaan Negeri</p>
                    </div>
                </div>
                
                <div class="features">
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="feature-text">
                            <h4>181 Unit Kuarters</h4>
                            <p>49 unit masih tersedia untuk disewa</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="feature-text">
                            <h4>Permohonan Online</h4>
                            <p>Mohon sewaan aset secara digital</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="feature-text">
                            <h4>Autocount Real-time</h4>
                            <p>Status kekosongan dikemas kini automatik</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Forms -->
            <div class="auth-forms">
                <div class="form-container">
                    <!-- Tabs -->
                    <div class="form-tabs">
                        <button class="tab-btn active" id="loginTab">Log Masuk</button>
                        <button class="tab-btn" id="registerTab">Daftar Akaun</button>
                    </div>
                    
                    <!-- Login Form -->
                    <form class="form active" id="loginForm">
                        <div class="form-title">
                            <h2>Log Masuk</h2>
                            <p>Sila masukkan maklumat akaun anda</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="loginEmail" class="required">Email atau No. KP</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user input-icon"></i>
                                <input type="text" id="loginEmail" class="form-control" placeholder="cth: user@email.com atau 800101011234" required>
                            </div>
                            <div class="validation-message" id="loginEmailError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="loginPassword" class="required">Kata Laluan</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock input-icon"></i>
                                <input type="password" id="loginPassword" class="form-control" placeholder="Masukkan kata laluan" required>
                                <button type="button" class="password-toggle" id="toggleLoginPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="validation-message" id="loginPasswordError"></div>
                        </div>
                        
                        <div class="form-options">
                            <div class="remember-me">
                                <input type="checkbox" id="rememberMe">
                                <label for="rememberMe">Ingat saya</label>
                            </div>
                            <a href="#" class="forgot-password" id="forgotPasswordLink">Lupa kata laluan?</a>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Log Masuk
                        </button>
                        
                        <div class="divider">atau log masuk dengan</div>
                        
                        <button type="button" class="btn btn-google" id="googleLogin">
                            <i class="fab fa-google"></i> Google
                        </button>
                        
                        <div class="form-footer">
                            Tiada akaun? <a href="#" id="goToRegister">Daftar di sini</a>
                        </div>
                    </form>
                    
                    <!-- Register Form -->
                    <form class="form" id="registerForm">
                        <div class="form-title">
                            <h2>Daftar Akaun Baru</h2>
                            <p>Sila isi maklumat di bawah</p>
                        </div>
                        
                        <!-- User Type Selection -->
                        <div class="user-type-selection">
                            <div class="user-type-option selected" data-type="staff">
                                <i class="fas fa-user-tie"></i>
                                <h4>Kakitangan Kerajaan</h4>
                                <p>Untuk permohonan kuarters</p>
                            </div>
                            <div class="user-type-option" data-type="public">
                                <i class="fas fa-users"></i>
                                <h4>Orang Awam</h4>
                                <p>Untuk sewaan aset lain</p>
                            </div>
                        </div>
                        <input type="hidden" id="userType" value="staff">
                        
                        <div class="form-group">
                            <label for="registerName" class="required">Nama Penuh</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user input-icon"></i>
                                <input type="text" id="registerName" class="form-control" placeholder="Masukkan nama penuh" required>
                            </div>
                            <div class="validation-message" id="registerNameError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="registerIC" class="required">No. Kad Pengenalan</label>
                            <div class="input-with-icon">
                                <i class="fas fa-id-card input-icon"></i>
                                <input type="text" id="registerIC" class="form-control" placeholder="cth: 800101011234" required>
                            </div>
                            <div class="validation-message" id="registerICError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="registerEmail" class="required">Alamat Email</label>
                            <div class="input-with-icon">
                                <i class="fas fa-envelope input-icon"></i>
                                <input type="email" id="registerEmail" class="form-control" placeholder="cth: user@email.com" required>
                            </div>
                            <div class="validation-message" id="registerEmailError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="registerPhone" class="required">No. Telefon</label>
                            <div class="input-with-icon">
                                <i class="fas fa-phone input-icon"></i>
                                <input type="tel" id="registerPhone" class="form-control" placeholder="cth: 0123456789" required>
                            </div>
                            <div class="validation-message" id="registerPhoneError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="registerPassword" class="required">Kata Laluan</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock input-icon"></i>
                                <input type="password" id="registerPassword" class="form-control" placeholder="Minimum 8 aksara" required>
                                <button type="button" class="password-toggle" id="toggleRegisterPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="validation-message" id="registerPasswordError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="registerConfirmPassword" class="required">Sahkan Kata Laluan</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock input-icon"></i>
                                <input type="password" id="registerConfirmPassword" class="form-control" placeholder="Masukkan semula kata laluan" required>
                                <button type="button" class="password-toggle" id="toggleConfirmPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="validation-message" id="registerConfirmPasswordError"></div>
                        </div>
                        
                        <div class="form-group">
                            <div style="display: flex; align-items: start; gap: 10px;">
                                <input type="checkbox" id="agreeTerms" required style="margin-top: 3px;">
                                <label for="agreeTerms" style="margin-bottom: 0; font-size: 0.9rem;">
                                    Saya bersetuju dengan <a href="#" style="color: var(--primary);">Terma & Syarat</a> dan <a href="#" style="color: var(--primary);">Dasar Privasi</a>
                                </label>
                            </div>
                            <div class="validation-message" id="termsError"></div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i> Daftar Akaun
                        </button>
                        
                        <div class="form-footer">
                            Sudah ada akaun? <a href="#" id="goToLogin">Log masuk di sini</a>
                        </div>
                    </form>
                    
                    <!-- Success Message (Shown after registration) -->
                    <div class="success-message" id="successMessage">
                        <div class="success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h2>Pendaftaran Berjaya!</h2>
                        <p>Akaun anda telah berjaya didaftarkan. Sila log masuk untuk menggunakan sistem.</p>
                        <button class="btn btn-primary" id="goToLoginFromSuccess" style="margin-top: 20px;">
                            <i class="fas fa-sign-in-alt"></i> Log Masuk Sekarang
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // User Database (LocalStorage)
        const USERS_KEY = 'asset_rental_users';
        const CURRENT_USER_KEY = 'current_user';
        const TEMP_USER_DATA_KEY = 'temp_user_data'; // Untuk bawa data ke dashboard
        
        // Initialize users database
        let users = JSON.parse(localStorage.getItem(USERS_KEY)) || [
            {
                id: 1,
                name: "Admin Sistem",
                ic: "800101011234",
                email: "admin@email.com",
                phone: "0123456789",
                password: "admin123",
                userType: "admin",
                department: "Pentadbiran",
                createdAt: "2023-10-01",
                status: "active"
            },
            {
                id: 2,
                name: "Ahmad bin Ali",
                ic: "850505011234",
                email: "ahmad@email.com",
                phone: "0123456789",
                password: "password123",
                userType: "staff",
                department: "Jabatan Kerja Raya",
                createdAt: "2023-10-15",
                status: "active"
            }
        ];
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Save initial users to localStorage
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
            
            setupEventListeners();
            
            // Check URL parameters for auto redirect
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            if (tab === 'register') {
                switchTab('register');
            }
        });
        
        // Setup all event listeners
        function setupEventListeners() {
            // Tab switching
            document.getElementById('loginTab').addEventListener('click', () => switchTab('login'));
            document.getElementById('registerTab').addEventListener('click', () => switchTab('register'));
            document.getElementById('goToRegister').addEventListener('click', (e) => {
                e.preventDefault();
                switchTab('register');
            });
            document.getElementById('goToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                switchTab('login');
            });
            document.getElementById('goToLoginFromSuccess').addEventListener('click', (e) => {
                e.preventDefault();
                switchTab('login');
            });
            
            // Password toggles
            document.getElementById('toggleLoginPassword').addEventListener('click', togglePasswordVisibility.bind(null, 'loginPassword'));
            document.getElementById('toggleRegisterPassword').addEventListener('click', togglePasswordVisibility.bind(null, 'registerPassword'));
            document.getElementById('toggleConfirmPassword').addEventListener('click', togglePasswordVisibility.bind(null, 'registerConfirmPassword'));
            
            // User type selection
            document.querySelectorAll('.user-type-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.user-type-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    document.getElementById('userType').value = this.dataset.type;
                });
            });
            
            // Form submissions
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            
            // Forgot password link
            document.getElementById('forgotPasswordLink').addEventListener('click', function(e) {
                e.preventDefault();
                showForgotPasswordModal();
            });
            
            // Google login (demo)
            document.getElementById('googleLogin').addEventListener('click', function() {
                demoGoogleLogin();
            });
            
            // Real-time validation
            setupRealTimeValidation();
        }
        
        // Switch between login and register tabs
        function switchTab(tabName) {
            // Update tabs
            document.getElementById('loginTab').classList.remove('active');
            document.getElementById('registerTab').classList.remove('active');
            
            if (tabName === 'login') {
                document.getElementById('loginTab').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
                document.getElementById('registerForm').classList.remove('active');
                document.getElementById('successMessage').classList.remove('active');
            } else {
                document.getElementById('registerTab').classList.add('active');
                document.getElementById('loginForm').classList.remove('active');
                document.getElementById('registerForm').classList.add('active');
                document.getElementById('successMessage').classList.remove('active');
            }
        }
        
        // Toggle password visibility
        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const toggleBtn = document.getElementById(`toggle${fieldId.charAt(0).toUpperCase() + fieldId.slice(1)}`);
            
            if (field.type === 'password') {
                field.type = 'text';
                toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                field.type = 'password';
                toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }
        
        // Handle login submission
        function handleLogin(e) {
            e.preventDefault();
            
            const identifier = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Validate
            if (!validateLoginForm()) {
                return;
            }
            
            // Find user by email or IC
            const user = users.find(u => 
                u.email === identifier || u.ic === identifier.replace(/-/g, '')
            );
            
            if (!user) {
                showError('loginEmailError', 'Akaun tidak ditemui');
                return;
            }
            
            if (user.password !== password) {
                showError('loginPasswordError', 'Kata laluan tidak betul');
                return;
            }
            
            // Login successful - Save user data
            const userSession = {
                id: user.id,
                name: user.name,
                email: user.email,
                ic: user.ic,
                phone: user.phone,
                userType: user.userType,
                department: user.department || '',
                loginTime: new Date().toISOString(),
                rememberMe: rememberMe
            };
            
            // Save to localStorage and sessionStorage
            sessionStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userSession));
            
            if (rememberMe) {
                localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userSession));
            }
            
            // Save user data to temp storage for dashboard
            localStorage.setItem(TEMP_USER_DATA_KEY, JSON.stringify({
                ...userSession,
                fromLogin: true,
                welcomeMessage: `Selamat datang kembali, ${user.name}!`
            }));
            
            // Redirect to dashboard
            redirectToDashboard(userSession);
        }
        
        // Handle registration submission
        function handleRegister(e) {
            e.preventDefault();
            
            // Validate form
            if (!validateRegisterForm()) {
                return;
            }
            
            // Check terms agreement
            const agreeTerms = document.getElementById('agreeTerms').checked;
            if (!agreeTerms) {
                showError('termsError', 'Anda mesti bersetuju dengan terma dan syarat');
                return;
            }
            
            // Get form values
            const userData = {
                id: generateUserId(),
                name: document.getElementById('registerName').value.trim(),
                ic: document.getElementById('registerIC').value.replace(/[-\s]/g, ''),
                email: document.getElementById('registerEmail').value.trim(),
                phone: document.getElementById('registerPhone').value.replace(/[-\s]/g, ''),
                password: document.getElementById('registerPassword').value,
                userType: document.getElementById('userType').value,
                department: getUserDepartment(),
                createdAt: new Date().toISOString(),
                status: 'active',
                profileComplete: false // Flag untuk profile completion
            };
            
            // Add user to database
            users.push(userData);
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
            
            // Create user session
            const userSession = {
                id: userData.id,
                name: userData.name,
                email: userData.email,
                ic: userData.ic,
                phone: userData.phone,
                userType: userData.userType,
                department: userData.department,
                loginTime: new Date().toISOString(),
                isNewUser: true
            };
            
            // Save session
            sessionStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userSession));
            
            // Save EXTENSIVE user data to temp storage for dashboard
            localStorage.setItem(TEMP_USER_DATA_KEY, JSON.stringify({
                ...userSession,
                fromRegistration: true,
                registrationDate: userData.createdAt,
                fullRegistrationData: userData,
                welcomeMessage: `Selamat datang ke Portal Sewaan Aset, ${userData.name}!`,
                showTutorial: true,
                userPreferences: {
                    notifications: true,
                    emailUpdates: true,
                    defaultAssetType: userData.userType === 'staff' ? 'kuarters' : 'pejabat'
                }
            }));
            
            // Show success message with auto redirect
            showRegistrationSuccess(userData.name);
        }
        
        // Redirect to dashboard with user data
        function redirectToDashboard(userSession) {
            // Prepare welcome message
            let welcomeMessage = `Selamat datang, ${userSession.name}!`;
            
            // Update temp data with login-specific info
            const tempData = JSON.parse(localStorage.getItem(TEMP_USER_DATA_KEY) || '{}');
            tempData.lastLogin = new Date().toISOString();
            tempData.loginCount = (tempData.loginCount || 0) + 1;
            localStorage.setItem(TEMP_USER_DATA_KEY, JSON.stringify(tempData));
            
            // Show loading message
            const loginBtn = document.querySelector('#loginForm .btn-primary');
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Membuka dashboard...';
            loginBtn.disabled = true;
            
            // Redirect after delay
            setTimeout(() => {
                // In production, redirect to actual dashboard
                // window.location.href = "dashboard.html";
                
                // For demo, show success and open microsite
                document.getElementById('loginForm').classList.remove('active');
                document.getElementById('successMessage').classList.add('active');
                document.getElementById('successMessage').querySelector('h2').textContent = 'Log Masuk Berjaya!';
                document.getElementById('successMessage').querySelector('p').textContent = welcomeMessage;
                
                // Update success button
                const successBtn = document.getElementById('goToLoginFromSuccess');
                successBtn.innerHTML = '<i class="fas fa-arrow-right"></i> Terus ke Dashboard';
                successBtn.onclick = function() {
                    openDashboard(userSession);
                };
                
                // Reset login button
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }, 1500);
        }
        
        // Open dashboard/microsite
        function openDashboard(userSession) {
            // Open the microsite in new tab with user data
            const userDataString = encodeURIComponent(JSON.stringify(userSession));
            
            // Create a form to pass data (alternative method)
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'dashboard.html';
            form.target = '_blank';
            
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'userData';
            input.value = JSON.stringify(userSession);
            form.appendChild(input);
            
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
            
            // Alternative: Open with URL parameters (limited by URL length)
            // window.open(`dashboard.html?user=${userDataString}`, '_blank');
            
            // For this demo, we'll open the microsite-user.html
            // In production, you would pass the user data properly
            window.open('index.html', '_blank');
        }
        
        // Show registration success
        function showRegistrationSuccess(userName) {
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('successMessage').classList.add('active');
            
            // Update success message
            document.getElementById('successMessage').querySelector('h2').textContent = 'Pendaftaran Berjaya!';
            document.getElementById('successMessage').querySelector('p').innerHTML = `
                Tahniah <strong>${userName}</strong>!<br>
                Akaun anda telah berjaya didaftarkan.
            `;
            
            // Update button
            const successBtn = document.getElementById('goToLoginFromSuccess');
            successBtn.innerHTML = '<i class="fas fa-arrow-right"></i> Terus ke Dashboard';
            successBtn.onclick = function() {
                // Get the newly registered user
                const newUser = users[users.length - 1];
                const userSession = {
                    id: newUser.id,
                    name: newUser.name,
                    email: newUser.email,
                    ic: newUser.ic,
                    phone: newUser.phone,
                    userType: newUser.userType,
                    department: newUser.department,
                    loginTime: new Date().toISOString(),
                    isNewUser: true
                };
                
                openDashboard(userSession);
            };
        }
        
        // Validation functions
        function validateLoginForm() {
            let isValid = true;
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email) {
                showError('loginEmailError', 'Sila masukkan email atau No. KP');
                isValid = false;
            } else {
                clearError('loginEmailError');
            }
            
            if (!password) {
                showError('loginPasswordError', 'Sila masukkan kata laluan');
                isValid = false;
            } else {
                clearError('loginPasswordError');
            }
            
            return isValid;
        }
        
        function validateRegisterForm() {
            let isValid = true;
            
            // Validate each field
            const validations = [
                validateField('registerName', validateName, 'Sila masukkan nama penuh'),
                validateField('registerIC', validateIC, 'No. KP tidak sah'),
                validateField('registerEmail', validateEmail, 'Email tidak sah'),
                validateField('registerPhone', validatePhone, 'No. telefon tidak sah'),
                validateField('registerPassword', validatePassword, 'Kata laluan tidak sah'),
                validateField('registerConfirmPassword', validateConfirmPassword, 'Kata laluan tidak sepadan')
            ];
            
            return validations.every(v => v === true);
        }
        
        function validateField(fieldId, validationFn, errorMessage) {
            const field = document.getElementById(fieldId);
            const value = field.value.trim();
            const errorId = `${fieldId}Error`;
            
            if (!value) {
                showError(errorId, 'Field ini diperlukan');
                return false;
            }
            
            if (!validationFn(value)) {
                showError(errorId, errorMessage);
                return false;
            }
            
            clearError(errorId);
            return true;
        }
        
        function validateName(name) {
            return name.length >= 3 && name.length <= 100;
        }
        
        function validateIC(ic) {
            const cleanIC = ic.replace(/[-\s]/g, '');
            return /^\d{12}$/.test(cleanIC);
        }
        
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function validatePhone(phone) {
            const cleanPhone = phone.replace(/[-\s]/g, '');
            return /^[0-9]{10,11}$/.test(cleanPhone);
        }
        
        function validatePassword(password) {
            return password.length >= 8 && /[A-Z]/.test(password) && /[a-z]/.test(password) && /\d/.test(password);
        }
        
        function validateConfirmPassword(confirmPassword) {
            const password = document.getElementById('registerPassword').value;
            return confirmPassword === password;
        }
        
        function setupRealTimeValidation() {
            // Login form
            document.getElementById('loginEmail').addEventListener('input', () => clearError('loginEmailError'));
            document.getElementById('loginPassword').addEventListener('input', () => clearError('loginPasswordError'));
            
            // Register form
            document.getElementById('registerName').addEventListener('input', () => clearError('registerNameError'));
            document.getElementById('registerIC').addEventListener('input', () => clearError('registerICError'));
            document.getElementById('registerEmail').addEventListener('input', () => clearError('registerEmailError'));
            document.getElementById('registerPhone').addEventListener('input', () => clearError('registerPhoneError'));
            document.getElementById('registerPassword').addEventListener('input', () => {
                clearError('registerPasswordError');
                // Also validate confirm password if it has value
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                if (confirmPassword) {
                    validateConfirmPassword(confirmPassword) ? 
                        clearError('registerConfirmPasswordError') : 
                        showError('registerConfirmPasswordError', 'Kata laluan tidak sepadan');
                }
            });
            document.getElementById('registerConfirmPassword').addEventListener('input', () => clearError('registerConfirmPasswordError'));
        }
        
        // Helper functions
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'validation-message error';
        }
        
        function clearError(elementId) {
            const element = document.getElementById(elementId);
            element.textContent = '';
            element.className = 'validation-message';
        }
        
        function generateUserId() {
            return 'USER_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function getUserDepartment() {
            const userType = document.getElementById('userType').value;
            if (userType === 'staff') {
                return document.getElementById('registerName').value.includes('JKR') ? 'Jabatan Kerja Raya' : 'Pentadbiran';
            }
            return 'Orang Awam';
        }
        
        function showForgotPasswordModal() {
            const email = prompt('Masukkan email anda untuk reset kata laluan:');
            if (email) {
                const user = users.find(u => u.email === email);
                if (user) {
                    alert(`Arahan reset kata laluan telah dihantar ke ${email}\n\nUntuk demo, kata laluan anda: ${user.password}`);
                } else {
                    alert('Email tidak ditemui dalam sistem.');
                }
            }
        }
        
        function demoGoogleLogin() {
            const demoUser = {
                id: 'GOOGLE_USER',
                name: 'Google User Demo',
                email: 'google.user@example.com',
                userType: 'public',
                loginTime: new Date().toISOString(),
                isGoogleUser: true
            };
            
            sessionStorage.setItem(CURRENT_USER_KEY, JSON.stringify(demoUser));
            localStorage.setItem(TEMP_USER_DATA_KEY, JSON.stringify({
                ...demoUser,
                fromGoogle: true,
                welcomeMessage: 'Log masuk dengan Google berjaya!'
            }));
            
            alert('Log masuk dengan Google berjaya! (Demo)');
            redirectToDashboard(demoUser);
        }
        
        // Export function to check login status (for other pages)
        window.checkLoginStatus = function() {
            const user = JSON.parse(sessionStorage.getItem(CURRENT_USER_KEY) || 
                                   localStorage.getItem(CURRENT_USER_KEY) || 'null');
            return user;
        };
        
        // Export function to logout
        window.logoutUser = function() {
            sessionStorage.removeItem(CURRENT_USER_KEY);
            localStorage.removeItem(CURRENT_USER_KEY);
            localStorage.removeItem(TEMP_USER_DATA_KEY);
            window.location.href = 'login.html';
        };
    </script>
</body>
</html>
