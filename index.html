<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Aset Sewaan - Portal Lengkap</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a5f7a;
            --secondary: #57c5b6;
            --accent: #159895;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --admin-primary: #2c3e50;
            --admin-secondary: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ===== AUTHENTICATION PAGES ===== */
        .auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            padding: 20px;
        }
        
        .auth-container {
            display: flex;
            width: 100%;
            max-width: 1000px;
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }
        
        .auth-left {
            flex: 1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .auth-right {
            flex: 1;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .auth-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }
        
        .auth-logo i {
            font-size: 2.5rem;
        }
        
        .auth-logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .auth-logo-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .auth-features {
            position: relative;
            z-index: 1;
            margin-top: 30px;
        }
        
        .auth-feature {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .auth-feature-icon {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }
        
        .auth-feature-text h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .auth-feature-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .auth-form-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .auth-title {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-title h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .auth-title p {
            color: var(--gray);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }
        
        .auth-tab.active {
            color: var(--primary);
        }
        
        .auth-tab.active:after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .auth-form-group {
            margin-bottom: 20px;
        }
        
        .auth-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .required:after {
            content: '*';
            color: var(--danger);
            margin-left: 3px;
        }
        
        .auth-input-with-icon {
            position: relative;
        }
        
        .auth-input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .auth-input {
            width: 100%;
            padding: 14px 15px 14px 45px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .auth-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        
        .auth-password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .auth-form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            font-size: 0.9rem;
        }
        
        .auth-btn {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .auth-btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .auth-btn-primary:hover {
            background-color: #144c63;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .auth-btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark);
        }
        
        .auth-btn-secondary:hover {
            background-color: #dde1e6;
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }
        
        .auth-footer a:hover {
            text-decoration: underline;
        }
        
        /* Password Strength Indicator */
        .password-strength {
            margin-top: 8px;
            height: 5px;
            border-radius: 3px;
            background-color: #e9ecef;
            overflow: hidden;
        }
        
        .strength-bar {
            height: 100%;
            width: 0%;
            transition: width 0.3s, background-color 0.3s;
        }
        
        .strength-weak {
            background-color: #dc3545;
            width: 33%;
        }
        
        .strength-medium {
            background-color: #ffc107;
            width: 66%;
        }
        
        .strength-strong {
            background-color: #28a745;
            width: 100%;
        }
        
        .strength-text {
            font-size: 0.8rem;
            margin-top: 5px;
            color: var(--gray);
        }
        
        /* Verification Code Input */
        .verification-code-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .verification-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .verification-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        
        .verification-input.filled {
            border-color: var(--primary);
            background-color: rgba(26, 95, 122, 0.05);
        }
        
        .timer-text {
            text-align: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .timer-text .time-left {
            color: var(--primary);
            font-weight: bold;
        }
        
        .resend-link {
            color: var(--primary);
            cursor: pointer;
            font-weight: 500;
        }
        
        .resend-link:hover {
            text-decoration: underline;
        }
        
        .resend-link.disabled {
            color: var(--gray);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        /* Steps Indicator */
        .steps-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .steps-indicator:before {
            content: '';
            position: absolute;
            top: 15px;
            left: 10%;
            right: 10%;
            height: 2px;
            background-color: var(--light-gray);
            z-index: 1;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--light-gray);
            color: var(--gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        
        .step.active .step-number {
            background-color: var(--primary);
            color: white;
        }
        
        .step.completed .step-number {
            background-color: var(--success);
            color: white;
        }
        
        .step-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-align: center;
        }
        
        .step.active .step-label {
            color: var(--primary);
            font-weight: 500;
        }
        
        /* Back Button */
        .back-button {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .back-button:hover {
            background-color: rgba(26, 95, 122, 0.05);
        }
        
        /* Success Messages */
        .auth-success {
            text-align: center;
            padding: 30px;
            display: none;
        }
        
        .auth-success.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .auth-success-icon {
            width: 80px;
            height: 80px;
            background-color: rgba(40, 167, 69, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            color: var(--success);
        }
        
        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ===== MAIN APPLICATION ===== */
        .app-container {
            display: none;
            min-height: 100vh;
            flex-direction: column;
        }
        
        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .app-logo i {
            font-size: 2.2rem;
        }
        
        .app-logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .app-logo-text p {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: white;
            color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: var(--light);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-outline {
            background-color: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            background-color: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        /* Navigation */
        .app-nav {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 5px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            padding: 15px 20px;
            display: inline-block;
            transition: all 0.3s;
            border-radius: 5px;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background-color: rgba(26, 95, 122, 0.1);
            color: var(--primary);
        }
        
        /* Dashboard */
        .app-main {
            padding: 2rem 0;
            flex-grow: 1;
        }
        
        .welcome-banner {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-type-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Asset Grid */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .section-header h2 {
            font-size: 1.8rem;
            color: var(--primary);
            position: relative;
            padding-left: 15px;
        }
        
        .section-header h2:before {
            content: '';
            position: absolute;
            left: 0;
            top: 5px;
            height: 80%;
            width: 5px;
            background-color: var(--secondary);
            border-radius: 3px;
        }
        
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 3rem;
        }
        
        .asset-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid var(--light-gray);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .asset-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .asset-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-available {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }
        
        .status-limited {
            background-color: rgba(255, 193, 7, 0.15);
            color: #b88b00;
        }
        
        .status-unavailable {
            background-color: rgba(220, 53, 69, 0.15);
            color: var(--danger);
        }
        
        .asset-image {
            height: 180px;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            position: relative;
        }
        
        .asset-image i {
            font-size: 4rem;
            opacity: 0.5;
        }
        
        .asset-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .asset-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .asset-details {
            margin-bottom: 20px;
            flex-grow: 1;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .detail-label {
            color: var(--gray);
        }
        
        .detail-value {
            font-weight: 500;
        }
        
        .asset-actions {
            margin-top: auto;
        }
        
        .btn-block {
            width: 100%;
            justify-content: center;
        }
        
        /* Application Status */
        .status-section {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
        }
        
        .status-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            background-color: var(--light);
            border-left: 5px solid var(--primary);
        }
        
        .status-info h4 {
            margin-bottom: 5px;
        }
        
        .status-info p {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-processing {
            background-color: rgba(255, 193, 7, 0.15);
            color: #b88b00;
        }
        
        .badge-approved {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }
        
        .badge-rejected {
            background-color: rgba(220, 53, 69, 0.15);
            color: var(--danger);
        }
        
        /* Page Content */
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Footer */
        .app-footer {
            background-color: var(--dark);
            color: white;
            padding: 2rem 0;
            margin-top: auto;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* Forgot Password Link */
        .forgot-password-link {
            text-align: center;
            margin-top: 15px;
        }
        
        .forgot-password-link a {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .forgot-password-link a:hover {
            text-decoration: underline;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .assets-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
            }
            
            .auth-left, .auth-right {
                padding: 40px 20px;
            }
            
            .user-type-selection {
                grid-template-columns: 1fr;
            }
            
            .assets-grid {
                grid-template-columns: 1fr;
            }
            
            .verification-code-container {
                gap: 5px;
            }
            
            .verification-input {
                width: 40px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .welcome-banner {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .section-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .nav-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Pages -->
    <div class="auth-page" id="authPage">
        <div class="auth-container">
            <div class="auth-left">
                <div class="auth-logo">
                    <i class="fas fa-building"></i>
                    <div class="auth-logo-text">
                        <h1>Sistem Aset Sewaan</h1>
                        <p>Portal Permohonan & Pengurusan</p>
                    </div>
                </div>
                
                <div class="auth-features">
                    <div class="auth-feature">
                        <div class="auth-feature-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="auth-feature-text">
                            <h4>181 Unit Kuarters</h4>
                            <p>49 unit masih tersedia untuk disewa</p>
                        </div>
                    </div>
                    
                    <div class="auth-feature">
                        <div class="auth-feature-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="auth-feature-text">
                            <h4>Permohonan Online</h4>
                            <p>Hantar permohonan kepada admin</p>
                        </div>
                    </div>
                    
                    <div class="auth-feature">
                        <div class="auth-feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="auth-feature-text">
                            <h4>Autocount Real-time</h4>
                            <p>Status kekosongan dikemas kini automatik</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="auth-right">
                <div class="auth-form-container">
                    <div class="auth-tabs">
                        <button class="auth-tab active" id="loginTab">Log Masuk</button>
                        <button class="auth-tab" id="registerTab">Daftar Akaun</button>
                    </div>
                    
                    <!-- Login Form -->
                    <form class="auth-form active" id="loginForm">
                        <div class="auth-title">
                            <h2>Log Masuk</h2>
                            <p>Sila masukkan maklumat akaun anda</p>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="loginEmail" class="required">Email atau No. KP</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-user auth-input-icon"></i>
                                <input type="text" id="loginEmail" class="auth-input" placeholder="cth: user@email.com atau 800101011234" required>
                            </div>
                            <div class="validation-message" id="loginEmailError"></div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="loginPassword" class="required">Kata Laluan</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-lock auth-input-icon"></i>
                                <input type="password" id="loginPassword" class="auth-input" placeholder="Masukkan kata laluan" required>
                                <button type="button" class="auth-password-toggle" id="toggleLoginPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="validation-message" id="loginPasswordError"></div>
                        </div>
                        
                        <div class="auth-form-options">
                            <div class="auth-remember">
                                <input type="checkbox" id="rememberMe">
                                <label for="rememberMe">Ingat saya</label>
                            </div>
                        </div>
                        
                        <button type="submit" class="auth-btn auth-btn-primary" id="loginSubmitBtn">
                            <i class="fas fa-sign-in-alt"></i> Log Masuk
                        </button>
                        
                        <div class="forgot-password-link">
                            <a href="#" id="forgotPasswordLink">Lupa kata laluan?</a>
                        </div>
                        
                        <div class="auth-footer">
                            Tiada akaun? <a href="#" id="goToRegister">Daftar di sini</a>
                        </div>
                    </form>
                    
                    <!-- Register Form -->
                    <form class="auth-form" id="registerForm">
                        <div class="auth-title">
                            <h2>Daftar Akaun Baru</h2>
                            <p>Sila isi maklumat di bawah</p>
                        </div>
                        
                        <div class="user-type-selection">
                            <div class="user-type-option selected" data-type="staff">
                                <i class="fas fa-user-tie"></i>
                                <h4>Kakitangan Kerajaan</h4>
                                <p>Untuk permohonan kuarters</p>
                            </div>
                            <div class="user-type-option" data-type="public">
                                <i class="fas fa-users"></i>
                                <h4>Orang Awam</h4>
                                <p>Untuk sewaan aset lain</p>
                            </div>
                        </div>
                        <input type="hidden" id="userType" value="staff">
                        
                        <div class="auth-form-group">
                            <label for="registerName" class="required">Nama Penuh</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-user auth-input-icon"></i>
                                <input type="text" id="registerName" class="auth-input" placeholder="Masukkan nama penuh" required>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="registerIC" class="required">No. Kad Pengenalan</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-id-card auth-input-icon"></i>
                                <input type="text" id="registerIC" class="auth-input" placeholder="cth: 800101011234" required>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="registerEmail" class="required">Alamat Email</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-envelope auth-input-icon"></i>
                                <input type="email" id="registerEmail" class="auth-input" placeholder="cth: user@email.com" required>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="registerPassword" class="required">Kata Laluan</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-lock auth-input-icon"></i>
                                <input type="password" id="registerPassword" class="auth-input" placeholder="Minimum 8 aksara" required>
                                <button type="button" class="auth-password-toggle" id="toggleRegisterPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="password-strength" id="passwordStrengthBar">
                                <div class="strength-bar" id="strengthBar"></div>
                            </div>
                            <div class="strength-text" id="passwordStrengthText">Kekuatan kata laluan: Lemah</div>
                        </div>
                        
                        <div class="auth-form-group">
                            <div style="display: flex; align-items: start; gap: 10px;">
                                <input type="checkbox" id="agreeTerms" required style="margin-top: 3px;">
                                <label for="agreeTerms" style="margin-bottom: 0; font-size: 0.9rem;">
                                    Saya bersetuju dengan Terma & Syarat dan Dasar Privasi
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="auth-btn auth-btn-primary" id="registerSubmitBtn">
                            <i class="fas fa-user-plus"></i> Daftar Akaun
                        </button>
                        
                        <div class="auth-footer">
                            Sudah ada akaun? <a href="#" id="goToLogin">Log masuk di sini</a>
                        </div>
                    </form>
                    
                    <!-- Forgot Password Form -->
                    <form class="auth-form" id="forgotPasswordForm">
                        <div class="auth-title">
                            <h2>Lupa Kata Laluan</h2>
                            <p>Sila ikuti langkah-langkah berikut</p>
                        </div>
                        
                        <div class="steps-indicator">
                            <div class="step active" id="step1">
                                <div class="step-number">1</div>
                                <div class="step-label">Email</div>
                            </div>
                            <div class="step" id="step2">
                                <div class="step-number">2</div>
                                <div class="step-label">Kod</div>
                            </div>
                            <div class="step" id="step3">
                                <div class="step-number">3</div>
                                <div class="step-label">Reset</div>
                            </div>
                        </div>
                        
                        <!-- Step 1: Email Verification -->
                        <div class="forgot-step active" id="forgotStep1">
                            <div class="auth-form-group">
                                <label for="forgotEmail" class="required">Alamat Email</label>
                                <div class="auth-input-with-icon">
                                    <i class="fas fa-envelope auth-input-icon"></i>
                                    <input type="email" id="forgotEmail" class="auth-input" placeholder="cth: user@email.com" required>
                                </div>
                                <div class="validation-message" id="forgotEmailError"></div>
                            </div>
                            
                            <button type="button" class="auth-btn auth-btn-primary" id="sendVerificationCode">
                                <i class="fas fa-paper-plane"></i> Hantar Kod Verifikasi
                            </button>
                        </div>
                        
                        <!-- Step 2: Verification Code -->
                        <div class="forgot-step" id="forgotStep2">
                            <button type="button" class="back-button" id="backToStep1">
                                <i class="fas fa-arrow-left"></i> Kembali
                            </button>
                            
                            <div class="auth-form-group">
                                <label for="verificationCode" class="required">Kod Verifikasi 6 Digit</label>
                                <p style="font-size: 0.9rem; color: var(--gray); margin-bottom: 15px;">
                                    Kod verifikasi telah dihantar ke <strong id="verificationEmailDisplay"></strong>
                                </p>
                                
                                <div class="verification-code-container">
                                    <input type="text" class="verification-input" maxlength="1" data-index="0">
                                    <input type="text" class="verification-input" maxlength="1" data-index="1">
                                    <input type="text" class="verification-input" maxlength="1" data-index="2">
                                    <input type="text" class="verification-input" maxlength="1" data-index="3">
                                    <input type="text" class="verification-input" maxlength="1" data-index="4">
                                    <input type="text" class="verification-input" maxlength="1" data-index="5">
                                </div>
                                
                                <input type="hidden" id="verificationCode">
                                
                                <div class="timer-text">
                                    Kod akan tamat dalam: <span class="time-left" id="timeLeft">05:00</span>
                                </div>
                                
                                <div class="timer-text">
                                    Tidak menerima kod? 
                                    <span class="resend-link" id="resendCodeLink">Hantar semula</span>
                                </div>
                                
                                <div class="validation-message" id="verificationCodeError"></div>
                            </div>
                            
                            <button type="button" class="auth-btn auth-btn-primary" id="verifyCodeBtn">
                                <i class="fas fa-check-circle"></i> Sahkan Kod
                            </button>
                        </div>
                        
                        <!-- Step 3: Reset Password -->
                        <div class="forgot-step" id="forgotStep3">
                            <button type="button" class="back-button" id="backToStep2">
                                <i class="fas fa-arrow-left"></i> Kembali
                            </button>
                            
                            <div class="auth-form-group">
                                <label for="newPassword" class="required">Kata Laluan Baru</label>
                                <div class="auth-input-with-icon">
                                    <i class="fas fa-lock auth-input-icon"></i>
                                    <input type="password" id="newPassword" class="auth-input" placeholder="Minimum 8 aksara" required>
                                    <button type="button" class="auth-password-toggle" id="toggleNewPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="password-strength">
                                    <div class="strength-bar" id="newPasswordStrengthBar"></div>
                                </div>
                                <div class="strength-text" id="newPasswordStrengthText">Kekuatan kata laluan: Lemah</div>
                            </div>
                            
                            <div class="auth-form-group">
                                <label for="confirmPassword" class="required">Sahkan Kata Laluan</label>
                                <div class="auth-input-with-icon">
                                    <i class="fas fa-lock auth-input-icon"></i>
                                    <input type="password" id="confirmPassword" class="auth-input" placeholder="Masukkan semula kata laluan" required>
                                    <button type="button" class="auth-password-toggle" id="toggleConfirmPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="validation-message" id="confirmPasswordError"></div>
                            </div>
                            
                            <button type="submit" class="auth-btn auth-btn-primary" id="resetPasswordBtn">
                                <i class="fas fa-key"></i> Reset Kata Laluan
                            </button>
                        </div>
                        
                        <div class="auth-footer">
                            <a href="#" id="backToLoginFromForgot">Kembali ke Log Masuk</a>
                        </div>
                    </form>
                    
                    <!-- Registration Success -->
                    <div class="auth-success" id="registerSuccess">
                        <div class="auth-success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h2>Pendaftaran Berjaya!</h2>
                        <p>Akaun anda telah berjaya didaftarkan.</p>
                        <button class="auth-btn auth-btn-primary" id="goToLoginFromSuccess" style="margin-top: 20px;">
                            <i class="fas fa-sign-in-alt"></i> Log Masuk Sekarang
                        </button>
                    </div>
                    
                    <!-- Password Reset Success -->
                    <div class="auth-success" id="resetSuccess">
                        <div class="auth-success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h2>Kata Laluan Berjaya Direset!</h2>
                        <p>Anda kini boleh log masuk dengan kata laluan baru.</p>
                        <button class="auth-btn auth-btn-primary" id="goToLoginFromReset" style="margin-top: 20px;">
                            <i class="fas fa-sign-in-alt"></i> Log Masuk Sekarang
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header class="app-header">
            <div class="container header-content">
                <div class="app-logo">
                    <i class="fas fa-building"></i>
                    <div class="app-logo-text">
                        <h1>Portal Sewaan Aset</h1>
                        <p>Selamat datang, <span id="headerUserName">Pengguna</span></p>
                    </div>
                </div>
                
                <div class="user-section">
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">P</div>
                        <div>
                            <div class="user-name" id="userName">Pengguna</div>
                            <div class="user-badge" id="userTypeBadge">Kakitangan</div>
                        </div>
                    </div>
                    <button class="btn btn-outline" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Log Keluar
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="app-nav">
            <div class="container nav-container">
                <ul class="nav-links">
                    <li><a href="#" class="active" data-page="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="#" data-page="assets"><i class="fas fa-building"></i> Aset Tersedia</a></li>
                    <li><a href="#" data-page="application"><i class="fas fa-file-alt"></i> Permohonan Saya</a></li>
                    <li><a href="#" data-page="profile"><i class="fas fa-user"></i> Profil Saya</a></li>
                </ul>
                
                <div class="quick-actions">
                    <button class="btn btn-primary" id="newApplicationBtn">
                        <i class="fas fa-plus"></i> Mohon Baru
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="app-main">
            <div class="container">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content active">
                    <div class="welcome-banner">
                        <div class="welcome-content">
                            <h2 id="welcomeTitle">Selamat Datang!</h2>
                            <p id="welcomeMessage">Portal sewaan aset.</p>
                            <span class="user-type-badge" id="userWelcomeBadge">Kakitangan Kerajaan</span>
                        </div>
                        <div style="font-size: 4rem; color: var(--secondary); opacity: 0.7;">
                            <i class="fas fa-hand-wave"></i>
                        </div>
                    </div>
                    
                    <div class="dashboard-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 2rem;">
                        <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                            <div class="card-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                                <div class="card-icon" style="width: 50px; height: 50px; background-color: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div class="card-content">
                                    <h3 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;" id="dashboardTotalQuarters">228</h3>
                                    <p style="color: var(--gray); font-size: 0.9rem;">Jumlah Aset</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                            <div class="card-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                                <div class="card-icon" style="width: 50px; height: 50px; background-color: var(--success); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                    <i class="fas fa-door-open"></i>
                                </div>
                                <div class="card-content">
                                    <h3 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;" id="dashboardAvailableQuarters">49</h3>
                                    <p style="color: var(--gray); font-size: 0.9rem;">Kuarters Tersedia</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                            <div class="card-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                                <div class="card-icon" style="width: 50px; height: 50px; background-color: var(--accent); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="card-content">
                                    <h3 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;" id="dashboardMyApplications">0</h3>
                                    <p style="color: var(--gray); font-size: 0.9rem;">Permohonan Saya</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                            <div class="card-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                                <div class="card-icon" style="width: 50px; height: 50px; background-color: var(--warning); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="card-content">
                                    <h3 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;" id="dashboardPending">0</h3>
                                    <p style="color: var(--gray); font-size: 0.9rem;">Dalam Proses</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-header">
                        <h2>Akses Pantas</h2>
                    </div>
                    
                    <div class="assets-grid" id="quickAccessAssets">
                        <!-- Cards will be loaded here -->
                    </div>
                </div>
                
                <!-- Assets Page -->
                <div id="assetsPage" class="page-content">
                    <div class="section-header">
                        <h2>Aset Tersedia Untuk Disewa</h2>
                        <div>
                            <span id="availableCount">49</span> daripada <span id="totalCount">181</span> unit tersedia
                        </div>
                    </div>
                    
                    <div class="assets-grid" id="assetsGrid">
                        <!-- Assets will be loaded here -->
                    </div>
                </div>
                
                <!-- Application Page -->
                <div id="applicationPage" class="page-content">
                    <div class="section-header">
                        <h2>Permohonan Saya</h2>
                        <button class="btn btn-primary" id="applyNewBtn">
                            <i class="fas fa-plus"></i> Permohonan Baru
                        </button>
                    </div>
                    
                    <div class="status-section">
                        <div class="status-list" id="applicationStatus">
                            <!-- Applications will be loaded here -->
                            <div style="text-align: center; padding: 3rem; color: var(--gray);">
                                <i class="fas fa-file-alt" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                                <h3>Tiada Permohonan</h3>
                                <p>Anda belum membuat sebarang permohonan.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Page -->
                <div id="profilePage" class="page-content">
                    <div class="section-header">
                        <h2>Profil Saya</h2>
                    </div>
                    
                    <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                        <div style="display: flex; align-items: center; gap: 30px; margin-bottom: 2rem;">
                            <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); 
                                border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: white; font-weight: bold;" id="profileAvatar">
                                P
                            </div>
                            <div>
                                <h3 style="color: var(--primary); margin-bottom: 5px;" id="profileName">Nama Pengguna</h3>
                                <p style="color: var(--gray); margin-bottom: 5px;" id="profileEmail">email@example.com</p>
                                <span class="user-type-badge" id="profileTypeBadge">Kakitangan Kerajaan</span>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">No. Kad Pengenalan</label>
                                <div style="font-weight: 500;" id="profileIC">000000000000</div>
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">No. Telefon</label>
                                <div style="font-weight: 500;" id="profilePhone">-</div>
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">Alamat</label>
                                <div style="font-weight: 500;" id="profileAddress">-</div>
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">Ahli Sejak</label>
                                <div style="font-weight: 500;" id="profileSince">-</div>
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">Jumlah Permohonan</label>
                                <div style="font-weight: 500;" id="profileTotalApps">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="app-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>Portal Sewaan Aset</h3>
                        <p>Sistem pengurusan sewaan aset yang efisien dan telus.</p>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Hubungi Admin</h3>
                        <ul class="footer-links" style="list-style: none; color: #ccc;">
                            <li><i class="fas fa-phone"></i> 03-8888 1234</li>
                            <li><i class="fas fa-envelope"></i> admin@aset.gov.my</li>
                            <li><i class="fas fa-clock"></i> Isnin - Jumaat: 8:30am - 5:30pm</li>
                        </ul>
                    </div>
                </div>
                
                <div class="copyright">
                    &copy; 2023 Portal Sewaan Aset. Hak Cipta Terpelihara.
                </div>
            </div>
        </footer>
    </div>

    <script>
        // ============================================
        // DATA STORAGE AND INITIALIZATION
        // ============================================
        
        const STORAGE_KEYS = {
            USERS: 'asset_rental_users',
            CURRENT_USER: 'current_asset_user',
            APPLICATIONS: 'user_applications',
            ASSETS: 'asset_data',
            VACANCIES: 'asset_vacancies',
            VERIFICATION_CODES: 'verification_codes'
        };
        
        // Data untuk demo
        const DEMO_USERS = [
            {
                id: 1,
                name: "Ahmad bin Ali",
                ic: "850505011234",
                email: "ahmad@email.com",
                phone: "0123456789",
                password: "password123",
                userType: "staff",
                typeText: "Kakitangan Kerajaan",
                department: "Jabatan Kerja Raya",
                address: "No 123, Jalan Bunga, 43000 Kajang, Selangor",
                createdAt: "2023-10-01",
                status: "active",
                role: "user"
            },
            {
                id: 2,
                name: "Admin Sistem",
                ic: "900101011234",
                email: "admin@email.com",
                phone: "0123456789",
                password: "admin123",
                userType: "admin",
                typeText: "Pentadbir Sistem",
                department: "Pentadbiran",
                address: "Aras 5, Menara Kerajaan, Putrajaya",
                createdAt: "2023-10-01",
                status: "active",
                role: "admin"
            },
            {
                id: 3,
                name: "Siti binti Hassan",
                ic: "900101011234",
                email: "siti@email.com",
                phone: "0134567890",
                password: "password123",
                userType: "public",
                typeText: "Orang Awam",
                address: "No 45, Taman Mewah, 53100 Kuala Lumpur",
                createdAt: "2023-10-05",
                status: "active",
                role: "user"
            }
        ];
        
        // Asset Data untuk demo
        const ASSETS_DATA = [
            {
                id: 1,
                type: "kuarters",
                name: "Kuarters Kakitangan",
                icon: "fas fa-home",
                color: "#9b59b6",
                description: "Kuarters untuk kakitangan kerajaan dengan kemudahan lengkap. 3 bilik tidur, 2 bilik air, dapur dan ruang tamu.",
                monthlyRent: "RM 450",
                totalUnits: 181,
                availableUnits: 49
            },
            {
                id: 2,
                type: "pejabat",
                name: "Sewa Pejabat",
                icon: "fas fa-building",
                color: "#3498db",
                description: "Pejabat di lokasi strategik dengan kemudahan lengkap termasuk parking, sistem keselamatan dan internet.",
                monthlyRent: "RM 2,500",
                totalUnits: 24,
                availableUnits: 3
            },
            {
                id: 3,
                type: "kedai",
                name: "Lot Kedai",
                icon: "fas fa-store",
                color: "#f39c12",
                description: "Lot kedai di kawasan komersial dengan foot traffic tinggi. Sesuai untuk perniagaan runcit dan servis.",
                monthlyRent: "RM 1,800",
                totalUnits: 15,
                availableUnits: 4
            },
            {
                id: 4,
                type: "tanah",
                name: "Tanah Lot",
                icon: "fas fa-map-marked-alt",
                color: "#2ecc71",
                description: "Tanah lot untuk tujuan perindustrian atau komersial. Lokasi strategik dengan akses jalan raya utama.",
                monthlyRent: "RM 3,200",
                totalUnits: 8,
                availableUnits: 3
            }
        ];
        
        let currentUser = null;
        let users = [];
        let verificationCodes = [];
        let forgotPasswordTimer = null;
        let currentForgotEmail = '';
        let applications = [];
        let assets = ASSETS_DATA;
        
        // Initialize System
        function initializeSystem() {
            // Initialize users
            const storedUsers = localStorage.getItem(STORAGE_KEYS.USERS);
            if (!storedUsers) {
                users = DEMO_USERS;
                localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            } else {
                users = JSON.parse(storedUsers);
            }
            
            // Initialize verification codes
            const storedCodes = localStorage.getItem(STORAGE_KEYS.VERIFICATION_CODES);
            verificationCodes = storedCodes ? JSON.parse(storedCodes) : [];
            
            // Initialize applications
            const storedApps = localStorage.getItem(STORAGE_KEYS.APPLICATIONS);
            applications = storedApps ? JSON.parse(storedApps) : [];
            
            // Initialize assets
            const storedAssets = localStorage.getItem(STORAGE_KEYS.ASSETS);
            if (storedAssets) {
                assets = JSON.parse(storedAssets);
            }
            
            // Check login status
            checkLoginStatus();
        }
        
        function checkLoginStatus() {
            const storedUser = sessionStorage.getItem(STORAGE_KEYS.CURRENT_USER) || 
                              localStorage.getItem(STORAGE_KEYS.CURRENT_USER);
            
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                showApplication();
            } else {
                showAuthentication();
            }
        }
        
        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        
        function showAuthentication() {
            document.getElementById('authPage').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            // Reset to login form by default
            switchAuthTab('login');
        }
        
        function showApplication() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            // Update user interface
            updateUserInterface();
            loadDashboard();
        }
        
        function switchAuthTab(tabName) {
            // Reset all tabs
            document.getElementById('loginTab').classList.remove('active');
            document.getElementById('registerTab').classList.remove('active');
            
            // Hide all forms
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('forgotPasswordForm').classList.remove('active');
            document.getElementById('registerSuccess').classList.remove('active');
            document.getElementById('resetSuccess').classList.remove('active');
            
            // Reset forgot password form if switching away
            if (tabName !== 'forgot') {
                resetForgotPasswordForm();
            }
            
            // Activate selected tab and form
            if (tabName === 'login') {
                document.getElementById('loginTab').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else if (tabName === 'register') {
                document.getElementById('registerTab').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            } else if (tabName === 'forgot') {
                // Forgot password doesn't have a tab, so activate login tab visually
                document.getElementById('loginTab').classList.add('active');
                document.getElementById('forgotPasswordForm').classList.add('active');
            }
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            const identifier = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Simple validation
            if (!identifier || !password) {
                showValidationError('loginEmailError', 'Sila isi semua maklumat');
                return;
            }
            
            // Find user
            const user = users.find(u => 
                u.email === identifier || u.ic === identifier
            );
            
            if (!user) {
                showValidationError('loginEmailError', 'Akaun tidak ditemui');
                return;
            }
            
            if (user.password !== password) {
                showValidationError('loginPasswordError', 'Kata laluan tidak betul');
                return;
            }
            
            // Login successful
            currentUser = {
                id: user.id,
                name: user.name,
                email: user.email,
                phone: user.phone,
                ic: user.ic,
                address: user.address,
                userType: user.userType,
                role: user.role,
                typeText: user.typeText,
                createdAt: user.createdAt
            };
            
            // Save to storage
            sessionStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
            if (rememberMe) {
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
            }
            
            // Show loading state
            const loginBtn = document.getElementById('loginSubmitBtn');
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<div class="loading"></div> Memproses...';
            
            // Show application after short delay
            setTimeout(() => {
                showApplication();
                loginBtn.innerHTML = originalText;
            }, 1000);
        }
        
        function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value.trim();
            const ic = document.getElementById('registerIC').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            
            // Validation
            if (!name || !ic || !email || !password) {
                alert('Sila isi semua maklumat yang diperlukan');
                return;
            }
            
            if (password.length < 8) {
                alert('Kata laluan mesti sekurang-kurangnya 8 aksara');
                return;
            }
            
            // Check if user already exists
            const existingUser = users.find(u => u.email === email || u.ic === ic);
            if (existingUser) {
                alert('Email atau No. KP sudah didaftarkan');
                return;
            }
            
            // Create new user
            const userData = {
                id: users.length + 1,
                name: name,
                ic: ic,
                email: email,
                phone: '0123456789',
                password: password,
                address: 'Alamat belum diisi',
                userType: document.getElementById('userType').value,
                typeText: document.getElementById('userType').value === 'staff' ? 'Kakitangan Kerajaan' : 'Orang Awam',
                createdAt: new Date().toISOString().split('T')[0],
                status: 'active',
                role: 'user'
            };
            
            users.push(userData);
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            
            // Show success message
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('registerSuccess').classList.add('active');
        }
        
        // ============================================
        // APPLICATION FUNCTIONS
        // ============================================
        
        function updateUserInterface() {
            if (!currentUser) return;
            
            // Update header
            document.getElementById('headerUserName').textContent = currentUser.name.split(' ')[0];
            document.getElementById('userAvatar').textContent = getInitials(currentUser.name);
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userTypeBadge').textContent = currentUser.typeText;
            
            // Update welcome message
            document.getElementById('welcomeTitle').textContent = `Selamat Datang, ${currentUser.name.split(' ')[0]}!`;
            document.getElementById('welcomeMessage').textContent = `Anda telah log masuk sebagai ${currentUser.typeText}`;
            document.getElementById('userWelcomeBadge').textContent = currentUser.typeText;
            
            // Update profile
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('profileIC').textContent = currentUser.ic;
            document.getElementById('profilePhone').textContent = currentUser.phone || '-';
            document.getElementById('profileAddress').textContent = currentUser.address || '-';
            document.getElementById('profileSince').textContent = formatDate(currentUser.createdAt);
            document.getElementById('profileAvatar').textContent = getInitials(currentUser.name);
            document.getElementById('profileTypeBadge').textContent = currentUser.typeText;
            
            // Calculate user applications
            const userApps = applications.filter(app => app.applicantId === currentUser.id);
            document.getElementById('profileTotalApps').textContent = userApps.length;
            document.getElementById('dashboardMyApplications').textContent = userApps.length;
            document.getElementById('dashboardPending').textContent = userApps.filter(app => app.status === 'pending').length;
        }
        
        function loadDashboard() {
            // Load quick access assets
            loadQuickAccessAssets();
            
            // Update dashboard stats
            updateDashboardStats();
        }
        
        function updateDashboardStats() {
            // Calculate total available units
            const totalAvailable = assets.reduce((sum, asset) => sum + (asset.availableUnits || 0), 0);
            const totalUnits = assets.reduce((sum, asset) => sum + (asset.totalUnits || 0), 0);
            
            document.getElementById('dashboardTotalQuarters').textContent = totalUnits;
            document.getElementById('dashboardAvailableQuarters').textContent = totalAvailable;
            
            // Calculate user applications
            const userApps = applications.filter(app => app.applicantId === currentUser?.id);
            document.getElementById('dashboardMyApplications').textContent = userApps.length;
            document.getElementById('dashboardPending').textContent = userApps.filter(app => app.status === 'pending').length;
        }
        
        function loadQuickAccessAssets() {
            const assetsGrid = document.getElementById('quickAccessAssets');
            assetsGrid.innerHTML = '';
            
            // Show only first 4 assets for quick access
            const quickAssets = assets.slice(0, 4);
            
            quickAssets.forEach(asset => {
                // Determine status
                let statusClass, statusText;
                if (asset.availableUnits > 3) {
                    statusClass = 'status-available';
                    statusText = `${asset.availableUnits} Tersedia`;
                } else if (asset.availableUnits > 0) {
                    statusClass = 'status-limited';
                    statusText = `${asset.availableUnits} Terhad`;
                } else {
                    statusClass = 'status-unavailable';
                    statusText = 'Tidak Tersedia';
                }
                
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.innerHTML = `
                    <div class="asset-image" style="background-color: ${asset.color}20; color: ${asset.color};">
                        <i class="${asset.icon}"></i>
                        <div class="asset-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    <div class="asset-content">
                        <h3 class="asset-title">${asset.name}</h3>
                        <div class="asset-details">
                            <p>${asset.description}</p>
                            <div class="detail-item">
                                <span class="detail-label">Sewa Bulanan:</span>
                                <span class="detail-value">${asset.monthlyRent}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Unit Tersedia:</span>
                                <span class="detail-value">${asset.availableUnits} / ${asset.totalUnits}</span>
                            </div>
                        </div>
                        <div class="asset-actions">
                            ${asset.availableUnits > 0 ? `
                            <button class="btn btn-primary btn-block apply-now-btn" data-asset-id="${asset.id}">
                                <i class="fas fa-pen"></i> Mohon Sekarang
                            </button>
                            ` : `
                            <button class="btn btn-block" disabled style="background-color: #e9ecef; color: #6c757d; cursor: not-allowed;">
                                <i class="fas fa-times-circle"></i> Tiada Kekosongan
                            </button>
                            `}
                        </div>
                    </div>
                `;
                assetsGrid.appendChild(card);
            });
            
            // Add event listeners to apply buttons
            document.querySelectorAll('.apply-now-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    alert('Fitur permohonan akan datang tidak lama lagi!');
                });
            });
        }
        
        function loadAllAssets() {
            const assetsGrid = document.getElementById('assetsGrid');
            assetsGrid.innerHTML = '';
            
            // Calculate total available units
            const totalAvailable = assets.reduce((sum, asset) => sum + (asset.availableUnits || 0), 0);
            const totalUnits = assets.reduce((sum, asset) => sum + (asset.totalUnits || 0), 0);
            
            document.getElementById('availableCount').textContent = totalAvailable;
            document.getElementById('totalCount').textContent = totalUnits;
            
            assets.forEach(asset => {
                // Determine status
                let statusClass, statusText;
                if (asset.availableUnits > 3) {
                    statusClass = 'status-available';
                    statusText = `${asset.availableUnits} Tersedia`;
                } else if (asset.availableUnits > 0) {
                    statusClass = 'status-limited';
                    statusText = `${asset.availableUnits} Terhad`;
                } else {
                    statusClass = 'status-unavailable';
                    statusText = 'Tidak Tersedia';
                }
                
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.innerHTML = `
                    <div class="asset-image" style="background-color: ${asset.color}20; color: ${asset.color};">
                        <i class="${asset.icon}"></i>
                        <div class="asset-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    <div class="asset-content">
                        <h3 class="asset-title">${asset.name}</h3>
                        <div class="asset-details">
                            <p>${asset.description}</p>
                            <div class="detail-item">
                                <span class="detail-label">Sewa Bulanan:</span>
                                <span class="detail-value">${asset.monthlyRent}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Unit Tersedia:</span>
                                <span class="detail-value">${asset.availableUnits} / ${asset.totalUnits}</span>
                            </div>
                        </div>
                        <div class="asset-actions">
                            ${asset.availableUnits > 0 ? `
                            <button class="btn btn-primary btn-block apply-now-btn" data-asset-id="${asset.id}">
                                <i class="fas fa-pen"></i> Mohon Sekarang
                            </button>
                            ` : `
                            <button class="btn btn-block" disabled style="background-color: #e9ecef; color: #6c757d; cursor: not-allowed;">
                                <i class="fas fa-times-circle"></i> Tiada Kekosongan
                            </button>
                            `}
                        </div>
                    </div>
                `;
                assetsGrid.appendChild(card);
            });
            
            // Add event listeners to apply buttons
            document.querySelectorAll('.apply-now-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    alert('Fitur permohonan akan datang tidak lama lagi!');
                });
            });
        }
        
        function loadUserApplications() {
            const statusList = document.getElementById('applicationStatus');
            const userApps = applications.filter(app => app.applicantId === currentUser?.id);
            
            if (userApps.length === 0) {
                statusList.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--gray);">
                        <i class="fas fa-file-alt" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h3>Tiada Permohonan</h3>
                        <p>Anda belum membuat sebarang permohonan.</p>
                    </div>
                `;
                return;
            }
            
            statusList.innerHTML = '';
            userApps.forEach(app => {
                let badgeClass, badgeText;
                switch(app.status) {
                    case 'pending':
                        badgeClass = 'badge-processing';
                        badgeText = 'Menunggu Admin';
                        break;
                    case 'approved':
                        badgeClass = 'badge-approved';
                        badgeText = 'Diluluskan';
                        break;
                    case 'rejected':
                        badgeClass = 'badge-rejected';
                        badgeText = 'Ditolak';
                        break;
                    default:
                        badgeClass = 'badge-processing';
                        badgeText = 'Dalam Proses';
                }
                
                const item = document.createElement('div');
                item.className = 'status-item';
                item.innerHTML = `
                    <div class="status-info">
                        <h4>${app.assetName}</h4>
                        <p>No. Rujukan: ${app.reference} | Lokasi: ${app.location} | Tarikh: ${formatDate(app.applyDate)}</p>
                    </div>
                    <div class="status-badge ${badgeClass}">${badgeText}</div>
                `;
                statusList.appendChild(item);
            });
        }
        
        // ============================================
        // FORGOT PASSWORD FUNCTIONS
        // ============================================
        
        function resetForgotPasswordForm() {
            // Reset steps
            document.getElementById('forgotStep1').classList.add('active');
            document.getElementById('forgotStep2').classList.remove('active');
            document.getElementById('forgotStep3').classList.remove('active');
            
            // Reset step indicators
            document.getElementById('step1').classList.add('active');
            document.getElementById('step1').classList.remove('completed');
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.remove('completed');
            document.getElementById('step3').classList.remove('active');
            document.getElementById('step3').classList.remove('completed');
            
            // Clear inputs
            document.getElementById('forgotEmail').value = '';
            document.querySelectorAll('.verification-input').forEach(input => {
                input.value = '';
                input.classList.remove('filled');
            });
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            // Clear validation messages
            document.getElementById('forgotEmailError').textContent = '';
            document.getElementById('verificationCodeError').textContent = '';
            document.getElementById('confirmPasswordError').textContent = '';
            
            // Stop timer if running
            if (forgotPasswordTimer) {
                clearInterval(forgotPasswordTimer);
                forgotPasswordTimer = null;
            }
            
            // Reset timer display
            document.getElementById('timeLeft').textContent = '05:00';
            document.getElementById('resendCodeLink').classList.remove('disabled');
        }
        
        function handleForgotPassword() {
            const email = document.getElementById('forgotEmail').value.trim();
            
            if (!email) {
                showValidationError('forgotEmailError', 'Sila masukkan alamat email');
                return;
            }
            
            // Check if email exists
            const user = users.find(u => u.email === email);
            if (!user) {
                showValidationError('forgotEmailError', 'Email tidak ditemui dalam sistem');
                return;
            }
            
            // Save email for later steps
            currentForgotEmail = email;
            
            // Generate verification code
            const code = generateVerificationCode();
            
            // Save code with expiration (5 minutes)
            const verificationData = {
                email: email,
                code: code,
                expiresAt: Date.now() + 5 * 60 * 1000 // 5 minutes
            };
            
            verificationCodes = verificationCodes.filter(v => v.email !== email);
            verificationCodes.push(verificationData);
            localStorage.setItem(STORAGE_KEYS.VERIFICATION_CODES, JSON.stringify(verificationCodes));
            
            // Show step 2
            document.getElementById('forgotStep1').classList.remove('active');
            document.getElementById('forgotStep2').classList.add('active');
            
            // Update step indicators
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');
            
            // Display email
            document.getElementById('verificationEmailDisplay').textContent = email;
            
            // Start timer
            startVerificationTimer();
            
            // In a real application, you would send the code via email
            // For demo purposes, we'll show it in an alert
            alert(`Kod verifikasi: ${code}\n\n(Catatan: Dalam aplikasi sebenar, kod akan dihantar ke email anda)`);
            
            // Auto-focus first verification input
            setTimeout(() => {
                document.querySelector('.verification-input[data-index="0"]').focus();
            }, 100);
        }
        
        function handleVerifyCode() {
            const enteredCode = Array.from(document.querySelectorAll('.verification-input'))
                .map(input => input.value)
                .join('');
            
            if (enteredCode.length !== 6) {
                showValidationError('verificationCodeError', 'Sila masukkan semua 6 digit kod');
                return;
            }
            
            // Find verification data
            const verificationData = verificationCodes.find(v => v.email === currentForgotEmail);
            
            if (!verificationData) {
                showValidationError('verificationCodeError', 'Kod verifikasi tidak sah atau telah tamat');
                return;
            }
            
            // Check if code is expired
            if (Date.now() > verificationData.expiresAt) {
                showValidationError('verificationCodeError', 'Kod verifikasi telah tamat tempoh');
                return;
            }
            
            // Verify code
            if (enteredCode !== verificationData.code) {
                showValidationError('verificationCodeError', 'Kod verifikasi tidak betul');
                return;
            }
            
            // Code is valid, proceed to step 3
            document.getElementById('forgotStep2').classList.remove('active');
            document.getElementById('forgotStep3').classList.add('active');
            
            // Update step indicators
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.add('active');
            
            // Stop timer
            if (forgotPasswordTimer) {
                clearInterval(forgotPasswordTimer);
                forgotPasswordTimer = null;
            }
            
            // Auto-focus new password field
            setTimeout(() => {
                document.getElementById('newPassword').focus();
            }, 100);
        }
        
        function handleResetPassword(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validation
            if (!newPassword || !confirmPassword) {
                showValidationError('confirmPasswordError', 'Sila isi semua maklumat');
                return;
            }
            
            if (newPassword.length < 8) {
                showValidationError('confirmPasswordError', 'Kata laluan mesti sekurang-kurangnya 8 aksara');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showValidationError('confirmPasswordError', 'Kata laluan tidak sepadan');
                return;
            }
            
            // Find user and update password
            const userIndex = users.findIndex(u => u.email === currentForgotEmail);
            if (userIndex === -1) {
                alert('Ralat: Pengguna tidak ditemui');
                return;
            }
            
            // Update password
            users[userIndex].password = newPassword;
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            
            // Remove used verification code
            verificationCodes = verificationCodes.filter(v => v.email !== currentForgotEmail);
            localStorage.setItem(STORAGE_KEYS.VERIFICATION_CODES, JSON.stringify(verificationCodes));
            
            // Show success message
            document.getElementById('forgotPasswordForm').classList.remove('active');
            document.getElementById('resetSuccess').classList.add('active');
            
            // Reset form for next use
            resetForgotPasswordForm();
        }
        
        function generateVerificationCode() {
            // Generate 6-digit random code
            return Math.floor(100000 + Math.random() * 900000).toString();
        }
        
        function startVerificationTimer() {
            let timeLeft = 300; // 5 minutes in seconds
            
            // Update timer immediately
            updateTimerDisplay(timeLeft);
            
            // Start countdown
            forgotPasswordTimer = setInterval(() => {
                timeLeft--;
                
                if (timeLeft <= 0) {
                    clearInterval(forgotPasswordTimer);
                    forgotPasswordTimer = null;
                    document.getElementById('resendCodeLink').classList.add('disabled');
                    showValidationError('verificationCodeError', 'Kod verifikasi telah tamat tempoh');
                }
                
                updateTimerDisplay(timeLeft);
            }, 1000);
        }
        
        function updateTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            document.getElementById('timeLeft').textContent = 
                `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        function resendVerificationCode() {
            const resendLink = document.getElementById('resendCodeLink');
            
            // Prevent multiple clicks
            if (resendLink.classList.contains('disabled')) {
                return;
            }
            
            // Disable temporarily
            resendLink.classList.add('disabled');
            
            // Generate new code
            const code = generateVerificationCode();
            
            // Update verification data
            const verificationIndex = verificationCodes.findIndex(v => v.email === currentForgotEmail);
            if (verificationIndex !== -1) {
                verificationCodes[verificationIndex].code = code;
                verificationCodes[verificationIndex].expiresAt = Date.now() + 5 * 60 * 1000;
                localStorage.setItem(STORAGE_KEYS.VERIFICATION_CODES, JSON.stringify(verificationCodes));
            }
            
            // Restart timer
            if (forgotPasswordTimer) {
                clearInterval(forgotPasswordTimer);
            }
            startVerificationTimer();
            
            // In a real application, resend email
            alert(`Kod verifikasi baru: ${code}\n\n(Catatan: Dalam aplikasi sebenar, kod akan dihantar ke email anda)`);
            
            // Clear previous verification inputs
            document.querySelectorAll('.verification-input').forEach(input => {
                input.value = '';
                input.classList.remove('filled');
            });
            document.querySelector('.verification-input[data-index="0"]').focus();
            
            // Re-enable after 30 seconds
            setTimeout(() => {
                resendLink.classList.remove('disabled');
            }, 30000);
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ms-MY', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function showValidationError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'validation-message error';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                element.textContent = '';
                element.className = 'validation-message';
            }, 5000);
        }
        
        function checkPasswordStrength(password) {
            let strength = 0;
            
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            return strength;
        }
        
        function updatePasswordStrength(password, strengthBarId, strengthTextId) {
            const strength = checkPasswordStrength(password);
            const strengthBar = document.getElementById(strengthBarId);
            const strengthText = document.getElementById(strengthTextId);
            
            let strengthClass = '';
            let strengthMessage = '';
            
            if (strength <= 2) {
                strengthClass = 'strength-weak';
                strengthMessage = 'Lemah';
            } else if (strength <= 4) {
                strengthClass = 'strength-medium';
                strengthMessage = 'Sederhana';
            } else {
                strengthClass = 'strength-strong';
                strengthMessage = 'Kuat';
            }
            
            strengthBar.className = `strength-bar ${strengthClass}`;
            strengthText.textContent = `Kekuatan kata laluan: ${strengthMessage}`;
        }
        
        function togglePasswordVisibility(inputId, toggleButtonId) {
            const passwordInput = document.getElementById(inputId);
            const toggleButton = document.getElementById(toggleButtonId);
            const icon = toggleButton.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }
        
        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        
        function setupEventListeners() {
            // Tab switching
            document.getElementById('loginTab').addEventListener('click', () => switchAuthTab('login'));
            document.getElementById('registerTab').addEventListener('click', () => switchAuthTab('register'));
            document.getElementById('goToRegister').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('register');
            });
            document.getElementById('goToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            document.getElementById('goToLoginFromSuccess').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            document.getElementById('goToLoginFromReset').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            
            // Forgot password link
            document.getElementById('forgotPasswordLink').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('forgot');
            });
            
            // Back to login from forgot password
            document.getElementById('backToLoginFromForgot').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            
            // User type selection
            document.querySelectorAll('.user-type-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.user-type-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    document.getElementById('userType').value = this.dataset.type;
                });
            });
            
            // Form submissions
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('forgotPasswordForm').addEventListener('submit', handleResetPassword);
            
            // Forgot password steps
            document.getElementById('sendVerificationCode').addEventListener('click', handleForgotPassword);
            document.getElementById('verifyCodeBtn').addEventListener('click', handleVerifyCode);
            
            // Back buttons in forgot password flow
            document.getElementById('backToStep1').addEventListener('click', () => {
                document.getElementById('forgotStep2').classList.remove('active');
                document.getElementById('forgotStep1').classList.add('active');
                
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step1').classList.add('active');
                document.getElementById('step1').classList.remove('completed');
                
                // Stop timer
                if (forgotPasswordTimer) {
                    clearInterval(forgotPasswordTimer);
                    forgotPasswordTimer = null;
                }
            });
            
            document.getElementById('backToStep2').addEventListener('click', () => {
                document.getElementById('forgotStep3').classList.remove('active');
                document.getElementById('forgotStep2').classList.add('active');
                
                document.getElementById('step3').classList.remove('active');
                document.getElementById('step2').classList.add('active');
                document.getElementById('step2').classList.remove('completed');
            });
            
            // Resend verification code
            document.getElementById('resendCodeLink').addEventListener('click', resendVerificationCode);
            
            // Password strength indicators
            document.getElementById('registerPassword').addEventListener('input', function() {
                updatePasswordStrength(this.value, 'strengthBar', 'passwordStrengthText');
            });
            
            document.getElementById('newPassword').addEventListener('input', function() {
                updatePasswordStrength(this.value, 'newPasswordStrengthBar', 'newPasswordStrengthText');
            });
            
            // Confirm password validation
            document.getElementById('confirmPassword').addEventListener('input', function() {
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = this.value;
                
                if (confirmPassword && newPassword !== confirmPassword) {
                    showValidationError('confirmPasswordError', 'Kata laluan tidak sepadan');
                } else {
                    document.getElementById('confirmPasswordError').textContent = '';
                }
            });
            
            // Password visibility toggles
            document.getElementById('toggleLoginPassword').addEventListener('click', () => {
                togglePasswordVisibility('loginPassword', 'toggleLoginPassword');
            });
            
            document.getElementById('toggleRegisterPassword').addEventListener('click', () => {
                togglePasswordVisibility('registerPassword', 'toggleRegisterPassword');
            });
            
            document.getElementById('toggleNewPassword').addEventListener('click', () => {
                togglePasswordVisibility('newPassword', 'toggleNewPassword');
            });
            
            document.getElementById('toggleConfirmPassword').addEventListener('click', () => {
                togglePasswordVisibility('confirmPassword', 'toggleConfirmPassword');
            });
            
            // Verification code input handling
            document.querySelectorAll('.verification-input').forEach((input, index) => {
                input.addEventListener('input', function() {
                    // Allow only numbers
                    this.value = this.value.replace(/\D/g, '');
                    
                    if (this.value) {
                        this.classList.add('filled');
                        
                        // Auto-focus next input
                        if (index < 5) {
                            document.querySelector(`.verification-input[data-index="${index + 1}"]`).focus();
                        }
                    } else {
                        this.classList.remove('filled');
                    }
                    
                    // Update hidden field with complete code
                    const code = Array.from(document.querySelectorAll('.verification-input'))
                        .map(input => input.value)
                        .join('');
                    document.getElementById('verificationCode').value = code;
                });
                
                // Handle backspace
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && !this.value && index > 0) {
                        document.querySelector(`.verification-input[data-index="${index - 1}"]`).focus();
                    }
                });
                
                // Handle paste
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const pastedData = e.clipboardData.getData('text');
                    const digits = pastedData.replace(/\D/g, '').split('');
                    
                    // Fill all inputs with pasted digits
                    document.querySelectorAll('.verification-input').forEach((input, i) => {
                        if (digits[i]) {
                            input.value = digits[i];
                            input.classList.add('filled');
                        } else {
                            input.value = '';
                            input.classList.remove('filled');
                        }
                    });
                    
                    // Update hidden field
                    const code = Array.from(document.querySelectorAll('.verification-input'))
                        .map(input => input.value)
                        .join('');
                    document.getElementById('verificationCode').value = code;
                    
                    // Focus last filled input or last input
                    const lastFilledIndex = Math.min(digits.length - 1, 5);
                    document.querySelector(`.verification-input[data-index="${lastFilledIndex}"]`).focus();
                });
            });
            
            // Navigation in application
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links
                    document.querySelectorAll('.nav-links a').forEach(l => {
                        l.classList.remove('active');
                    });
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Get page to show
                    const page = this.dataset.page;
                    
                    // Hide all pages
                    document.querySelectorAll('.page-content').forEach(page => {
                        page.classList.remove('active');
                    });
                    
                    // Show selected page
                    document.getElementById(page + 'Page').classList.add('active');
                    
                    // Load specific page content if needed
                    if (page === 'assets') {
                        loadAllAssets();
                    } else if (page === 'application') {
                        loadUserApplications();
                    }
                });
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('Adakah anda pasti ingin log keluar?')) {
                    sessionStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
                    localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
                    currentUser = null;
                    showAuthentication();
                }
            });
            
            // Apply buttons
            document.getElementById('newApplicationBtn').addEventListener('click', function() {
                alert('Fitur permohonan akan datang tidak lama lagi!');
            });
            
            document.getElementById('applyNewBtn').addEventListener('click', function() {
                alert('Fitur permohonan akan datang tidak lama lagi!');
            });
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
            setupEventListeners();
            
            // Pre-fill login for easier testing (optional)
            document.getElementById('loginEmail').value = 'ahmad@email.com';
            document.getElementById('loginPassword').value = 'password123';
        });
    </script>
</body>
</html>
