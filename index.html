<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Aset Sewaan - Portal Lengkap</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a5f7a;
            --secondary: #57c5b6;
            --accent: #159895;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --admin-primary: #2c3e50;
            --admin-secondary: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ===== AUTHENTICATION PAGES ===== */
        .auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            padding: 20px;
        }
        
        .auth-container {
            display: flex;
            width: 100%;
            max-width: 1000px;
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }
        
        .auth-left {
            flex: 1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .auth-right {
            flex: 1;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .auth-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }
        
        .auth-logo i {
            font-size: 2.5rem;
        }
        
        .auth-logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .auth-logo-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .auth-features {
            position: relative;
            z-index: 1;
            margin-top: 30px;
        }
        
        .auth-feature {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .auth-feature-icon {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }
        
        .auth-feature-text h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .auth-feature-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .auth-form-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .auth-title {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-title h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .auth-title p {
            color: var(--gray);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }
        
        .auth-tab.active {
            color: var(--primary);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .auth-form-group {
            margin-bottom: 20px;
        }
        
        .auth-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .required:after {
            content: '*';
            color: var(--danger);
            margin-left: 3px;
        }
        
        .auth-input-with-icon {
            position: relative;
        }
        
        .auth-input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .auth-input {
            width: 100%;
            padding: 14px 15px 14px 45px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .auth-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        
        .auth-password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .auth-form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            font-size: 0.9rem;
        }
        
        .auth-btn {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .auth-btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .auth-btn-primary:hover {
            background-color: #144c63;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }
        
        .auth-success {
            text-align: center;
            padding: 30px;
            display: none;
        }
        
        .auth-success.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .auth-success-icon {
            width: 80px;
            height: 80px;
            background-color: rgba(40, 167, 69, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            color: var(--success);
        }
        
        /* Forgot Password Styles */
        .forgot-password-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .forgot-password-link:hover {
            text-decoration: underline;
        }
        
        .back-to-login {
            margin-top: 20px;
            text-align: center;
        }
        
        /* Reset Form Styles */
        .reset-form-group {
            margin-bottom: 20px;
        }
        
        .reset-instructions {
            background-color: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .reset-instructions i {
            color: var(--primary);
            margin-right: 8px;
        }
        
        /* ===== MAIN APPLICATION ===== */
        .app-container {
            display: none;
        }
        
        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .app-logo i {
            font-size: 2.2rem;
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: white;
            color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: var(--light);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-outline {
            background-color: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            overflow: hidden;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Navigation */
        .app-nav {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 5px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            padding: 15px 20px;
            display: inline-block;
            transition: all 0.3s;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background-color: rgba(26, 95, 122, 0.1);
            color: var(--primary);
        }
        
        /* Dashboard */
        .app-main {
            padding: 2rem 0;
        }
        
        .welcome-banner {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-type-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Asset Grid */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .section-header h2 {
            font-size: 1.8rem;
            color: var(--primary);
            position: relative;
            padding-left: 15px;
        }
        
        .section-header h2:before {
            content: '';
            position: absolute;
            left: 0;
            top: 5px;
            height: 80%;
            width: 5px;
            background-color: var(--secondary);
            border-radius: 3px;
        }
        
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 3rem;
        }
        
        .asset-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid var(--light-gray);
            height: 100%;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }
        
        .asset-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .asset-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-available {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }
        
        .status-limited {
            background-color: rgba(255, 193, 7, 0.15);
            color: #b88b00;
        }
        
        .status-unavailable {
            background-color: rgba(220, 53, 69, 0.15);
            color: var(--danger);
        }
        
        .asset-image {
            height: 180px;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            position: relative;
        }
        
        .asset-image i {
            font-size: 4rem;
            opacity: 0.5;
        }
        
        .asset-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .asset-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .asset-details {
            margin-bottom: 20px;
            flex-grow: 1;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .detail-label {
            color: var(--gray);
        }
        
        .detail-value {
            font-weight: 500;
        }
        
        .asset-actions {
            margin-top: auto;
        }
        
        .btn-block {
            width: 100%;
            justify-content: center;
        }
        
        /* Application Status */
        .status-section {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
        }
        
        .status-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            background-color: var(--light);
            border-left: 5px solid var(--primary);
        }
        
        .status-info h4 {
            margin-bottom: 5px;
        }
        
        .status-info p {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-processing {
            background-color: rgba(255, 193, 7, 0.15);
            color: #b88b00;
        }
        
        .badge-approved {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }
        
        .badge-rejected {
            background-color: rgba(220, 53, 69, 0.15);
            color: var(--danger);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            padding: 1.5rem 2rem;
            background: linear-gradient(to right, var(--primary), var(--accent));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 1.4rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }
        
        .close-modal:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group.full-width {
            grid-column: 1 / span 2;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .modal-footer {
            padding: 1.5rem 2rem;
            background-color: var(--light);
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Success Modal */
        .success-modal {
            text-align: center;
            padding: 3rem;
        }
        
        .success-icon {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 1rem;
        }
        
        /* Profile Dropdown */
        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            display: none;
            z-index: 1000;
        }
        
        .profile-dropdown.active {
            display: block;
        }
        
        /* Footer */
        .app-footer {
            background-color: var(--dark);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* Admin Dashboard */
        .admin-header {
            background: linear-gradient(135deg, var(--admin-primary) 0%, var(--admin-secondary) 100%);
            color: white;
        }
        
        .admin-nav {
            background-color: var(--admin-secondary);
        }
        
        .admin-nav a:hover, .admin-nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .applications-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 50px 1fr 1fr 150px 100px 120px;
            padding: 1rem;
            background-color: var(--light);
            font-weight: 600;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .table-row {
            display: grid;
            grid-template-columns: 50px 1fr 1fr 150px 100px 120px;
            padding: 1rem;
            border-bottom: 1px solid var(--light-gray);
            align-items: center;
        }
        
        .table-row:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-header, .table-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
            }
            
            .assets-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Page Content */
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* Validation Messages */
        .validation-message {
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .validation-message.error {
            color: var(--danger);
            display: block;
        }
        
        .validation-message.success {
            color: var(--success);
            display: block;
        }
        
        /* Location Selector Styles */
        .location-selector {
            margin-bottom: 1rem;
        }
        
        .location-message {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .location-message.info {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            color: #6c757d;
            display: block;
        }
        
        .location-message.loading {
            background-color: #cff4fc;
            border: 1px solid #b6effb;
            color: #055160;
        }
        
        .location-message.warning {
            background-color: #fff3cd;
            border: 1px solid #ffecb5;
            color: #664d03;
        }
        
        .vacancy-info {
            font-size: 0.9rem;
            color: var(--success);
            margin-top: 5px;
            font-weight: 500;
        }
        
        .vacancy-info.warning {
            color: var(--warning);
        }
        
        .vacancy-info.danger {
            color: var(--danger);
        }
        
        /* Form field dengan data automatik */
        .auto-filled-field {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            color: #495057;
            font-weight: 500;
        }
        
        .auto-filled-field:focus {
            background-color: #f8f9fa;
            border-color: #e9ecef;
            box-shadow: none;
        }
        
        /* Email verification */
        .verification-note {
            background-color: #e7f4ff;
            border: 1px solid #b6d4fe;
            color: #0a58ca;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .verification-note i {
            margin-right: 8px;
        }
        
        /* Profile edit form */
        .profile-form-group {
            margin-bottom: 1.5rem;
        }
        
        .profile-edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 2rem;
            justify-content: flex-end;
        }
        
        .profile-view-mode {
            display: block;
        }
        
        .profile-edit-mode {
            display: none;
        }
        
        .editing .profile-view-mode {
            display: none;
        }
        
        .editing .profile-edit-mode {
            display: block;
        }
        
        .profile-field-value {
            font-weight: 500;
            padding: 8px 0;
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        
        .profile-field-edit {
            width: 100%;
        }
        
        /* Profile Picture Styles */
        .profile-picture-container {
            position: relative;
            display: inline-block;
        }
        
        .profile-picture {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            overflow: hidden;
        }
        
        .profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-picture-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
        }
        
        .change-profile-picture {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--primary);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid white;
            transition: all 0.3s;
        }
        
        .change-profile-picture:hover {
            background-color: var(--accent);
            transform: scale(1.1);
        }
        
        .profile-picture-input {
            display: none;
        }
        
        .profile-picture-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            display: none;
        }
        
        .profile-picture-btn {
            padding: 5px 15px;
            font-size: 0.8rem;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .profile-picture-btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .profile-picture-btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .profile-picture-btn:hover {
            opacity: 0.9;
        }
        
        /* Profile header avatar */
        .header-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            overflow: hidden;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .header-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <!-- Authentication Pages -->
    <div class="auth-page" id="authPage">
        <div class="auth-container">
            <div class="auth-left">
                <div class="auth-logo">
                    <i class="fas fa-building"></i>
                    <div class="auth-logo-text">
                        <h1>Sistem Aset Sewaan</h1>
                        <p>Portal Permohonan & Pengurusan</p>
                    </div>
                </div>
                
                <div class="auth-features">
                    <div class="auth-feature">
                        <div class="auth-feature-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="auth-feature-text">
                            <h4>181 Unit Kuarters</h4>
                            <p>49 unit masih tersedia untuk disewa</p>
                        </div>
                    </div>
                    
                    <div class="auth-feature">
                        <div class="auth-feature-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="auth-feature-text">
                            <h4>Permohonan Online</h4>
                            <p>Hantar permohonan kepada admin</p>
                        </div>
                    </div>
                    
                    <div class="auth-feature">
                        <div class="auth-feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="auth-feature-text">
                            <h4>Autocount Real-time</h4>
                            <p>Status kekosongan dikemas kini automatik</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="auth-right">
                <div class="auth-form-container">
                    <div class="auth-tabs">
                        <button class="auth-tab active" id="loginTab">Log Masuk</button>
                        <button class="auth-tab" id="registerTab">Daftar Akaun</button>
                    </div>
                    
                    <!-- Login Form -->
                    <form class="auth-form active" id="loginForm">
                        <div class="auth-title">
                            <h2>Log Masuk</h2>
                            <p>Sila masukkan maklumat akaun anda</p>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="loginEmail" class="required">Email atau No. KP</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-user auth-input-icon"></i>
                                <input type="text" id="loginEmail" class="auth-input" placeholder="cth: user@email.com atau 800101011234" required>
                            </div>
                            <div class="validation-message" id="loginEmailError"></div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="loginPassword" class="required">Kata Laluan</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-lock auth-input-icon"></i>
                                <input type="password" id="loginPassword" class="auth-input" placeholder="Masukkan kata laluan" required>
                                <button type="button" class="auth-password-toggle" id="toggleLoginPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="validation-message" id="loginPasswordError"></div>
                        </div>
                        
                        <div class="auth-form-options">
                            <div class="auth-remember">
                                <input type="checkbox" id="rememberMe">
                                <label for="rememberMe">Ingat saya</label>
                            </div>
                            <a class="forgot-password-link" id="forgotPasswordLink">Lupa Kata Laluan?</a>
                        </div>
                        
                        <button type="submit" class="auth-btn auth-btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Log Masuk
                        </button>
                        
                        <div class="auth-footer">
                            Tiada akaun? <a href="#" id="goToRegister">Daftar di sini</a>
                        </div>
                    </form>
                    
                    <!-- Register Form -->
                    <form class="auth-form" id="registerForm">
                        <div class="auth-title">
                            <h2>Daftar Akaun Baru</h2>
                            <p>Sila isi maklumat di bawah</p>
                        </div>
                        
                        <div class="verification-note">
                            <i class="fas fa-info-circle"></i>
                            Pastikan email anda aktif untuk menerima pengesahan
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="registerName" class="required">Nama Penuh</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-user auth-input-icon"></i>
                                <input type="text" id="registerName" class="auth-input" placeholder="Masukkan nama penuh" required>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="registerIC" class="required">No. Kad Pengenalan</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-id-card auth-input-icon"></i>
                                <input type="text" id="registerIC" class="auth-input" placeholder="cth: 800101011234" required>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="registerEmail" class="required">Alamat Email</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-envelope auth-input-icon"></i>
                                <input type="email" id="registerEmail" class="auth-input" placeholder="cth: user@email.com" required>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="registerPhone" class="required">No. Telefon</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-phone auth-input-icon"></i>
                                <input type="tel" id="registerPhone" class="auth-input" placeholder="cth: 0123456789" required>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="registerPassword" class="required">Kata Laluan</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-lock auth-input-icon"></i>
                                <input type="password" id="registerPassword" class="auth-input" placeholder="Minimum 8 aksara" required>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="confirmPassword" class="required">Sahkan Kata Laluan</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-lock auth-input-icon"></i>
                                <input type="password" id="confirmPassword" class="auth-input" placeholder="Taip semula kata laluan" required>
                            </div>
                            <div class="validation-message" id="passwordMatchError"></div>
                        </div>
                        
                        <div class="auth-form-group">
                            <div style="display: flex; align-items: start; gap: 10px;">
                                <input type="checkbox" id="agreeTerms" required style="margin-top: 3px;">
                                <label for="agreeTerms" style="margin-bottom: 0; font-size: 0.9rem;">
                                    Saya bersetuju dengan <a href="#" style="color: var(--primary);">Terma & Syarat</a> dan <a href="#" style="color: var(--primary);">Dasar Privasi</a>
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="auth-btn auth-btn-primary">
                            <i class="fas fa-user-plus"></i> Daftar Akaun
                        </button>
                        
                        <div class="auth-footer">
                            Sudah ada akaun? <a href="#" id="goToLogin">Log masuk di sini</a>
                        </div>
                    </form>
                    
                    <!-- Forgot Password Form -->
                    <form class="auth-form" id="forgotPasswordForm">
                        <div class="auth-title">
                            <h2>Lupa Kata Laluan</h2>
                            <p>Masukkan email untuk menetapkan semula kata laluan</p>
                        </div>
                        
                        <div class="reset-instructions">
                            <i class="fas fa-key"></i>
                            Kami akan menghantar pautan tetapan semula kata laluan ke email anda
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="resetEmail" class="required">Alamat Email</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-envelope auth-input-icon"></i>
                                <input type="email" id="resetEmail" class="auth-input" placeholder="Masukkan email yang didaftarkan" required>
                            </div>
                            <div class="validation-message" id="resetEmailError"></div>
                        </div>
                        
                        <button type="submit" class="auth-btn auth-btn-primary">
                            <i class="fas fa-paper-plane"></i> Hantar Pautan Tetapan Semula
                        </button>
                        
                        <div class="back-to-login">
                            <a href="#" class="forgot-password-link" id="backToLogin">
                                <i class="fas fa-arrow-left"></i> Kembali ke Log Masuk
                            </a>
                        </div>
                    </form>
                    
                    <!-- Reset Password Form -->
                    <form class="auth-form" id="resetPasswordForm">
                        <div class="auth-title">
                            <h2>Tetapkan Semula Kata Laluan</h2>
                            <p>Masukkan kata laluan baru anda</p>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="newPassword" class="required">Kata Laluan Baru</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-lock auth-input-icon"></i>
                                <input type="password" id="newPassword" class="auth-input" placeholder="Minimum 8 aksara" required>
                                <button type="button" class="auth-password-toggle" id="toggleNewPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="confirmNewPassword" class="required">Sahkan Kata Laluan Baru</label>
                            <div class="auth-input-with-icon">
                                <i class="fas fa-lock auth-input-icon"></i>
                                <input type="password" id="confirmNewPassword" class="auth-input" placeholder="Taip semula kata laluan baru" required>
                                <button type="button" class="auth-password-toggle" id="toggleConfirmNewPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="validation-message" id="resetPasswordMatchError"></div>
                        </div>
                        
                        <button type="submit" class="auth-btn auth-btn-primary">
                            <i class="fas fa-save"></i> Tetapkan Kata Laluan Baru
                        </button>
                        
                        <div class="back-to-login">
                            <a href="#" class="forgot-password-link" id="backToLoginFromReset">
                                <i class="fas fa-arrow-left"></i> Kembali ke Log Masuk
                            </a>
                        </div>
                    </form>
                    
                    <!-- Success Message -->
                    <div class="auth-success" id="successMessage">
                        <div class="auth-success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h2>Pendaftaran Berjaya!</h2>
                        <p>Akaun anda telah berjaya didaftarkan. Sila log masuk.</p>
                        <button class="auth-btn auth-btn-primary" id="goToLoginFromSuccess" style="margin-top: 20px;">
                            <i class="fas fa-sign-in-alt"></i> Log Masuk Sekarang
                        </button>
                    </div>
                    
                    <!-- Reset Password Success -->
                    <div class="auth-success" id="resetSuccessMessage">
                        <div class="auth-success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h2>Kata Laluan Ditukar!</h2>
                        <p>Kata laluan anda telah berjaya ditetapkan semula.</p>
                        <button class="auth-btn auth-btn-primary" id="goToLoginFromResetSuccess" style="margin-top: 20px;">
                            <i class="fas fa-sign-in-alt"></i> Log Masuk Sekarang
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header class="app-header" id="appHeader">
            <div class="container header-content">
                <div class="app-logo">
                    <i class="fas fa-building"></i>
                    <div class="app-logo-text">
                        <h1>Portal Sewaan Aset</h1>
                        <p>Selamat datang, <span id="headerUserName">Pengguna</span></p>
                    </div>
                </div>
                
                <div class="user-section">
                    <div class="user-profile" id="userProfileBtn">
                        <div class="header-avatar" id="headerUserAvatar">
                            <!-- Header avatar will be loaded here -->
                        </div>
                        <div>
                            <div class="user-name" id="userName">Pengguna</div>
                        </div>
                    </div>
                    <button class="btn btn-outline" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Log Keluar
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="app-nav" id="appNav">
            <div class="container nav-container">
                <ul class="nav-links" id="navLinks">
                    <!-- Navigation links will be loaded here based on user type -->
                </ul>
                
                <div class="quick-actions">
                    <button class="btn btn-primary" id="newApplicationBtn">
                        <i class="fas fa-plus"></i> Mohon Baru
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="app-main">
            <div class="container">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content active">
                    <div class="welcome-banner">
                        <div class="welcome-content">
                            <h2 id="welcomeTitle">Selamat Datang!</h2>
                            <p id="welcomeMessage">Portal sewaan aset.</p>
                        </div>
                        <div style="font-size: 4rem; color: var(--secondary); opacity: 0.7;">
                            <i class="fas fa-hand-wave"></i>
                        </div>
                    </div>
                    
                    <!-- User Dashboard -->
                    <div id="userDashboard">
                        <div class="dashboard-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 2rem;">
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                                <div class="card-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                                    <div class="card-icon" style="width: 50px; height: 50px; background-color: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                        <i class="fas fa-home"></i>
                                    </div>
                                    <div class="card-content">
                                        <h3 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;" id="dashboardTotalQuarters">228</h3>
                                        <p style="color: var(--gray); font-size: 0.9rem;">Jumlah Aset</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                                <div class="card-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                                    <div class="card-icon" style="width: 50px; height: 50px; background-color: var(--success); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                        <i class="fas fa-door-open"></i>
                                    </div>
                                    <div class="card-content">
                                        <h3 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;" id="dashboardAvailableQuarters">49</h3>
                                        <p style="color: var(--gray); font-size: 0.9rem;">Kuarters Tersedia</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                                <div class="card-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                                    <div class="card-icon" style="width: 50px; height: 50px; background-color: var(--accent); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                        <i class="fas fa-file-alt"></i>
                                    </div>
                                    <div class="card-content">
                                        <h3 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;" id="dashboardMyApplications">0</h3>
                                        <p style="color: var(--gray); font-size: 0.9rem;">Permohonan Saya</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                                <div class="card-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                                    <div class="card-icon" style="width: 50px; height: 50px; background-color: var(--warning); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="card-content">
                                        <h3 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;" id="dashboardPending">0</h3>
                                        <p style="color: var(--gray); font-size: 0.9rem;">Dalam Proses</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-header">
                            <h2>Akses Pantas</h2>
                        </div>
                        
                        <div class="assets-grid" id="quickAccessAssets">
                            <!-- Quick access cards will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Admin Dashboard -->
                    <div id="adminDashboard" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon" style="background-color: rgba(26, 95, 122, 0.1); color: var(--primary);">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-value" id="totalUsers">0</div>
                                <div class="stat-label">Jumlah Pengguna</div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon" style="background-color: rgba(40, 167, 69, 0.1); color: var(--success);">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="stat-value" id="totalApplications">0</div>
                                <div class="stat-label">Jumlah Permohonan</div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon" style="background-color: rgba(255, 193, 7, 0.1); color: var(--warning);">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-value" id="pendingApplications">0</div>
                                <div class="stat-label">Permohonan Baru</div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon" style="background-color: rgba(220, 53, 69, 0.1); color: var(--danger);">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div class="stat-value" id="availableAssets">0</div>
                                <div class="stat-label">Aset Tersedia</div>
                            </div>
                        </div>
                        
                        <div class="section-header">
                            <h2>Permohonan Terkini</h2>
                            <button class="btn btn-primary" id="refreshApplications">
                                <i class="fas fa-sync-alt"></i> Muat Semula
                            </button>
                        </div>
                        
                        <div class="applications-table">
                            <div class="table-header">
                                <div>#</div>
                                <div>Nama Pemohon</div>
                                <div>Jenis Aset</div>
                                <div>Tarikh Mohon</div>
                                <div>Status</div>
                                <div>Tindakan</div>
                            </div>
                            <div id="adminApplicationsList">
                                <!-- Applications will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Assets Page -->
                <div id="assetsPage" class="page-content">
                    <div class="section-header">
                        <h2>Aset Tersedia Untuk Disewa</h2>
                        <div>
                            <span id="availableCount">49</span> daripada <span id="totalCount">181</span> unit tersedia
                        </div>
                    </div>
                    
                    <div class="assets-grid" id="assetsGrid">
                        <!-- Assets will be loaded here -->
                    </div>
                </div>
                
                <!-- Application Page -->
                <div id="applicationPage" class="page-content">
                    <div class="section-header">
                        <h2>Permohonan Saya</h2>
                        <button class="btn btn-primary" id="applyNewBtn">
                            <i class="fas fa-plus"></i> Permohonan Baru
                        </button>
                    </div>
                    
                    <div class="status-section">
                        <div class="status-list" id="applicationStatus">
                            <!-- Applications will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Profile Page -->
                <div id="profilePage" class="page-content">
                    <div class="section-header">
                        <h2>Profil Saya</h2>
                        <div class="profile-actions">
                            <button class="btn btn-primary" id="editProfileBtn">
                                <i class="fas fa-edit"></i> Kemaskini Profil
                            </button>
                            <button class="btn btn-success" id="saveProfileBtn" style="display: none;">
                                <i class="fas fa-save"></i> Simpan Perubahan
                            </button>
                            <button class="btn" id="cancelEditBtn" style="display: none;">
                                <i class="fas fa-times"></i> Batal
                            </button>
                        </div>
                    </div>
                    
                    <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);" id="profileCard">
                        <div style="display: flex; align-items: center; gap: 30px; margin-bottom: 2rem;">
                            <div class="profile-picture-container">
                                <div class="profile-picture" id="profilePicture">
                                    <!-- Profile picture will be loaded here -->
                                    <div class="profile-picture-placeholder" id="profilePicturePlaceholder">
                                        <!-- Initials will be displayed here -->
                                    </div>
                                </div>
                                <div class="change-profile-picture" id="changeProfilePictureBtn" title="Tukar gambar profil">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <input type="file" id="profilePictureInput" class="profile-picture-input" accept="image/*">
                                <div class="profile-picture-actions" id="profilePictureActions">
                                    <button class="profile-picture-btn profile-picture-btn-primary" id="saveProfilePictureBtn">
                                        <i class="fas fa-save"></i> Simpan Gambar
                                    </button>
                                    <button class="profile-picture-btn profile-picture-btn-danger" id="removeProfilePictureBtn">
                                        <i class="fas fa-trash"></i> Buang
                                    </button>
                                    <button class="profile-picture-btn" id="cancelProfilePictureBtn">
                                        <i class="fas fa-times"></i> Batal
                                    </button>
                                </div>
                            </div>
                            <div style="flex-grow: 1;">
                                <div class="profile-view-mode">
                                    <h3 style="color: var(--primary); margin-bottom: 5px;" id="profileName">Nama Pengguna</h3>
                                    <p style="color: var(--gray); margin-bottom: 5px;" id="profileEmail">email@example.com</p>
                                </div>
                                <div class="profile-edit-mode">
                                    <div class="profile-form-group">
                                        <label for="editName" class="required">Nama Penuh</label>
                                        <input type="text" id="editName" class="form-control" required>
                                    </div>
                                </div>
                                <button class="btn" id="changePasswordBtn" style="margin-top: 10px; font-size: 0.9rem; padding: 5px 15px;">
                                    <i class="fas fa-key"></i> Tukar Kata Laluan
                                </button>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <!-- No. Kad Pengenalan -->
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">No. Kad Pengenalan</label>
                                <div class="profile-view-mode">
                                    <div class="profile-field-value" id="profileIC">000000000000</div>
                                </div>
                                <div class="profile-edit-mode">
                                    <div class="profile-field-edit">
                                        <input type="text" id="editIC" class="form-control auto-filled-field" readonly>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- No. Telefon -->
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">No. Telefon</label>
                                <div class="profile-view-mode">
                                    <div class="profile-field-value" id="profilePhone">-</div>
                                </div>
                                <div class="profile-edit-mode">
                                    <div class="profile-field-edit">
                                        <input type="tel" id="editPhone" class="form-control">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Email -->
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">Alamat Email</label>
                                <div class="profile-view-mode">
                                    <div class="profile-field-value" id="profileEmailDisplay">email@example.com</div>
                                </div>
                                <div class="profile-edit-mode">
                                    <div class="profile-field-edit">
                                        <input type="email" id="editEmail" class="form-control" required>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Alamat -->
                            <div style="grid-column: span 2;">
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">Alamat</label>
                                <div class="profile-view-mode">
                                    <div class="profile-field-value" id="profileAddress">-</div>
                                </div>
                                <div class="profile-edit-mode">
                                    <div class="profile-field-edit">
                                        <textarea id="editAddress" class="form-control" rows="3"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ahli Sejak -->
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">Ahli Sejak</label>
                                <div class="profile-field-value" id="profileSince">-</div>
                            </div>
                            
                            <!-- Jumlah Permohonan -->
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: var(--gray);">Jumlah Permohonan</label>
                                <div class="profile-field-value" id="profileTotalApps">0</div>
                            </div>
                        </div>
                        
                        <!-- Maklumat Tambahan -->
                        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--light-gray);">
                            <div class="profile-view-mode">
                                <h4 style="color: var(--primary); margin-bottom: 1rem;">Maklumat Tambahan</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; color: var(--gray);">Status Akaun</label>
                                        <div class="profile-field-value" id="profileStatus">Aktif</div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; color: var(--gray);">Peranan</label>
                                        <div class="profile-field-value" id="profileRole">Pengguna</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Users Page -->
                <div id="usersPage" class="page-content">
                    <div class="section-header">
                        <h2>Pengurusan Pengguna</h2>
                        <button class="btn btn-primary" id="addUserBtn">
                            <i class="fas fa-user-plus"></i> Tambah Pengguna
                        </button>
                    </div>
                    
                    <div class="applications-table">
                        <div class="table-header">
                            <div>#</div>
                            <div>Nama</div>
                            <div>Email</div>
                            <div>Status</div>
                            <div>Tindakan</div>
                        </div>
                        <div id="usersList">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="app-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>Portal Sewaan Aset</h3>
                        <p>Sistem pengurusan sewaan aset yang efisien dan telus.</p>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Hubungi Admin</h3>
                        <ul class="footer-links" style="list-style: none; color: #ccc;">
                            <li><i class="fas fa-phone"></i> 03-8888 1234</li>
                            <li><i class="fas fa-envelope"></i> admin@aset.gov.my</li>
                            <li><i class="fas fa-clock"></i> Isnin - Jumaat: 8:30am - 5:30pm</li>
                        </ul>
                    </div>
                </div>
                
                <div class="copyright">
                    &copy; 2023 Portal Sewaan Aset. Hak Cipta Terpelihara.
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Application Modal -->
    <div class="modal" id="applicationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-alt"></i> Borang Permohonan Sewaan</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="rentalApplicationForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="applicantName" class="required">Nama Penuh</label>
                            <input type="text" id="applicantName" class="form-control auto-filled-field" required>
                        </div>
                        <div class="form-group">
                            <label for="applicantIC" class="required">No. Kad Pengenalan</label>
                            <input type="text" id="applicantIC" class="form-control auto-filled-field" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="applicantEmail" class="required">Email</label>
                            <input type="email" id="applicantEmail" class="form-control auto-filled-field" required>
                        </div>
                        <div class="form-group">
                            <label for="applicantPhone" class="required">No. Telefon</label>
                            <input type="tel" id="applicantPhone" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="applicantAddress" class="required">Alamat Tempat Tinggal</label>
                        <textarea id="applicantAddress" class="form-control" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="assetType" class="required">Jenis Aset Dipohon</label>
                            <select id="assetType" class="form-control" required>
                                <option value="">Sila Pilih</option>
                                <option value="kuarters">Kuarters Kakitangan</option>
                                <option value="pejabat">Pejabat</option>
                                <option value="tanah">Tanah Lot</option>
                                <option value="rumah_rehat">Rumah Rehat</option>
                                <option value="kedai">Lot Kedai</option>
                                <option value="bilik">Bilik Sejuk</option>
                                <option value="slipway">Slipway</option>
                                <option value="pphp">PPHP</option>
                                <option value="kompleks">Kompleks</option>
                                <option value="pasar">Pasar Nelayan</option>
                                <option value="akuakultur">Akuakultur</option>
                                <option value="ccdc">CCDC</option>
                                <option value="jeti">Jeti</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="location" class="required">Lokasi Pilihan</label>
                            <div id="locationContainer">
                                <select id="location" class="form-control" required disabled style="display: none;">
                                    <option value="">Pilih jenis aset dahulu</option>
                                </select>
                                <div class="location-message info" id="locationInitialMessage">
                                    <i class="fas fa-info-circle"></i> Sila pilih jenis aset terlebih dahulu
                                </div>
                                <div class="location-message loading" id="locationLoadingMessage" style="display: none;">
                                    <i class="fas fa-spinner fa-spin"></i> Sedang memuatkan lokasi...
                                </div>
                                <div class="location-message warning" id="locationNoVacancyMessage" style="display: none;">
                                    <i class="fas fa-exclamation-triangle"></i> Tiada kekosongan tersedia untuk jenis aset ini
                                </div>
                            </div>
                            <div id="vacancyInfo" class="vacancy-info" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate">Tarikh Mula Diingini</label>
                            <input type="date" id="startDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="duration">Tempoh Sewaan</label>
                            <select id="duration" class="form-control">
                                <option value="12">12 Bulan</option>
                                <option value="24">24 Bulan</option>
                                <option value="36" selected>36 Bulan</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="purpose" class="required">Tujuan Permohonan</label>
                        <textarea id="purpose" class="form-control" placeholder="Sila nyatakan tujuan permohonan sewaan ini..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalInfo">Maklumat Tambahan (Jika Ada)</label>
                        <textarea id="additionalInfo" class="form-control" placeholder="Sebarang maklumat tambahan yang perlu dimaklumkan..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <div style="display: flex; align-items: start; gap: 10px;">
                            <input type="checkbox" id="agreeTermsModal" required style="margin-top: 3px;">
                            <label for="agreeTermsModal" style="margin-bottom: 0; font-size: 0.9rem;">
                                Saya mengakui bahawa maklumat yang diberikan adalah benar. Saya memahami bahawa maklumat palsu boleh menyebabkan permohonan ditolak.
                            </label>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn" id="cancelApplication">Batal</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Hantar 
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(to right, var(--success), #20c997);">
                <h3><i class="fas fa-check-circle"></i> Permohonan Berjaya Dihantar!</h3>
                <button class="close-modal" id="closeSuccessModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="success-modal">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">Permohonan Anda Telah Dihantar kepada Admin</h3>
                    <p style="margin-bottom: 1.5rem; font-size: 1.1rem;">
                        No. Rujukan: <strong id="referenceNumber">APP-2023-001</strong>
                    </p>
                    <div style="background-color: var(--light); padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Maklumat Permohonan:</h4>
                        <div class="detail-item">
                            <span class="detail-label">Jenis Aset:</span>
                            <span class="detail-value" id="successAssetType">Kuarters Kakitangan</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Lokasi:</span>
                            <span class="detail-value" id="successLocation">Shah Alam</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Tarikh Mohon:</span>
                            <span class="detail-value" id="successDate">15 Oktober 2023</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value" style="color: var(--warning); font-weight: bold;">Menunggu Kelulusan Admin</span>
                        </div>
                    </div>
                    <p style="margin-bottom: 2rem;">Admin akan memproses permohonan anda dalam tempoh 3-5 hari bekerja.</p>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" id="closeSuccessBtn">Tutup</button>
                        <button class="btn btn-primary" id="viewStatusBtn">Lihat Status</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Tukar Kata Laluan</h3>
                <button class="close-modal" id="closeChangePasswordModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="auth-form-group">
                        <label for="currentPassword" class="required">Kata Laluan Semasa</label>
                        <div class="auth-input-with-icon">
                            <i class="fas fa-lock auth-input-icon"></i>
                            <input type="password" id="currentPassword" class="auth-input" placeholder="Masukkan kata laluan semasa" required>
                            <button type="button" class="auth-password-toggle" id="toggleCurrentPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="validation-message" id="currentPasswordError"></div>
                    </div>
                    
                    <div class="auth-form-group">
                        <label for="newPasswordProfile" class="required">Kata Laluan Baru</label>
                        <div class="auth-input-with-icon">
                            <i class="fas fa-lock auth-input-icon"></i>
                            <input type="password" id="newPasswordProfile" class="auth-input" placeholder="Minimum 8 aksara" required>
                            <button type="button" class="auth-password-toggle" id="toggleNewPasswordProfile">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="auth-form-group">
                        <label for="confirmNewPasswordProfile" class="required">Sahkan Kata Laluan Baru</label>
                        <div class="auth-input-with-icon">
                            <i class="fas fa-lock auth-input-icon"></i>
                            <input type="password" id="confirmNewPasswordProfile" class="auth-input" placeholder="Taip semula kata laluan baru" required>
                            <button type="button" class="auth-password-toggle" id="toggleConfirmNewPasswordProfile">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="validation-message" id="changePasswordMatchError"></div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn" id="cancelChangePassword">Batal</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Simpan Kata Laluan Baru
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Application Details Modal (Admin) -->
    <div class="modal" id="applicationDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-invoice"></i> Butiran Permohonan</h3>
                <button class="close-modal" id="closeDetailsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="applicationDetailsContent">
                    <!-- Application details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer" id="applicationDetailsFooter">
                <!-- Action buttons will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // DATA STORAGE AND INITIALIZATION
        // ============================================
        
        const STORAGE_KEYS = {
            USERS: 'asset_rental_users',
            CURRENT_USER: 'current_asset_user',
            APPLICATIONS: 'user_applications',
            ASSETS: 'asset_data',
            VACANCIES: 'asset_vacancies',
            PASSWORD_RESET_TOKENS: 'password_reset_tokens',
            PROFILE_PICTURES: 'user_profile_pictures'
        };
        
        // Data Kekosongan Lokasi (Real-time AutoCount)
        const VACANCY_DATA = {
            kuarters: [
                { id: 'Q001', name: 'Kuarters Kuala Perlis, Perlis', vacancies: 1 },
                { id: 'Q002', name: 'Kuarters Padang Besar, Perlis', vacancies: 0 },
                { id: 'Q003', name: 'Kuarters Langkawi, Kedah', vacancies: 3 },
                { id: 'Q004', name: 'Kuarters Bukit Kayu Hitam, Kedah', vacancies: 9 },
                { id: 'Q005', name: 'Kuarters Kuala Kedah, Kedah', vacancies: 0 },
                { id: 'Q006', name: 'Kuarters Bayan Permai, Pulau Pinang', vacancies: 0 },
                { id: 'Q007', name: 'Kuarters Meru, Selangor', vacancies: 1 },
                { id: 'Q008', name: 'Kuarters Camar Laut, Selangor', vacancies: 0 },
                { id: 'Q009', name: 'Kuarters Cempaka Court, Negeri Sembilan', vacancies: 9 },
                { id: 'Q0010', name: 'Kuarters Pengerang, Johor', vacancies: 1 },
                { id: 'Q0011', name: 'Kuarters Sedili, Johor', vacancies: 3 },
                { id: 'Q0012', name: 'Kuarters Mersing, Johor', vacancies: 1 },
                { id: 'Q0013', name: 'Kuarters Endau, Johor', vacancies: 3 },
                { id: 'Q0014', name: 'Kuarters Taman Guru, Pahang', vacancies: 0 },
                { id: 'Q0015', name: 'Kuarters Chendering, Terengganu', vacancies: 1 },
                { id: 'Q0016', name: 'Kuarters Bachok, Kelantan', vacancies: 0 },
                { id: 'Q0017', name: 'Kuarters Kuala Besar, Kelantan', vacancies: 4 },
                { id: 'Q0018', name: 'Kuarters Geting, Kelantan', vacancies: 5 },
                { id: 'Q0019', name: 'Kuarters Tanjung Manis, Sarawak', vacancies: 3 },
                { id: 'Q0020', name: 'Kuarters Mukah, Sarawak', vacancies: 0 },
                { id: 'Q0021', name: 'Kuarters Bintulu, Sarawak', vacancies: 0 },
                { id: 'Q0022', name: 'Kuarters Miri, Sarawak', vacancies: 3 },
                { id: 'Q0023', name: 'Kuarters Labuan, Sabah', vacancies: 0 }
            ],
            pejabat: [
                { id: 'O001', name: 'Pejabat PNK Port Dickson, Negeri Sembilan', vacancies: 2 },
                { id: 'O002', name: 'Pejabat PNK Batu Pahat, Johor', vacancies: 2 },
                { id: 'O003', name: 'Pejabat PNK Muar,Johor', vacancies: 2 },
                { id: 'O004', name: 'Pejabat PNK Paka, Terengganu', vacancies: 2 },
                { id: 'O005', name: 'Pejabat PNK Kuala Terengganu Utara, Terengganu', vacancies: 2 },
                { id: 'O006', name: 'Pejabat PNK Kuala Penyu, Sarawak', vacancies: 2 },
                { id: 'O007', name: 'Pejabat PNK Kota Kinabalu, Sarawak', vacancies: 2 },
                { id: 'O008', name: 'Pejabat PNK Negeri Sabah, Sabah', vacancies: 2 },
                { id: 'O009', name: 'Pejabat PNK Kota Belud, Sabah', vacancies: 2 },
                { id: 'O0010', name: 'Pejabat PNK Semporna, Sabah', vacancies: 2 }
            ],
            kedai: [
                { id: 'S001', name: 'Lot Kedai Taman Koperasi Polis, Selangor', vacancies: 1 },
                { id: 'S002', name: 'Lot Kedai Melaka Raya, Melaka', vacancies: 1 }
                
            ],
            tanah: [
                { id: 'L001', name: 'Tanah Kedah', vacancies: 2 },
                { id: 'L002', name: 'Tanah Penang', vacancies: 1 },
                { id: 'L003', name: 'Tanah Perak', vacancies: 2 },
                { id: 'L004', name: 'Tanah Selangor', vacancies: 3 },
                { id: 'L005', name: 'Tanah Melaka', vacancies: 5 },
                { id: 'L006', name: 'Tanah Johor', vacancies: 2 },
                { id: 'L007', name: 'Tanah Pahang', vacancies: 1 },
                { id: 'L008', name: 'Tanah Terengganu', vacancies: 2 },
                { id: 'L009', name: 'Tanah Kelantan', vacancies: 11 },
                { id: 'L0010', name: 'Tanah Sarawak', vacancies: 4 }
            ],
            rumah_rehat: [
                { id: 'RR001', name: 'Rumah Rehat Bayu Beach Resort, Port Dickson', vacancies: 1 },
                { id: 'RR002', name: 'Rumah Rehat Acheh', vacancies: 3 }
                
            ],
            bilik: [
                { id: 'BS001', name: 'Bilik Sejuk Perlis', vacancies: 5 },
                { id: 'BS002', name: 'Bilik Sejuk Kedah', vacancies: 7 },
                { id: 'BS003', name: 'Bilik Sejuk Penang', vacancies: 3 },
                { id: 'BS004', name: 'Bilik Sejuk Perak', vacancies: 2 },
                { id: 'BS005', name: 'Bilik Sejuk Selangor', vacancies: 7 },
                { id: 'BS006', name: 'Bilik Sejuk Negeri Sembilan', vacancies: 3 },
                { id: 'BS007', name: 'Bilik Sejuk Melaka', vacancies: 5 },
                { id: 'BS008', name: 'Bilik Sejuk Johor', vacancies: 11 },
                { id: 'BS009', name: 'Bilik Sejuk Pahang', vacancies: 9 },
                { id: 'BS0010', name: 'Bilik Sejuk Terengganu', vacancies: 6 },
                { id: 'BS0011', name: 'Bilik Sejuk Kelantan', vacancies: 4 },
                { id: 'BS0012', name: 'Bilik Sejuk Sarawak', vacancies: 11 },
                { id: 'BS0013', name: 'Bilik Sejuk WP Labuan', vacancies: 3 },
                { id: 'BS0014', name: 'Bilik Sejuk Sabah', vacancies: 5 }
            ],
            slipway: [
                { id: 'SW001', name: 'Slipway Kedah', vacancies: 1 },
                { id: 'SW002', name: 'Slipway Johor', vacancies: 1 }
            ],
            pphp: [
                { id: 'PP001', name: 'PPHP Perlis', vacancies: 1 },
                { id: 'PP002', name: 'PPHP Kedah', vacancies: 2 },
                { id: 'PP003', name: 'PPHP Perak', vacancies: 0 },
                { id: 'PP004', name: 'PPHP Johor', vacancies: 0 },
                { id: 'PP005', name: 'PPHP Pahang', vacancies: 2 },
                { id: 'PP006', name: 'PPHP Terengganu', vacancies: 1 },
                { id: 'PP007', name: 'PPHP Kelantan', vacancies: 3 },
                { id: 'PP008', name: 'PPHP Sarawak', vacancies: 2 },
                { id: 'PP009', name: 'PPHP Sabah', vacancies: 2 }
                
            ],
            kompleks: [
                { id: 'KC001', name: 'Kompleks LKIM Bintawa, Sarawak', vacancies: 1 }
            ],
            pasar: [
                { id: 'PN001', name: 'Pasar Nelayan Perlis', vacancies: 1 },
                { id: 'PN002', name: 'Pasar Nelayan Penang', vacancies: 5 },
                { id: 'PN003', name: 'Pasar Nelayan Perak', vacancies: 3 },
                { id: 'PN004', name: 'Pasar Nelayan Selangor', vacancies: 5 },
                { id: 'PN005', name: 'Pasar Nelayan Negeri Sembilan', vacancies: 6 },
                { id: 'PN006', name: 'Pasar Nelayan Melaka', vacancies: 2 },
                { id: 'PN007', name: 'Pasar Nelayan Johor', vacancies: 2 },
                { id: 'PN008', name: 'Pasar Nelayan Terengganu', vacancies: 3 },
                { id: 'PN009', name: 'Pasar Nelayan Sarawak', vacancies: 10 },
                { id: 'PN0010', name: 'Pasar Nelayan Sabah', vacancies: 5 }
            ],
            akuakultur: [
                { id: 'AQ001', name: 'Akuakultur Selangor', vacancies: 1 },
                { id: 'AQ002', name: 'Akuakultur Kelantan', vacancies: 1 },
                { id: 'AQ003', name: 'Akuakultur Terengganu', vacancies: 2 },
                { id: 'AQ004', name: 'Akuakultur Pahang', vacancies: 1 },
                { id: 'AQ005', name: 'Akuakultur Johor', vacancies: 1 }
                
            ],
            ccdc: [
                { id: 'CC001', name: 'CCDC Terengganu', vacancies: 2 },
                { id: 'CC002', name: 'CCDC Pahang', vacancies: 2 },
                { id: 'CC003', name: 'CCDC WP Labuan', vacancies: 1 },
                { id: 'CC004', name: 'CCDC Sabah', vacancies: 1 }
            ],
            jeti: [
                { id: 'JT001', name: 'Jeti Perlis', vacancies: 0 },
                { id: 'JT002', name: 'Jeti Kedah', vacancies: 10 },
                { id: 'JT003', name: 'Jeti Penang', vacancies: 3 },
                { id: 'JT004', name: 'Jeti Perak', vacancies: 8 },
                { id: 'JT005', name: 'Jeti Selangor', vacancies: 2 },
                { id: 'JT006', name: 'Jeti Negeri Sembilan', vacancies: 0 },
                { id: 'JT007', name: 'Jeti Melaka', vacancies: 0 },
                { id: 'JT008', name: 'Jeti Johor', vacancies: 7 },
                { id: 'JT009', name: 'Jeti Pahang', vacancies: 12 },
                { id: 'JT0010', name: 'Jeti Terengganu', vacancies: 1 },
                { id: 'JT0011', name: 'Jeti Kelantan', vacancies: 0 },
                { id: 'JT0012', name: 'Jeti Sarawak', vacancies: 17 },
                { id: 'JT0013', name: 'Jeti WP Labuan', vacancies: 1 },
                { id: 'JT0014', name: 'Jeti Sabah', vacancies: 32 }
            ]
        };
        
        // Demo Users
        const DEMO_USERS = [
            {
                id: 1,
                name: "Ahmad bin Ali",
                ic: "850505011234",
                email: "ahmad@email.com",
                phone: "0123456789",
                password: "password123",
                address: "No 123, Jalan Bunga, 43000 Kajang, Selangor",
                createdAt: "2023-10-01",
                status: "active",
                role: "user"
            },
            {
                id: 2,
                name: "Admin Sistem",
                ic: "900101011234",
                email: "admin@email.com",
                phone: "0123456789",
                password: "admin123",
                department: "Pentadbiran",
                address: "Aras 5, Menara Kerajaan, Putrajaya",
                createdAt: "2023-10-01",
                status: "active",
                role: "admin"
            },
            {
                id: 3,
                name: "Siti binti Hassan",
                ic: "900101011234",
                email: "siti@email.com",
                phone: "0134567890",
                password: "password123",
                address: "No 45, Taman Mewah, 53100 Kuala Lumpur",
                createdAt: "2023-10-05",
                status: "active",
                role: "user"
            }
        ];
        
        // Asset Data
        const ASSETS_DATA = [
            {
                id: 1,
                type: "kuarters",
                name: "Kuarters Kakitangan",
                icon: "fas fa-home",
                color: "#9b59b6",
                description: "Kuarters untuk kakitangan kerajaan dengan kemudahan lengkap. 3 bilik tidur, 2 bilik air, dapur dan ruang tamu.",
                monthlyRent: "RM 450",
                totalUnits: 181,
                availableUnits: 49
            },
            {
                id: 2,
                type: "pejabat",
                name: "Sewa Pejabat",
                icon: "fas fa-building",
                color: "#3498db",
                description: "Pejabat di lokasi strategik dengan kemudahan lengkap termasuk parking, sistem keselamatan dan internet.",
                monthlyRent: "RM 2,500",
                totalUnits: 24,
                availableUnits: 3
            },
            {
                id: 3,
                type: "kedai",
                name: "Lot Kedai",
                icon: "fas fa-store",
                color: "#f39c12",
                description: "Lot kedai di kawasan komersial dengan foot traffic tinggi. Sesuai untuk perniagaan runcit dan servis.",
                monthlyRent: "RM 1,800",
                totalUnits: 15,
                availableUnits: 4
            },
            {
                id: 4,
                type: "tanah",
                name: "Tanah Lot",
                icon: "fas fa-map-marked-alt",
                color: "#2ecc71",
                description: "Tanah lot untuk tujuan perindustrian atau komersial. Lokasi strategik dengan akses jalan raya utama.",
                monthlyRent: "RM 3,200",
                totalUnits: 8,
                availableUnits: 3
            }
        ];
        
        let currentUser = null;
        let users = [];
        let applications = [];
        let assets = [];
        let vacancies = VACANCY_DATA;
        let passwordResetTokens = {};
        let profilePictures = {};
        let isEditingProfile = false;
        let profilePictureFile = null;
        let profilePicturePreview = null;
        
        // Initialize System
        function initializeSystem() {
            console.log("Initializing system...");
            
            // Initialize users
            const storedUsers = localStorage.getItem(STORAGE_KEYS.USERS);
            if (!storedUsers) {
                users = DEMO_USERS;
                localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
                console.log("Demo users created");
            } else {
                users = JSON.parse(storedUsers);
                console.log("Users loaded from storage:", users.length);
            }
            
            // Initialize applications
            const storedApps = localStorage.getItem(STORAGE_KEYS.APPLICATIONS);
            applications = storedApps ? JSON.parse(storedApps) : [];
            console.log("Applications loaded:", applications.length);
            
            // Initialize assets
            const storedAssets = localStorage.getItem(STORAGE_KEYS.ASSETS);
            assets = storedAssets ? JSON.parse(storedAssets) : ASSETS_DATA;
            console.log("Assets loaded:", assets.length);
            
            // Initialize vacancies
            const storedVacancies = localStorage.getItem(STORAGE_KEYS.VACANCIES);
            if (storedVacancies) {
                vacancies = JSON.parse(storedVacancies);
            } else {
                localStorage.setItem(STORAGE_KEYS.VACANCIES, JSON.stringify(vacancies));
            }
            console.log("Vacancies loaded");
            
            // Initialize reset tokens
            const storedTokens = localStorage.getItem(STORAGE_KEYS.PASSWORD_RESET_TOKENS);
            passwordResetTokens = storedTokens ? JSON.parse(storedTokens) : {};
            
            // Initialize profile pictures
            const storedPictures = localStorage.getItem(STORAGE_KEYS.PROFILE_PICTURES);
            profilePictures = storedPictures ? JSON.parse(storedPictures) : {};
            console.log("Profile pictures loaded:", Object.keys(profilePictures).length);
            
            // Check login status
            checkLoginStatus();
        }
        
        function checkLoginStatus() {
            const storedUser = sessionStorage.getItem(STORAGE_KEYS.CURRENT_USER) || 
                              localStorage.getItem(STORAGE_KEYS.CURRENT_USER);
            
            if (storedUser) {
                try {
                    currentUser = JSON.parse(storedUser);
                    showApplication();
                    console.log("User logged in:", currentUser.name);
                } catch (e) {
                    console.error("Error parsing user data:", e);
                    showAuthentication();
                }
            } else {
                showAuthentication();
            }
        }
        
        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        
        function showAuthentication() {
            document.getElementById('authPage').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            switchAuthTab('login');
            console.log("Showing authentication page");
        }
        
        function showApplication() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            updateUserInterface();
            loadDashboard();
            console.log("Showing application page");
        }
        
        function handleLogin(e) {
            e.preventDefault();
            console.log("Login attempt");
            
            const identifier = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Clear previous errors
            clearValidationMessages();
            
            const user = users.find(u => 
                u.email === identifier || u.ic === identifier
            );
            
            if (!user) {
                showValidationMessage('loginEmailError', 'Akaun tidak ditemui', 'error');
                console.log("User not found");
                return;
            }
            
            if (user.password !== password) {
                showValidationMessage('loginPasswordError', 'Kata laluan tidak betul', 'error');
                console.log("Invalid password");
                return;
            }
            
            if (user.status !== 'active') {
                showValidationMessage('loginEmailError', 'Akaun anda telah dinyahaktifkan', 'error');
                console.log("Account inactive");
                return;
            }
            
            // Login successful
            currentUser = {
                id: user.id,
                name: user.name,
                email: user.email,
                phone: user.phone,
                ic: user.ic,
                address: user.address,
                role: user.role,
                createdAt: user.createdAt,
                status: user.status
            };
            
            // Save to storage
            sessionStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
            if (rememberMe) {
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
            }
            
            console.log("Login successful:", currentUser.name);
            showApplication();
        }
        
        function handleRegister(e) {
            e.preventDefault();
            console.log("Register attempt");
            
            // Clear previous errors
            clearValidationMessages();
            
            const name = document.getElementById('registerName').value.trim();
            const ic = document.getElementById('registerIC').value;
            const email = document.getElementById('registerEmail').value.trim();
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validation
            if (!validateIC(ic)) {
                showValidationMessage('registerIC', 'No. Kad Pengenalan tidak sah (12 digit diperlukan)', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showValidationMessage('registerEmail', 'Format email tidak sah', 'error');
                return;
            }
            
            if (password.length < 8) {
                showValidationMessage('registerPassword', 'Kata laluan mesti sekurang-kurangnya 8 aksara', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showValidationMessage('passwordMatchError', 'Kata laluan tidak sepadan', 'error');
                return;
            }
            
            // Check if user already exists
            if (users.find(u => u.email === email)) {
                showValidationMessage('registerEmail', 'Email sudah didaftarkan', 'error');
                return;
            }
            
            if (users.find(u => u.ic === ic)) {
                showValidationMessage('registerIC', 'No. Kad Pengenalan sudah didaftarkan', 'error');
                return;
            }
            
            const userData = {
                id: Date.now(),
                name: name,
                ic: ic,
                email: email,
                phone: phone,
                password: password,
                address: '',
                createdAt: new Date().toISOString().split('T')[0],
                status: 'active',
                role: 'user'
            };
            
            users.push(userData);
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('successMessage').classList.add('active');
            
            console.log("Registration successful:", name);
        }
        
        function handleForgotPassword(e) {
            e.preventDefault();
            console.log("Forgot password attempt");
            
            clearValidationMessages();
            
            const email = document.getElementById('resetEmail').value.trim();
            
            if (!validateEmail(email)) {
                showValidationMessage('resetEmailError', 'Format email tidak sah', 'error');
                return;
            }
            
            const user = users.find(u => u.email === email);
            
            if (!user) {
                showValidationMessage('resetEmailError', 'Email tidak ditemui dalam sistem', 'error');
                return;
            }
            
            // Generate reset token
            const resetToken = generateToken();
            passwordResetTokens[resetToken] = {
                email: email,
                expires: Date.now() + 3600000 // 1 hour
            };
            
            localStorage.setItem(STORAGE_KEYS.PASSWORD_RESET_TOKENS, JSON.stringify(passwordResetTokens));
            
            // Simulate sending email
            setTimeout(() => {
                alert('Pautan tetapan semula kata laluan telah dihantar ke email anda.');
                
                document.getElementById('forgotPasswordForm').classList.remove('active');
                document.getElementById('resetPasswordForm').classList.add('active');
                
                document.getElementById('resetPasswordForm').dataset.email = email;
            }, 1000);
        }
        
        function handleResetPassword(e) {
            e.preventDefault();
            console.log("Reset password attempt");
            
            clearValidationMessages();
            
            const email = document.getElementById('resetPasswordForm').dataset.email;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if (newPassword.length < 8) {
                showValidationMessage('newPassword', 'Kata laluan mesti sekurang-kurangnya 8 aksara', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showValidationMessage('resetPasswordMatchError', 'Kata laluan tidak sepadan', 'error');
                return;
            }
            
            const user = users.find(u => u.email === email);
            
            if (!user) {
                alert('Ralat: Pengguna tidak ditemui');
                return;
            }
            
            // Update password
            user.password = newPassword;
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            
            // Show success message
            document.getElementById('resetPasswordForm').classList.remove('active');
            document.getElementById('resetSuccessMessage').classList.add('active');
            
            console.log("Password reset successful for:", email);
        }
        
        function handleChangePassword(e) {
            e.preventDefault();
            console.log("Change password attempt");
            
            clearValidationMessages();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPasswordProfile').value;
            const confirmPassword = document.getElementById('confirmNewPasswordProfile').value;
            
            // Find current user
            const user = users.find(u => u.id === currentUser.id);
            
            if (!user) {
                showValidationMessage('currentPasswordError', 'Ralat: Pengguna tidak ditemui', 'error');
                return;
            }
            
            if (user.password !== currentPassword) {
                showValidationMessage('currentPasswordError', 'Kata laluan semasa tidak betul', 'error');
                return;
            }
            
            if (newPassword.length < 8) {
                showValidationMessage('newPasswordProfile', 'Kata laluan mesti sekurang-kurangnya 8 aksara', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showValidationMessage('changePasswordMatchError', 'Kata laluan tidak sepadan', 'error');
                return;
            }
            
            // Update password
            user.password = newPassword;
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            
            // Close modal and show success message
            closeModal('changePasswordModal');
            alert('Kata laluan telah berjaya ditukar.');
            
            console.log("Password changed for:", currentUser.name);
        }
        
        // ============================================
        // PROFILE PICTURE FUNCTIONS
        // ============================================
        
        function loadProfilePicture(userId) {
            console.log("Loading profile picture for user:", userId);
            
            const profilePicture = document.getElementById('profilePicture');
            const placeholder = document.getElementById('profilePicturePlaceholder');
            const headerAvatar = document.getElementById('headerUserAvatar');
            
            // Clear existing content
            if (profilePicture) {
                profilePicture.innerHTML = '';
            }
            
            if (headerAvatar) {
                headerAvatar.innerHTML = '';
            }
            
            const user = users.find(u => u.id === userId);
            const initials = getInitials(user ? user.name : '');
            
            if (profilePictures[userId]) {
                // Load saved profile picture
                const img = document.createElement('img');
                img.src = profilePictures[userId];
                img.alt = 'Gambar Profil';
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                
                if (profilePicture) {
                    profilePicture.appendChild(img);
                }
                
                // Update header avatar
                if (headerAvatar) {
                    const headerImg = document.createElement('img');
                    headerImg.src = profilePictures[userId];
                    headerImg.alt = 'Avatar';
                    headerImg.style.width = '100%';
                    headerImg.style.height = '100%';
                    headerImg.style.objectFit = 'cover';
                    headerAvatar.appendChild(headerImg);
                }
            } else {
                // Show initials as placeholder
                if (placeholder) {
                    placeholder.textContent = initials;
                }
                
                // Update header avatar with initials
                if (headerAvatar) {
                    headerAvatar.textContent = initials;
                }
            }
        }
        
        function saveProfilePicture(userId) {
            if (!profilePictureFile) {
                alert('Sila pilih gambar terlebih dahulu');
                return;
            }
            
            console.log("Saving profile picture for user:", userId);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Save to localStorage
                profilePictures[userId] = e.target.result;
                localStorage.setItem(STORAGE_KEYS.PROFILE_PICTURES, JSON.stringify(profilePictures));
                
                // Update UI
                loadProfilePicture(userId);
                
                // Reset
                profilePictureFile = null;
                profilePicturePreview = null;
                
                // Hide actions
                const actions = document.getElementById('profilePictureActions');
                if (actions) actions.style.display = 'none';
                
                // Show success message
                alert('Gambar profil berjaya disimpan!');
                
                console.log("Profile picture saved for user:", userId);
            };
            reader.onerror = function() {
                alert('Ralat memuatkan gambar. Sila cuba lagi.');
            };
            reader.readAsDataURL(profilePictureFile);
        }
        
        function removeProfilePicture(userId) {
            if (confirm('Adakah anda pasti ingin membuang gambar profil?')) {
                delete profilePictures[userId];
                localStorage.setItem(STORAGE_KEYS.PROFILE_PICTURES, JSON.stringify(profilePictures));
                
                // Update UI
                loadProfilePicture(userId);
                
                // Reset
                profilePictureFile = null;
                profilePicturePreview = null;
                
                // Hide actions
                const actions = document.getElementById('profilePictureActions');
                if (actions) actions.style.display = 'none';
                
                alert('Gambar profil telah dibuang.');
                
                console.log("Profile picture removed for user:", userId);
            }
        }
        
        // ============================================
        // PROFILE EDIT FUNCTIONS
        // ============================================
        
        function startProfileEdit() {
            console.log("startProfileEdit called");
            
            isEditingProfile = true;
            
            // Add editing class to profile card
            const profileCard = document.getElementById('profileCard');
            if (profileCard) {
                profileCard.classList.add('editing');
            }
            
            // Show edit buttons, hide edit button
            const editBtn = document.getElementById('editProfileBtn');
            const saveBtn = document.getElementById('saveProfileBtn');
            const cancelBtn = document.getElementById('cancelEditBtn');
            
            if (editBtn) editBtn.style.display = 'none';
            if (saveBtn) saveBtn.style.display = 'inline-flex';
            if (cancelBtn) cancelBtn.style.display = 'inline-flex';
            
            // Load current user data into edit fields
            const user = users.find(u => u.id === currentUser.id);
            if (user) {
                const editName = document.getElementById('editName');
                const editIC = document.getElementById('editIC');
                const editPhone = document.getElementById('editPhone');
                const editEmail = document.getElementById('editEmail');
                const editAddress = document.getElementById('editAddress');
                
                if (editName) editName.value = user.name;
                if (editIC) editIC.value = user.ic;
                if (editPhone) editPhone.value = user.phone || '';
                if (editEmail) editEmail.value = user.email;
                if (editAddress) editAddress.value = user.address || '';
            }
        }
        
        function cancelProfileEdit() {
            console.log("cancelProfileEdit called");
            
            isEditingProfile = false;
            
            // Remove editing class
            const profileCard = document.getElementById('profileCard');
            if (profileCard) {
                profileCard.classList.remove('editing');
            }
            
            // Show edit button, hide edit buttons
            const editBtn = document.getElementById('editProfileBtn');
            const saveBtn = document.getElementById('saveProfileBtn');
            const cancelBtn = document.getElementById('cancelEditBtn');
            
            if (editBtn) editBtn.style.display = 'inline-flex';
            if (saveBtn) saveBtn.style.display = 'none';
            if (cancelBtn) cancelBtn.style.display = 'none';
            
            // Clear validation messages
            clearValidationMessages();
        }
        
        function saveProfileChanges() {
            console.log("saveProfileChanges called");
            
            // Clear previous errors
            clearValidationMessages();
            
            const nameInput = document.getElementById('editName');
            const phoneInput = document.getElementById('editPhone');
            const emailInput = document.getElementById('editEmail');
            const addressInput = document.getElementById('editAddress');
            
            if (!nameInput || !emailInput) {
                alert('Ralat: Borang tidak lengkap');
                return;
            }
            
            const name = nameInput.value.trim();
            const phone = phoneInput ? phoneInput.value.trim() : '';
            const email = emailInput.value.trim();
            const address = addressInput ? addressInput.value.trim() : '';
            
            // Validation
            if (!name) {
                alert('Sila isi nama penuh');
                return;
            }
            
            if (!validateEmail(email)) {
                alert('Format email tidak sah');
                return;
            }
            
            // Check if email is already taken by another user
            const existingUser = users.find(u => u.email === email && u.id !== currentUser.id);
            if (existingUser) {
                alert('Email ini sudah digunakan oleh pengguna lain');
                return;
            }
            
            // Find and update user
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].name = name;
                users[userIndex].phone = phone;
                users[userIndex].email = email;
                users[userIndex].address = address;
                
                // Update current user data
                currentUser.name = name;
                currentUser.phone = phone;
                currentUser.email = email;
                currentUser.address = address;
                
                // Save to storage
                localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
                sessionStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                
                // Update UI
                updateUserInterface();
                loadUserDashboard();
                loadProfileData();
                
                // Exit edit mode
                cancelProfileEdit();
                
                // Show success message
                alert('Profil anda telah berjaya dikemaskini!');
                
                console.log("Profile updated for user:", currentUser.name);
            } else {
                alert('Ralat: Pengguna tidak ditemui');
            }
        }
        
        // ============================================
        // PROFILE DATA LOADING
        // ============================================
        
        function loadProfileData() {
            const user = users.find(u => u.id === currentUser.id);
            if (user) {
                // Update view mode
                document.getElementById('profileName').textContent = user.name;
                document.getElementById('profileEmail').textContent = user.email;
                document.getElementById('profileEmailDisplay').textContent = user.email;
                document.getElementById('profileIC').textContent = user.ic;
                document.getElementById('profilePhone').textContent = user.phone || 'Tiada';
                document.getElementById('profileAddress').textContent = user.address || 'Tiada';
                document.getElementById('profileSince').textContent = formatDate(user.createdAt);
                
                const userApps = applications.filter(app => app.applicantId === currentUser.id);
                document.getElementById('profileTotalApps').textContent = userApps.length;
                
                document.getElementById('profileStatus').textContent = user.status === 'active' ? 'Aktif' : 'Tidak Aktif';
                document.getElementById('profileRole').textContent = user.role === 'admin' ? 'Pentadbir' : 'Pengguna';
                
                // Load profile picture
                loadProfilePicture(currentUser.id);
                
                console.log("Profile data loaded for:", user.name);
            }
        }
        
        function updateUserInterface() {
            if (!currentUser) return;
            
            console.log("Updating UI for user:", currentUser.name);
            
            // Update header
            const headerUserName = document.getElementById('headerUserName');
            const userName = document.getElementById('userName');
            
            if (headerUserName) headerUserName.textContent = currentUser.name;
            if (userName) userName.textContent = currentUser.name;
            
            // Update welcome message
            const welcomeTitle = document.getElementById('welcomeTitle');
            if (welcomeTitle) {
                welcomeTitle.textContent = `Selamat Datang, ${currentUser.name.split(' ')[0]}!`;
            }
            
            // Update profile picture in header
            loadProfilePicture(currentUser.id);
            
            // Update navigation based on role
            updateNavigation();
        }
        
        // ============================================
        // DASHBOARD AND NAVIGATION FUNCTIONS
        // ============================================
        
        function loadDashboard() {
            if (currentUser.role === 'admin') {
                document.getElementById('userDashboard').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadAdminDashboard();
                console.log("Loading admin dashboard");
            } else {
                document.getElementById('userDashboard').style.display = 'block';
                document.getElementById('adminDashboard').style.display = 'none';
                loadUserDashboard();
                console.log("Loading user dashboard");
            }
        }
        
        function loadUserDashboard() {
            console.log("Loading user dashboard");
            
            // Update statistics based on real-time vacancy data
            const totalQuarters = assets.find(a => a.type === 'kuarters')?.totalUnits || 0;
            
            // Calculate available quarters from vacancies data
            const availableQuarters = vacancies.kuarters?.reduce((sum, location) => sum + location.vacancies, 0) || 0;
            
            const userApps = applications.filter(app => app.applicantId === currentUser.id);
            const pendingApps = userApps.filter(app => app.status === 'pending');
            
            document.getElementById('dashboardTotalQuarters').textContent = totalQuarters;
            document.getElementById('dashboardAvailableQuarters').textContent = availableQuarters;
            document.getElementById('dashboardMyApplications').textContent = userApps.length;
            document.getElementById('dashboardPending').textContent = pendingApps.length;
            
            // Update asset available units based on vacancies
            updateAssetAvailability();
            
            // Update profile
            loadProfileData();
            
            // Load quick access assets with real-time availability
            loadQuickAccessAssets();
            
            // Load user applications
            loadUserApplications();
        }
        
        function updateAssetAvailability() {
            // Update each asset's availableUnits based on vacancies
            assets.forEach(asset => {
                if (vacancies[asset.type]) {
                    const totalVacancies = vacancies[asset.type].reduce((sum, loc) => sum + loc.vacancies, 0);
                    asset.availableUnits = totalVacancies;
                }
            });
            
            // Save updated assets
            localStorage.setItem(STORAGE_KEYS.ASSETS, JSON.stringify(assets));
        }
        
        function loadAdminDashboard() {
            console.log("Loading admin dashboard");
            
            // Update statistics with real-time data
            document.getElementById('totalUsers').textContent = users.filter(u => u.role === 'user').length;
            document.getElementById('totalApplications').textContent = applications.length;
            document.getElementById('pendingApplications').textContent = applications.filter(app => app.status === 'pending').length;
            
            // Calculate total available assets from vacancies
            const totalAvailable = Object.keys(vacancies).reduce((total, assetType) => {
                const assetVacancies = vacancies[assetType] || [];
                return total + assetVacancies.reduce((sum, loc) => sum + loc.vacancies, 0);
            }, 0);
            document.getElementById('availableAssets').textContent = totalAvailable;
            
            // Load applications for admin
            loadAdminApplications();
            
            // Load users for admin
            loadUsersList();
        }
        
        function loadQuickAccessAssets() {
            const assetsGrid = document.getElementById('quickAccessAssets');
            if (!assetsGrid) return;
            
            assetsGrid.innerHTML = '';
            
            assets.forEach(asset => {
                const totalVacancies = vacancies[asset.type]?.reduce((sum, loc) => sum + loc.vacancies, 0) || 0;
                const availableLocations = vacancies[asset.type]?.filter(loc => loc.vacancies > 0).length || 0;
                
                // Determine status
                let statusClass, statusText;
                if (totalVacancies > 3) {
                    statusClass = 'status-available';
                    statusText = `${totalVacancies} Tersedia`;
                } else if (totalVacancies > 0) {
                    statusClass = 'status-limited';
                    statusText = `${totalVacancies} Terhad`;
                } else {
                    statusClass = 'status-unavailable';
                    statusText = 'Tidak Tersedia';
                }
                
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.innerHTML = `
                    <div class="asset-image" style="background-color: ${asset.color}20; color: ${asset.color};">
                        <i class="${asset.icon}"></i>
                        <div class="asset-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    <div class="asset-content">
                        <h3 class="asset-title">${asset.name}</h3>
                        <div class="asset-location">
                            <i class="fas fa-map-marker-alt"></i> ${availableLocations} Lokasi Tersedia
                        </div>
                        <div class="asset-details">
                            <p>${asset.description}</p>
                            <div class="detail-item">
                                <span class="detail-label">Sewa Bulanan:</span>
                                <span class="detail-value">${asset.monthlyRent}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Unit Tersedia:</span>
                                <span class="detail-value">${totalVacancies} / ${asset.totalUnits}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Lokasi Kosong:</span>
                                <span class="detail-value">${availableLocations} lokasi</span>
                            </div>
                        </div>
                        <div class="asset-actions">
                            ${totalVacancies > 0 ? `
                            <button class="btn btn-primary btn-block apply-now-btn" data-asset-type="${asset.type}">
                                <i class="fas fa-pen"></i> Mohon Sekarang
                            </button>
                            ` : `
                            <button class="btn btn-block" disabled style="background-color: #e9ecef; color: #6c757d; cursor: not-allowed;">
                                <i class="fas fa-times-circle"></i> Tiada Kekosongan
                            </button>
                            `}
                        </div>
                    </div>
                `;
                assetsGrid.appendChild(card);
            });
            
            console.log("Quick access assets loaded:", assets.length);
        }
        
        function loadAllAssets() {
            const assetsGrid = document.getElementById('assetsGrid');
            if (!assetsGrid) return;
            
            assetsGrid.innerHTML = '';
            
            // Calculate total available units for display
            const totalAvailable = assets.reduce((sum, asset) => sum + (asset.availableUnits || 0), 0);
            const totalUnits = assets.reduce((sum, asset) => sum + (asset.totalUnits || 0), 0);
            
            document.getElementById('availableCount').textContent = totalAvailable;
            document.getElementById('totalCount').textContent = totalUnits;
            
            assets.forEach(asset => {
                const totalVacancies = vacancies[asset.type]?.reduce((sum, loc) => sum + loc.vacancies, 0) || 0;
                const availableLocations = vacancies[asset.type]?.filter(loc => loc.vacancies > 0).length || 0;
                
                // Determine status
                let statusClass, statusText;
                if (totalVacancies > 3) {
                    statusClass = 'status-available';
                    statusText = `${totalVacancies} Tersedia`;
                } else if (totalVacancies > 0) {
                    statusClass = 'status-limited';
                    statusText = `${totalVacancies} Terhad`;
                } else {
                    statusClass = 'status-unavailable';
                    statusText = 'Tidak Tersedia';
                }
                
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.innerHTML = `
                    <div class="asset-image" style="background-color: ${asset.color}20; color: ${asset.color};">
                        <i class="${asset.icon}"></i>
                        <div class="asset-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    <div class="asset-content">
                        <h3 class="asset-title">${asset.name}</h3>
                        <div class="asset-location">
                            <i class="fas fa-map-marker-alt"></i> ${availableLocations} Lokasi Tersedia
                        </div>
                        <div class="asset-details">
                            <p>${asset.description}</p>
                            <div class="detail-item">
                                <span class="detail-label">Sewa Bulanan:</span>
                                <span class="detail-value">${asset.monthlyRent}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Unit Tersedia:</span>
                                <span class="detail-value">${totalVacancies} / ${asset.totalUnits}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Lokasi Kosong:</span>
                                <span class="detail-value">${availableLocations} lokasi</span>
                            </div>
                        </div>
                        <div class="asset-actions">
                            ${totalVacancies > 0 ? `
                            <button class="btn btn-primary btn-block apply-now-btn" data-asset-type="${asset.type}">
                                <i class="fas fa-pen"></i> Mohon Sekarang
                            </button>
                            ` : `
                            <button class="btn btn-block" disabled style="background-color: #e9ecef; color: #6c757d; cursor: not-allowed;">
                                <i class="fas fa-times-circle"></i> Tiada Kekosongan
                            </button>
                            `}
                        </div>
                    </div>
                `;
                assetsGrid.appendChild(card);
            });
            
            console.log("All assets loaded:", assets.length);
        }
        
        function loadUserApplications() {
            const statusList = document.getElementById('applicationStatus');
            if (!statusList) return;
            
            const userApps = applications.filter(app => app.applicantId === currentUser.id);
            
            if (userApps.length === 0) {
                statusList.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        <i class="fas fa-file-alt" style="font-size: 2.5rem; margin-bottom: 1rem;"></i>
                        <h3>Tiada Permohonan</h3>
                        <p>Anda belum membuat sebarang permohonan.</p>
                    </div>
                `;
                return;
            }
            
            statusList.innerHTML = '';
            userApps.forEach(app => {
                let badgeClass, badgeText;
                switch(app.status) {
                    case 'pending':
                        badgeClass = 'badge-processing';
                        badgeText = 'Menunggu Admin';
                        break;
                    case 'approved':
                        badgeClass = 'badge-approved';
                        badgeText = 'Diluluskan';
                        break;
                    case 'rejected':
                        badgeClass = 'badge-rejected';
                        badgeText = 'Ditolak';
                        break;
                    default:
                        badgeClass = 'badge-processing';
                        badgeText = 'Dalam Proses';
                }
                
                const item = document.createElement('div');
                item.className = 'status-item';
                item.innerHTML = `
                    <div class="status-info">
                        <h4>${app.assetName}</h4>
                        <p>No. Rujukan: ${app.reference} | Lokasi: ${app.location} | Tarikh: ${formatDate(app.applyDate)}</p>
                    </div>
                    <div class="status-badge ${badgeClass}">${badgeText}</div>
                `;
                statusList.appendChild(item);
            });
            
            console.log("User applications loaded:", userApps.length);
        }
        
        function loadAdminApplications() {
            const appList = document.getElementById('adminApplicationsList');
            if (!appList) return;
            
            appList.innerHTML = '';
            
            // Show all applications, newest first
            const sortedApps = [...applications].sort((a, b) => new Date(b.applyDate) - new Date(a.applyDate));
            
            if (sortedApps.length === 0) {
                appList.innerHTML = `
                    <div class="table-row" style="grid-template-columns: 1fr; text-align: center; padding: 2rem; color: var(--gray);">
                        <div>
                            <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 1rem; color: var(--success);"></i>
                            <h4>Tiada Permohonan</h4>
                            <p>Belum ada permohonan dibuat.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            sortedApps.forEach((app, index) => {
                let statusBadge;
                switch(app.status) {
                    case 'pending':
                        statusBadge = '<span class="badge-processing" style="padding: 3px 10px; border-radius: 15px;">Menunggu</span>';
                        break;
                    case 'approved':
                        statusBadge = '<span style="padding: 3px 10px; border-radius: 15px; background-color: rgba(40, 167, 69, 0.15); color: var(--success);">Diluluskan</span>';
                        break;
                    case 'rejected':
                        statusBadge = '<span style="padding: 3px 10px; border-radius: 15px; background-color: rgba(220, 53, 69, 0.15); color: var(--danger);">Ditolak</span>';
                        break;
                }
                
                const row = document.createElement('div');
                row.className = 'table-row';
                row.innerHTML = `
                    <div>${index + 1}</div>
                    <div>${app.applicantName}</div>
                    <div>${app.assetName}</div>
                    <div>${formatDate(app.applyDate)}</div>
                    <div>${statusBadge}</div>
                    <div class="action-buttons">
                        <button class="action-btn" style="background-color: var(--primary); color: white;" data-app-id="${app.id}" data-action="view">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${app.status === 'pending' ? `
                        <button class="action-btn" style="background-color: var(--success); color: white;" data-app-id="${app.id}" data-action="approve">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="action-btn" style="background-color: var(--danger); color: white;" data-app-id="${app.id}" data-action="reject">
                            <i class="fas fa-times"></i>
                        </button>
                        ` : ''}
                    </div>
                `;
                appList.appendChild(row);
            });
            
            console.log("Admin applications loaded:", sortedApps.length);
        }
        
        function loadUsersList() {
            const usersList = document.getElementById('usersList');
            if (!usersList) return;
            
            const normalUsers = users.filter(u => u.role === 'user');
            
            if (normalUsers.length === 0) {
                usersList.innerHTML = `
                    <div class="table-row" style="grid-template-columns: 1fr; text-align: center; padding: 2rem; color: var(--gray);">
                        <div>
                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 1rem; color: var(--gray);"></i>
                            <h4>Tiada Pengguna</h4>
                            <p>Belum ada pengguna berdaftar.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            usersList.innerHTML = '';
            normalUsers.forEach((user, index) => {
                const row = document.createElement('div');
                row.className = 'table-row';
                row.innerHTML = `
                    <div>${index + 1}</div>
                    <div>${user.name}</div>
                    <div>${user.email}</div>
                    <div><span style="color: ${user.status === 'active' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                        ${user.status === 'active' ? 'Aktif' : 'Tidak Aktif'}
                    </span></div>
                    <div class="action-buttons">
                        <button class="action-btn" style="background-color: var(--primary); color: white;" data-user-id="${user.id}" data-action="view-user">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" style="background-color: ${user.status === 'active' ? 'var(--danger)' : 'var(--success)'}; color: white;" 
                                data-user-id="${user.id}" data-action="toggle-status">
                            <i class="fas fa-${user.status === 'active' ? 'ban' : 'check'}"></i>
                        </button>
                    </div>
                `;
                usersList.appendChild(row);
            });
            
            console.log("Users list loaded:", normalUsers.length);
        }
        
        function updateNavigation() {
            const navLinks = document.getElementById('navLinks');
            const newApplicationBtn = document.getElementById('newApplicationBtn');
            
            if (!navLinks) return;
            
            navLinks.innerHTML = '';
            
            const links = [
                { page: 'dashboard', icon: 'fas fa-home', text: 'Dashboard' }
            ];
            
            if (currentUser.role === 'admin') {
                links.push(
                    { page: 'users', icon: 'fas fa-users', text: 'Pengguna' },
                    { page: 'application', icon: 'fas fa-file-alt', text: 'Semua Permohonan' }
                );
                
                // Hide "Mohon Baru" button for admin
                if (newApplicationBtn) {
                    newApplicationBtn.style.display = 'none';
                }
            } else {
                links.push(
                    { page: 'assets', icon: 'fas fa-building', text: 'Aset Tersedia' },
                    { page: 'application', icon: 'fas fa-file-alt', text: 'Permohonan Saya' },
                    { page: 'profile', icon: 'fas fa-user', text: 'Profil Saya' }
                );
                
                // Show "Mohon Baru" button for regular users
                if (newApplicationBtn) {
                    newApplicationBtn.style.display = 'block';
                }
            }
            
            links.forEach(link => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <a href="#" class="${link.page === 'dashboard' ? 'active' : ''}" data-page="${link.page}">
                        <i class="${link.icon}"></i> ${link.text}
                    </a>
                `;
                navLinks.appendChild(li);
            });
            
            // Update header style for admin
            const appHeader = document.getElementById('appHeader');
            const appNav = document.getElementById('appNav');
            
            if (appHeader && appNav) {
                if (currentUser.role === 'admin') {
                    appHeader.classList.add('admin-header');
                    appNav.classList.add('admin-nav');
                } else {
                    appHeader.classList.remove('admin-header');
                    appNav.classList.remove('admin-nav');
                }
            }
            
            console.log("Navigation updated for role:", currentUser.role);
        }
        
        // ============================================
        // APPLICATION FUNCTIONS WITH AUTOCOUNT
        // ============================================
        
        function openApplicationModal(assetType = null) {
            console.log("openApplicationModal called");
            
            const modal = document.getElementById('applicationModal');
            if (!modal) {
                alert('Ralat: Modal tidak ditemui');
                return;
            }
            
            modal.style.display = 'flex';
            
            // Reset location selector
            resetLocationSelector();
            
            // Auto-fill user data from profile
            if (currentUser) {
                const user = users.find(u => u.id === currentUser.id);
                if (user) {
                    // Automatically fill name, IC, and email from profile
                    const applicantName = document.getElementById('applicantName');
                    const applicantIC = document.getElementById('applicantIC');
                    const applicantEmail = document.getElementById('applicantEmail');
                    const applicantPhone = document.getElementById('applicantPhone');
                    const applicantAddress = document.getElementById('applicantAddress');
                    
                    if (applicantName) applicantName.value = user.name;
                    if (applicantIC) applicantIC.value = user.ic;
                    if (applicantEmail) applicantEmail.value = user.email;
                    if (applicantPhone) applicantPhone.value = user.phone || '';
                    if (applicantAddress) applicantAddress.value = user.address || '';
                }
            }
            
            // Set asset type if provided
            if (assetType) {
                const assetTypeSelect = document.getElementById('assetType');
                if (assetTypeSelect) {
                    assetTypeSelect.value = assetType;
                    // Trigger change to load locations
                    setTimeout(() => {
                        loadLocationsForAssetType(assetType);
                    }, 100);
                }
            }
            
            // Set default date (tomorrow)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const startDate = document.getElementById('startDate');
            if (startDate) {
                startDate.value = tomorrow.toISOString().split('T')[0];
            }
            
            // Reset form except auto-filled fields
            const purpose = document.getElementById('purpose');
            const additionalInfo = document.getElementById('additionalInfo');
            const agreeTermsModal = document.getElementById('agreeTermsModal');
            
            if (purpose) purpose.value = '';
            if (additionalInfo) additionalInfo.value = '';
            if (agreeTermsModal) agreeTermsModal.checked = false;
            
            console.log("Application modal opened");
        }
        
        function resetLocationSelector() {
            // Hide all messages and dropdown
            document.getElementById('locationInitialMessage').style.display = 'block';
            document.getElementById('locationLoadingMessage').style.display = 'none';
            document.getElementById('locationNoVacancyMessage').style.display = 'none';
            document.getElementById('location').style.display = 'none';
            document.getElementById('location').disabled = true;
            document.getElementById('vacancyInfo').style.display = 'none';
            
            // Clear location options
            document.getElementById('location').innerHTML = '<option value="">Pilih jenis aset dahulu</option>';
        }
        
        function loadLocationsForAssetType(assetType) {
            // Show loading message
            document.getElementById('locationInitialMessage').style.display = 'none';
            document.getElementById('locationLoadingMessage').style.display = 'block';
            document.getElementById('locationNoVacancyMessage').style.display = 'none';
            document.getElementById('location').style.display = 'none';
            document.getElementById('vacancyInfo').style.display = 'none';
            
            // Get locations for this asset type
            const assetLocations = vacancies[assetType] || [];
            
            // Filter locations with vacancies > 0
            const availableLocations = assetLocations.filter(loc => loc.vacancies > 0);
            
            // Simulate loading delay
            setTimeout(() => {
                updateLocationSelector(availableLocations, assetType);
            }, 500);
        }
        
        function updateLocationSelector(availableLocations, assetType) {
            const locationSelect = document.getElementById('location');
            const vacancyInfo = document.getElementById('vacancyInfo');
            
            // Hide loading message
            document.getElementById('locationLoadingMessage').style.display = 'none';
            
            if (availableLocations.length === 0) {
                // No vacancies available
                document.getElementById('locationNoVacancyMessage').style.display = 'block';
                document.getElementById('location').style.display = 'none';
                vacancyInfo.style.display = 'none';
                return;
            }
            
            // Show dropdown
            document.getElementById('locationNoVacancyMessage').style.display = 'none';
            locationSelect.style.display = 'block';
            locationSelect.disabled = false;
            
            // Clear existing options
            locationSelect.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = `-- Pilih Lokasi (${availableLocations.length} pilihan) --`;
            defaultOption.disabled = true;
            defaultOption.selected = true;
            locationSelect.appendChild(defaultOption);
            
            // Add available locations
            availableLocations.forEach(location => {
                const option = document.createElement('option');
                option.value = location.id;
                option.textContent = `${location.name} (${location.vacancies} kosong)`;
                locationSelect.appendChild(option);
            });
            
            // Show vacancy info
            const totalVacancies = availableLocations.reduce((sum, loc) => sum + loc.vacancies, 0);
            vacancyInfo.textContent = ` ${totalVacancies} unit kosong di ${availableLocations.length} lokasi berbeza`;
            vacancyInfo.className = totalVacancies > 5 ? 'vacancy-info' : 
                                   totalVacancies > 0 ? 'vacancy-info warning' : 'vacancy-info danger';
            vacancyInfo.style.display = 'block';
            
            // Add change event listener
            locationSelect.addEventListener('change', function() {
                const selectedLocation = availableLocations.find(loc => loc.id === this.value);
                if (selectedLocation) {
                    // Update vacancy info for selected location
                    vacancyInfo.textContent = ` ${selectedLocation.name}: ${selectedLocation.vacancies} unit kosong`;
                }
            });
        }
        
        function submitApplication(e) {
            e.preventDefault();
            console.log("Submitting application");
            
            // Validate form
            const assetType = document.getElementById('assetType').value;
            const locationId = document.getElementById('location').value;
            
            if (!assetType || !locationId) {
                alert('Sila pilih jenis aset dan lokasi yang sah.');
                return;
            }
            
            // Get selected location details
            const availableLocations = vacancies[assetType] || [];
            const selectedLocation = availableLocations.find(loc => loc.id === locationId);
            
            if (!selectedLocation || selectedLocation.vacancies <= 0) {
                alert('Lokasi yang dipilih tidak mempunyai kekosongan. Sila pilih lokasi lain.');
                return;
            }
            
            // Create application
            const application = {
                id: Date.now(),
                reference: `APP-${new Date().getFullYear()}-${String(applications.length + 1).padStart(3, '0')}`,
                assetType: assetType,
                assetName: document.getElementById('assetType').options[document.getElementById('assetType').selectedIndex].text,
                location: selectedLocation.name,
                locationId: locationId,
                applyDate: new Date().toISOString().split('T')[0],
                applicantId: currentUser.id,
                applicantName: document.getElementById('applicantName').value,
                applicantEmail: document.getElementById('applicantEmail').value,
                applicantPhone: document.getElementById('applicantPhone').value,
                applicantAddress: document.getElementById('applicantAddress').value,
                purpose: document.getElementById('purpose').value,
                additionalInfo: document.getElementById('additionalInfo').value,
                status: 'pending',
                statusText: 'Menunggu Kelulusan Admin'
            };
            
            // Save application
            applications.unshift(application);
            localStorage.setItem(STORAGE_KEYS.APPLICATIONS, JSON.stringify(applications));
            
            // Update vacancy count (reduce by 1) - REAL-TIME AUTOCOUNT
            selectedLocation.vacancies -= 1;
            localStorage.setItem(STORAGE_KEYS.VACANCIES, JSON.stringify(vacancies));
            
            // Update asset availability
            const asset = assets.find(a => a.type === assetType);
            if (asset) {
                asset.availableUnits -= 1;
                localStorage.setItem(STORAGE_KEYS.ASSETS, JSON.stringify(assets));
            }
            
            // Show success modal
            showSuccessModal(application);
            
            // Close modal
            closeModal('applicationModal');
            
            // Update dashboard
            loadDashboard();
            
            // Update all asset displays
            if (document.getElementById('assetsPage').classList.contains('active')) {
                loadAllAssets();
            }
            
            console.log("Application submitted:", application.reference);
        }
        
        function showSuccessModal(application) {
            document.getElementById('referenceNumber').textContent = application.reference;
            document.getElementById('successAssetType').textContent = application.assetName;
            document.getElementById('successLocation').textContent = application.location;
            document.getElementById('successDate').textContent = formatDate(application.applyDate);
            
            document.getElementById('successModal').style.display = 'flex';
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function getInitials(name) {
            if (!name || name.trim() === '') return '??';
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }
        
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return 'Tarikh tidak sah';
                }
                return date.toLocaleDateString('ms-MY', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (e) {
                return 'Tarikh tidak sah';
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function showPage(pageId) {
            console.log("Showing page:", pageId);
            
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            const selectedPage = document.getElementById(pageId);
            if (selectedPage) {
                selectedPage.classList.add('active');
            }
            
            // Update navigation
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === pageId.replace('Page', '')) {
                    link.classList.add('active');
                }
            });
            
            // Load page content
            if (pageId === 'dashboardPage') {
                loadDashboard();
            } else if (pageId === 'assetsPage') {
                loadAllAssets();
            } else if (pageId === 'applicationPage') {
                if (currentUser.role === 'admin') {
                    loadAdminApplications();
                } else {
                    loadUserApplications();
                }
            } else if (pageId === 'profilePage') {
                // Load profile data
                loadProfileData();
                // Reset edit mode if active
                if (isEditingProfile) {
                    cancelProfileEdit();
                }
                // Reset profile picture actions
                const actions = document.getElementById('profilePictureActions');
                if (actions) actions.style.display = 'none';
            } else if (pageId === 'usersPage') {
                loadUsersList();
            }
        }
        
        function generateToken() {
            return Math.random().toString(36).substr(2) + Date.now().toString(36);
        }
        
        function validateIC(ic) {
            // Malaysian IC validation (12 digits)
            return /^\d{12}$/.test(ic.replace(/-/g, ''));
        }
        
        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        function showValidationMessage(elementId, message, type = 'error') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `validation-message ${type}`;
            }
        }
        
        function clearValidationMessages() {
            document.querySelectorAll('.validation-message').forEach(el => {
                el.textContent = '';
                el.className = 'validation-message';
            });
        }
        
        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        
        function setupEventListeners() {
            console.log("Setting up event listeners...");
            
            // Authentication tabs
            document.getElementById('loginTab').addEventListener('click', () => switchAuthTab('login'));
            document.getElementById('registerTab').addEventListener('click', () => switchAuthTab('register'));
            document.getElementById('goToRegister').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('register');
            });
            document.getElementById('goToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            document.getElementById('goToLoginFromSuccess').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            document.getElementById('goToLoginFromResetSuccess').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            
            // Forgot password links
            document.getElementById('forgotPasswordLink').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('forgotPassword');
            });
            
            document.getElementById('backToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            
            document.getElementById('backToLoginFromReset').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            
            // Form submissions
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('forgotPasswordForm').addEventListener('submit', handleForgotPassword);
            document.getElementById('resetPasswordForm').addEventListener('submit', handleResetPassword);
            document.getElementById('changePasswordForm').addEventListener('submit', handleChangePassword);
            document.getElementById('rentalApplicationForm').addEventListener('submit', submitApplication);
            
            // Password toggles
            document.getElementById('toggleLoginPassword').addEventListener('click', () => togglePasswordVisibility('loginPassword', 'toggleLoginPassword'));
            document.getElementById('toggleNewPassword').addEventListener('click', () => togglePasswordVisibility('newPassword', 'toggleNewPassword'));
            document.getElementById('toggleConfirmNewPassword').addEventListener('click', () => togglePasswordVisibility('confirmNewPassword', 'toggleConfirmNewPassword'));
            document.getElementById('toggleCurrentPassword').addEventListener('click', () => togglePasswordVisibility('currentPassword', 'toggleCurrentPassword'));
            document.getElementById('toggleNewPasswordProfile').addEventListener('click', () => togglePasswordVisibility('newPasswordProfile', 'toggleNewPasswordProfile'));
            document.getElementById('toggleConfirmNewPasswordProfile').addEventListener('click', () => togglePasswordVisibility('confirmNewPasswordProfile', 'toggleConfirmNewPasswordProfile'));
            
            // Profile edit buttons
            document.getElementById('editProfileBtn').addEventListener('click', function(e) {
                e.preventDefault();
                startProfileEdit();
            });
            
            document.getElementById('saveProfileBtn').addEventListener('click', function(e) {
                e.preventDefault();
                saveProfileChanges();
            });
            
            document.getElementById('cancelEditBtn').addEventListener('click', function(e) {
                e.preventDefault();
                cancelProfileEdit();
            });
            
            // Profile picture functionality
            document.getElementById('changeProfilePictureBtn').addEventListener('click', function() {
                document.getElementById('profilePictureInput').click();
            });
            
            document.getElementById('profilePictureInput').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    profilePictureFile = e.target.files[0];
                    
                    // Validate file type
                    const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                    if (!validTypes.includes(profilePictureFile.type)) {
                        alert('Hanya fail gambar dibenarkan (JPEG, PNG, GIF, WebP)');
                        profilePictureFile = null;
                        return;
                    }
                    
                    // Validate file size (max 2MB)
                    if (profilePictureFile.size > 2 * 1024 * 1024) {
                        alert('Saiz fail terlalu besar. Maksimum 2MB dibenarkan.');
                        profilePictureFile = null;
                        return;
                    }
                    
                    // Create preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePicturePreview = e.target.result;
                        
                        // Update profile picture preview
                        const profilePicture = document.getElementById('profilePicture');
                        if (profilePicture) {
                            profilePicture.innerHTML = '';
                            const img = document.createElement('img');
                            img.src = profilePicturePreview;
                            img.alt = 'Pratonton Gambar';
                            img.style.width = '100%';
                            img.style.height = '100%';
                            img.style.objectFit = 'cover';
                            profilePicture.appendChild(img);
                        }
                        
                        // Show action buttons
                        const actions = document.getElementById('profilePictureActions');
                        if (actions) actions.style.display = 'flex';
                    };
                    reader.readAsDataURL(profilePictureFile);
                }
            });
            
            document.getElementById('saveProfilePictureBtn').addEventListener('click', function() {
                saveProfilePicture(currentUser.id);
            });
            
            document.getElementById('removeProfilePictureBtn').addEventListener('click', function() {
                removeProfilePicture(currentUser.id);
            });
            
            document.getElementById('cancelProfilePictureBtn').addEventListener('click', function() {
                // Reset to original picture
                loadProfilePicture(currentUser.id);
                
                // Reset variables
                profilePictureFile = null;
                profilePicturePreview = null;
                
                // Hide actions
                const actions = document.getElementById('profilePictureActions');
                if (actions) actions.style.display = 'none';
            });
            
            // Change password button
            document.getElementById('changePasswordBtn').addEventListener('click', () => {
                document.getElementById('changePasswordModal').style.display = 'flex';
            });
            
            // Modal close buttons
            document.getElementById('closeChangePasswordModal').addEventListener('click', () => closeModal('changePasswordModal'));
            document.getElementById('cancelChangePassword').addEventListener('click', () => closeModal('changePasswordModal'));
            
            // Application buttons
            document.getElementById('newApplicationBtn').addEventListener('click', function(e) {
                e.preventDefault();
                openApplicationModal();
            });
            
            document.getElementById('applyNewBtn').addEventListener('click', function(e) {
                e.preventDefault();
                openApplicationModal();
            });
            
            // Modal controls
            document.getElementById('closeModal').addEventListener('click', () => closeModal('applicationModal'));
            document.getElementById('cancelApplication').addEventListener('click', () => closeModal('applicationModal'));
            document.getElementById('closeSuccessModal').addEventListener('click', () => closeModal('successModal'));
            document.getElementById('closeSuccessBtn').addEventListener('click', () => closeModal('successModal'));
            document.getElementById('closeDetailsModal').addEventListener('click', () => closeModal('applicationDetailsModal'));
            
            // Success modal buttons
            document.getElementById('viewStatusBtn').addEventListener('click', function() {
                closeModal('successModal');
                showPage('applicationPage');
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('Adakah anda pasti ingin log keluar?')) {
                    sessionStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
                    localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
                    currentUser = null;
                    showAuthentication();
                }
            });
            
            // Navigation links
            document.addEventListener('click', function(e) {
                if (e.target.closest('.nav-links a')) {
                    e.preventDefault();
                    const link = e.target.closest('a');
                    const page = link.dataset.page;
                    if (page) {
                        showPage(page + 'Page');
                    }
                }
            });
            
            // Refresh applications (admin)
            document.getElementById('refreshApplications')?.addEventListener('click', function() {
                loadAdminApplications();
                alert('Senarai permohonan telah dikemas kini!');
            });
            
            // Add user button (admin)
            document.getElementById('addUserBtn')?.addEventListener('click', function() {
                alert('Fungsi tambah pengguna akan datang tidak lama lagi.');
            });
            
            // Asset type change listener
            document.getElementById('assetType').addEventListener('change', function() {
                if (this.value) {
                    loadLocationsForAssetType(this.value);
                } else {
                    resetLocationSelector();
                }
            });
            
            // Quick access assets
            document.addEventListener('click', function(e) {
                if (e.target.closest('.apply-now-btn')) {
                    e.preventDefault();
                    const btn = e.target.closest('.apply-now-btn');
                    const assetType = btn.dataset.assetType;
                    openApplicationModal(assetType);
                }
            });
            
            console.log("Event listeners setup complete!");
        }
        
        function togglePasswordVisibility(passwordFieldId, toggleButtonId) {
            const passwordField = document.getElementById(passwordFieldId);
            const toggleButton = document.getElementById(toggleButtonId);
            const icon = toggleButton.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                passwordField.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }
        
        function switchAuthTab(tabName) {
            // Hide all forms
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('forgotPasswordForm').classList.remove('active');
            document.getElementById('resetPasswordForm').classList.remove('active');
            document.getElementById('successMessage').classList.remove('active');
            document.getElementById('resetSuccessMessage').classList.remove('active');
            
            // Update tabs
            document.getElementById('loginTab').classList.remove('active');
            document.getElementById('registerTab').classList.remove('active');
            
            // Clear validation messages
            clearValidationMessages();
            
            // Show selected form
            switch(tabName) {
                case 'login':
                    document.getElementById('loginTab').classList.add('active');
                    document.getElementById('loginForm').classList.add('active');
                    break;
                case 'register':
                    document.getElementById('registerTab').classList.add('active');
                    document.getElementById('registerForm').classList.add('active');
                    break;
                case 'forgotPassword':
                    document.getElementById('forgotPasswordForm').classList.add('active');
                    break;
            }
        }
        
        // Initialize system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded, initializing system...");
            initializeSystem();
            setupEventListeners();
        });
    </script>
</body>
</html>
